{"meta":{"title":"Old Stone","subtitle":"","description":"","author":"uklar","url":"https://blog.mahyang.uk","root":"/"},"pages":[{"title":"å…³äº","date":"2023-04-11T01:51:43.000Z","updated":"2025-08-09T15:57:00.899Z","comments":true,"path":"about/index.html","permalink":"https://blog.mahyang.uk/about/index.html","excerpt":"","text":"å…³äºæˆ‘çš„åšå®¢è¿™é‡Œæ˜¯æˆ‘çš„ä¸ªäººåšå®¢ï¼Œæˆ‘ä¼šåœ¨è¿™é‡Œåˆ†äº«æˆ‘çš„ä¸€äº›æƒ³æ³•å’Œç»éªŒã€‚ å…³äºæˆ‘ ä¸€ä¸ªè½¯ä»¶å¼€å‘è€… å–œæ¬¢å­¦ä¹ ï¼ˆæœ€è¿‘åœ¨å­¦ä¹  C++ï¼‰ å–œæ¬¢çœ‹ä¹¦ï¼ˆæœ€è¿‘åœ¨çœ‹ ä»–è€…çš„æ¶ˆå¤±ï¼‰ å–œæ¬¢çœ‹å‰§ï¼ˆæœ€è¿‘åœ¨çœ‹ The White Lotus 2ï¼‰ å–œæ¬¢æ‘„å½±ï¼ˆåªæ˜¯çœ‹æ‘„å½±å¤§å¸ˆçš„ä½œå“:-) ï¼‰ å…»äº† 2 åªçŒ«ï¼Œå¯Œè´µå’ŒèŠ±å¼€ è”ç³»æˆ‘å¦‚æœæ‚¨å¯¹æˆ‘çš„åšå®¢æ„Ÿå…´è¶£ï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼è”ç³»æˆ‘ï¼š é‚®ç®±ï¼š&#x75;&#107;&#x6c;&#x61;&#x72;&#x6d;&#97;&#x68;&#64;&#103;&#x6d;&#x61;&#x69;&#108;&#x2e;&#99;&#x6f;&#x6d;"},{"title":"æ ‡ç­¾","date":"2023-05-30T04:08:00.000Z","updated":"2025-08-09T15:57:00.899Z","comments":true,"path":"tags/index.html","permalink":"https://blog.mahyang.uk/tags/index.html","excerpt":"","text":""}],"posts":[{"title":"Rust Journey - Part1","slug":"Rust-Journey-Part-1","date":"2025-08-03T11:35:00.000Z","updated":"2025-08-09T07:35:00.000Z","comments":true,"path":"2025/08/03/Rust-Journey-Part-1/","link":"","permalink":"https://blog.mahyang.uk/2025/08/03/Rust-Journey-Part-1/","excerpt":"è¯¸å¦‚åœ¨ä»»ä½•ä¸€é—¨å…¶ä»–çš„ç¼–ç¨‹è¯­è¨€ä¸­å­˜åœ¨çš„å˜é‡ã€åŸºç¡€æ•°æ®ç±»å‹ã€å‡½æ•°ã€æµç¨‹æ§åˆ¶ä»¥åŠæ³¨é‡Šè¿™äº›åŸºç¡€æ¦‚å¿µï¼Œåœ¨ Rust è¯­è¨€ä¸­åŒæ ·å­˜åœ¨ã€‚è¿™ä¸€ç¯‡ä¸­æ¥ä»‹ç»åœ¨ Rust è¯­å¢ƒä¸­è¿™äº›æ¦‚å¿µçš„ç”¨æ³•ã€‚","text":"è¯¸å¦‚åœ¨ä»»ä½•ä¸€é—¨å…¶ä»–çš„ç¼–ç¨‹è¯­è¨€ä¸­å­˜åœ¨çš„å˜é‡ã€åŸºç¡€æ•°æ®ç±»å‹ã€å‡½æ•°ã€æµç¨‹æ§åˆ¶ä»¥åŠæ³¨é‡Šè¿™äº›åŸºç¡€æ¦‚å¿µï¼Œåœ¨ Rust è¯­è¨€ä¸­åŒæ ·å­˜åœ¨ã€‚è¿™ä¸€ç¯‡ä¸­æ¥ä»‹ç»åœ¨ Rust è¯­å¢ƒä¸­è¿™äº›æ¦‚å¿µçš„ç”¨æ³•ã€‚ å˜é‡åŠå¯å˜æ€§let å˜é‡é»˜è®¤æƒ…å†µä¸‹ï¼ŒRust ä¸­çš„å˜é‡æ˜¯ä¸å¯å˜çš„ã€‚å¬ä¸Šå»æœ‰ç‚¹åç›´è§‰ï¼Œä½†æ˜¯è¿™æ˜¯ Rust å»ºè®®çš„åšæ³•ã€‚åŒæ—¶ Rust ä¹Ÿæä¾›äº†æ–¹æ³•è®©å˜é‡å¯å˜ã€‚ æˆ‘ä»¬é€šè¿‡ cargo new variables åˆ›å»ºä¸€ä¸ªæ–°é¡¹ç›®æ¥æ¢ç´¢ä¸€ä¸‹å¯å˜æ€§çš„æ¦‚å¿µï¼Œåœ¨ src&#x2F;main.rs ä¸­å†™ä¸Šå¦‚ä¸‹ä»£ç ï¼š 123456fn main() &#123; let x = 5; println!(&quot;The value of x is: &#123;x&#125;&quot;); x = 6; println!(&quot;The value of x is: &#123;x&#125;&quot;);&#125; ä¿å­˜ç„¶åç¼–è¯‘ä¼šå‘ç°æœ‰æŠ¥é”™ï¼š 123456789101112131415161718$ cargo run Compiling variables v0.1.0 (file:///projects/variables)error[E0384]: cannot assign twice to immutable variable `x` --&gt; src/main.rs:4:5 |2 | let x = 5; | - first assignment to `x`3 | println!(&quot;The value of x is: &#123;x&#125;&quot;);4 | x = 6; | ^^^^^ cannot assign twice to immutable variable |help: consider making this binding mutable |2 | let mut x = 5; | +++For more information about this error, try `rustc --explain E0384`.error: could not compile `variables` (bin &quot;variables&quot;) due to 1 previous error é”™è¯¯ä¿¡æ¯å½“ä¸­ï¼Œå·²ç»æ˜ç¡®è¯´æ˜äº†ï¼šcannot assign twice to immutable variableï¼Œæˆ‘ä»¬ç»™ä¸€ä¸ªä¸å¯å˜å˜é‡ç¬¬äºŒæ¬¡èµ‹å€¼ï¼Œæ‰€ä»¥æŠ¥é”™ã€‚è¿™é‡Œå€¼å¾—æ³¨æ„çš„æ˜¯è¿™ä¸ªé”™è¯¯æŠ¥åœ¨äº†ç¼–è¯‘æœŸé—´ï¼ŒRust åœ¨ç¼–è¯‘çš„æ—¶å€™æ£€æŸ¥å‡ºäº†å†™çš„ä»£ç å’Œæˆ‘ä»¬çš„æ„å›¾ä¸ä¸€è‡´ï¼Œå› ä¸ºå˜é‡ x æ˜¯ä¸å¯å˜çš„ï¼Œä½†æ˜¯æˆ‘ä»¬å´åœ¨ç»™å®ƒç¬¬äºŒæ¬¡èµ‹å€¼ã€‚æ‰€ä»¥ Rust ä¿è¯çš„æ˜¯å¦‚æœæˆ‘ä»¬å¸Œæœ›ä¸€ä¸ªå˜é‡æ˜¯ä¸å¯å˜çš„é‚£ä¹ˆå®ƒä¸€å®šä¸ä¼šè¢«ä¿®æ”¹ã€‚ ä½†æ˜¯ï¼Œå˜é‡å¯å˜åŒæ ·å¯¹ç¨‹åºå‘˜å¾ˆé‡è¦ï¼Œå› ä¸ºå†™ç¨‹åºä¼šæ–¹ä¾¿ä¸€äº›ã€‚æˆ‘ä»¬å¯ä»¥åœ¨å®šä¹‰å˜é‡çš„æ—¶å€™åœ¨å˜é‡åä¹‹å‰åŠ ä¸€ä¸ªå…³é”®å­— mut æ¥è¡¨è¾¾æ„å›¾ï¼šè¿™ä¸ªå˜é‡æ˜¯å¯å˜çš„ã€‚ 123456fn main() &#123; let mut x = 5; println!(&quot;The value of x is: &#123;x&#125;&quot;); x = 6; println!(&quot;The value of x is: &#123;x&#125;&quot;);&#125; è¿è¡Œç¨‹åºï¼š 123456$ cargo run Compiling variables v0.1.0 (file:///projects/variables) Finished `dev` profile [unoptimized + debuginfo] target(s) in 0.30s Running `target/debug/variables`The value of x is: 5The value of x is: 6 å½“å¸Œæœ›å°†ç»‘å®šåœ¨ x ä¸Šçš„å€¼ä» 5 æ”¹ä¸º 6 å°±å¿…é¡»ä½¿ç”¨ mutã€‚ å¸¸é‡å’Œä¸å¯å˜å˜é‡ä¸€æ ·ï¼Œå¸¸é‡ç»‘å®šçš„å€¼ä¹Ÿä¸å¯ä¿®æ”¹çš„ã€‚ä½†æ˜¯ï¼Œå®ƒä»¬ä¹‹é—´ä¹Ÿæœ‰ä¸€äº›ä¸åŒçš„åœ°æ–¹ã€‚é¦–å…ˆä¸èƒ½åœ¨å¸¸é‡å‰åŠ  mutï¼Œå¸¸é‡æ°¸è¿œéƒ½æ˜¯ä¸å¯å˜çš„ï¼›ç¬¬äºŒï¼Œå®šä¹‰å¸¸é‡ç”¨çš„æ˜¯ const è€Œä¸æ˜¯ letï¼›ç¬¬ä¸‰ï¼Œå®šä¹‰å¸¸é‡æ—¶å¿…é¡»åŒæ—¶æŒ‡å®šæ•°æ®ç±»å‹ï¼›ç¬¬å››ï¼Œå¸¸é‡å¯ä»¥å®šä¹‰åœ¨ä»»æ„ä½œç”¨èŒƒå›´åŒ…æ‹¬å…¨å±€ä½œç”¨èŒƒå›´ï¼Œè€Œå˜é‡åªèƒ½å®šä¹‰åœ¨å‡½æ•°å†…éƒ¨ï¼›æœ€åï¼Œå¸¸é‡åªèƒ½ç”¨å¸¸é‡è¡¨è¾¾å¼æ¥åˆå§‹åŒ–ï¼Œä¹Ÿå°±æ˜¯å®šä¹‰å¸¸é‡çš„å€¼å¿…é¡»æ˜¯èƒ½å¤Ÿåœ¨ç¼–è¯‘é˜¶æ®µå°±å†³å®šçš„è€Œä¸æ˜¯åœ¨è¿è¡Œæ—¶ã€‚ å®šä¹‰å¸¸é‡çš„ä¾‹å­ï¼š 1const THREE_HOURS_IN_SECONDS: u32 = 60 * 60 * 3; è¿™é‡Œï¼Œå¸¸é‡çš„åç§°æ˜¯ THREE_HOURS_IN_SECONDSï¼Œå…¶å€¼ä¸º 60 ä¹˜ä»¥ 60 ä¹˜ä»¥ 3ã€‚Rust ä¸­å‘½åå¸¸é‡çš„ä¹ æƒ¯æ˜¯ç”¨å…¨å¤§å†™å­—ç¬¦å’Œä¸‹åˆ’çº¿ã€‚ åœ¨æ•´ä¸ªç¨‹åºçš„è¿è¡ŒæœŸé—´ï¼Œå¸¸é‡åœ¨å…¶å®šä¹‰çš„ä½œç”¨èŒƒå›´ä¸­éƒ½æ˜¯æœ‰æ•ˆçš„ã€‚è¿™æ ·å½“æˆ‘ä»¬éœ€è¦åœ¨ç¨‹åºçš„å¤šä¸ªéƒ¨åˆ†éƒ½ä½¿ç”¨åŒä¸€ä¸ªå€¼æ—¶ï¼Œä½¿ç”¨å¸¸é‡å°±ä¼šå¾ˆæ–¹ä¾¿ï¼Œå¹¶åˆ‡å«ä¹‰ä¸€è‡´ã€‚ å˜é‡é®è”½å½“å®šä¹‰åä¸€ä¸ªå˜é‡æ—¶ä½¿ç”¨å‰ä¸€ä¸ªå˜é‡çš„åç§°ï¼Œæˆ‘ä»¬å°±è¯´åä¸€ä¸ªå˜é‡é®è”½ï¼ˆshadowï¼‰äº†å‰ä¸€ä¸ªå˜é‡ã€‚å¯¹äºç¼–è¯‘å™¨æ¥è¯´åœ¨æ­¤ä¹‹åå®ƒå°±åªä¼šçœ‹åˆ°ç¬¬äºŒä¸ªå˜é‡ã€‚é‚£ä»€ä¹ˆæ—¶å€™è¿™ä¸ªä½œç”¨ä¼šæ¶ˆå¤±å‘¢ï¼Ÿé‚£å°±æœ‰ 2 ç§æƒ…å†µï¼Œç¬¬ä¸€ï¼Œç¬¬äºŒä¸ªå˜é‡ç»§ç»­è¢«ç¬¬ä¸‰ä¸ªå˜é‡é®è”½ï¼›ç¬¬äºŒï¼Œç¬¬äºŒä¸ªå˜é‡çš„ä½œç”¨åŸŸç»“æŸã€‚ 123456789101112fn main() &#123; let x = 5; let x = x + 1; &#123; let x = x * 2; println!(&quot;The value of x in the inner scope is: &#123;x&#125;&quot;); &#125; println!(&quot;The value of x is: &#123;x&#125;&quot;);&#125; ä¸Šé¢è¿™æ®µä»£ç ï¼Œæˆ‘ä»¬é¦–å…ˆç»‘å®š x åˆ° 5 ä¸Šï¼Œç„¶åé‡å¤ç”¨ let x = åˆ›å»ºäº†ä¸€ä¸ªæ–°å˜é‡ xï¼Œæ­¤æ—¶çš„ x é®è”½äº†ä¹‹å‰çš„ xã€‚åŒæ—¶ç»‘å®šåˆ°å€¼ 5 + 1 ä¹Ÿå°±æ˜¯ 6ã€‚åœ¨èŠ±æ‹¬å·å†…éƒ¨ï¼Œæˆ‘ä»¬ç»§ç»­åˆ›å»ºç¬¬ä¸‰ä¸ªæ–°å˜é‡ xï¼Œç»‘å®šå€¼åˆ° 6 * 2 ä¹Ÿå°±æ˜¯ 12ï¼ŒåŒæ—¶é®è”½äº†ç¬¬ä¸€å’Œç¬¬äºŒä¸ª xï¼Œå½“èŠ±æ‹¬å·ç»“æŸåï¼Œç¬¬ä¸‰ä¸ª x è¶…å‡ºä½œç”¨åŸŸï¼Œäºæ˜¯é®è”½å¤±æ•ˆï¼Œç¼–è¯‘å™¨å°±çœ‹åˆ°äº†ç¬¬äºŒä¸ª xï¼Œå…¶å€¼å°±æ˜¯ 6ã€‚ è¿è¡Œè¿™æ®µä»£ç ï¼Œç»“æœå°±æ˜¯ï¼š 123456$ cargo run Compiling variables v0.1.0 (file:///projects/variables) Finished `dev` profile [unoptimized + debuginfo] target(s) in 0.31s Running `target/debug/variables`The value of x in the inner scope is: 12The value of x is: 6 å’Œ mut ä¸åŒçš„æ˜¯ï¼Œå¦‚æœæˆ‘ä»¬æ„å¤–ç»™ x é‡æ–°èµ‹å€¼ï¼Œè€Œæ²¡æœ‰ç”¨ let æ¥é®è”½ï¼Œé‚£ä¹ˆç¼–è¯‘å™¨å°±ä¼šæŠ¥é”™ï¼Œå› ä¸º x æ˜¯ä¸å¯ä¿®æ”¹çš„ã€‚å¦å¤–ä¸€ç‚¹æ˜¯ï¼Œå› ä¸ºæˆ‘ä»¬å®é™…ä¸Šæ˜¯åˆ›å»ºä¸€ä¸ªæ–°çš„å˜é‡ x æ‰€ä»¥ç¬¬äºŒä¸ª x çš„ç±»å‹æ˜¯å¯ä»¥å’Œç¬¬ä¸€ä¸ª x ä¸ä¸€æ ·çš„ï¼Œä¾‹å¦‚ï¼š 12let spaces = &quot; &quot;;let spaces = spaces.len(); æ•°æ®ç±»å‹åœ¨ Rust ä¸­çš„æ¯ä¸€ä¸ªå€¼éƒ½æœ‰ä¸€ä¸ªç‰¹å®šçš„ç±»å‹ï¼Œè¿™æ · Rust å°±çŸ¥é“å¦‚æœå¤„ç†è¿™ä¸ªå€¼ã€‚åœ¨ Rust ä¸­ï¼ŒåŸºæœ¬æ•°æ®ç±»å‹å¯ä»¥åˆ†ä¸º 2 ç§ï¼šæ ‡é‡å’Œå¤åˆç±»å‹ã€‚ Rust æ˜¯ä¸€é—¨é™æ€ç±»å‹è¯­è¨€ï¼Œè¿™è¡¨ç¤ºå¿…é¡»åœ¨ç¼–è¯‘é˜¶æ®µå°±çŸ¥é“æ‰€æœ‰å˜é‡çš„ç±»å‹ã€‚Rust ç¼–è¯‘å™¨åŒæ—¶ä¹Ÿå¾ˆå¼ºå¤§ï¼Œå¯ä»¥åœ¨ç¼–è¯‘çš„æ—¶å€™é€šè¿‡å˜é‡çš„å€¼ä»¥åŠæˆ‘ä»¬rå¦‚ä½•ä½¿ç”¨å˜é‡æ¥æ¨æ–­å…¶ç±»å‹ã€‚å½“é‡åˆ°ä¸€ä¸ªå€¼å¯èƒ½ä¼šå‡ºç°å¤šç§ç±»å‹æ—¶ï¼Œä¾‹å¦‚ï¼Œå°†å­—ç¬¦ä¸²è½¬æ¢æˆæ•°å­—æ—¶ï¼Œå¾—åˆ°çš„ç»“æœå¯èƒ½æ˜¯å¾ˆå¤šç±»å‹ï¼ˆi32ï¼Œu32ç­‰ï¼‰ï¼Œæ­¤æ—¶æˆ‘ä»¬å°±å¿…é¡»æ˜¾ç¤ºæ ‡è®°å˜é‡ç±»å‹ï¼š 1let guess: u32 = &quot;42&quot;.parse().expect(&quot;Not a number!&quot;); å¦‚æœæ²¡æœ‰æ ‡è®°ç±»å‹ï¼Œé‚£ä¹ˆåœ¨ç¼–è¯‘çš„æ—¶å€™å°±ä¼šæŠ¥é”™ï¼Œæç¤ºæˆ‘ä»¬ç¼–è¯‘å™¨ä¸çŸ¥é“å…·ä½“è¦ä½¿ç”¨å“ªç§ç±»å‹ï¼š 12345678910111213141516$ cargo build Compiling no_type_annotations v0.1.0 (file:///projects/no_type_annotations)error[E0284]: type annotations needed --&gt; src/main.rs:2:9 |2 | let guess = &quot;42&quot;.parse().expect(&quot;Not a number!&quot;); | ^^^^^ ----- type must be known at this point | = note: cannot satisfy `&lt;_ as FromStr&gt;::Err == _`help: consider giving `guess` an explicit type |2 | let guess: /* Type */ = &quot;42&quot;.parse().expect(&quot;Not a number!&quot;); | ++++++++++++For more information about this error, try `rustc --explain E0284`.error: could not compile `no_type_annotations` (bin &quot;no_type_annotations&quot;) due to 1 previous error æ ‡é‡ç±»å‹æ ‡é‡ç±»å‹ç”¨æ¥è¡¨ç¤ºå•ä¸ªå€¼ã€‚åœ¨ Rust ä¸­æœ‰ 4 ç§åŸºæœ¬çš„æ ‡é‡ç±»å‹ï¼šæ•´å‹ã€æµ®ç‚¹å‹ã€å¸ƒå°”å‹ä»¥åŠå­—ç¬¦ã€‚ æ•´å‹æ•´å‹æ˜¯ä¸å¸¦å°æ•°çš„æ•°å­—ã€‚ä¸‹è¡¨ä¸­åˆ—å‡ºäº† Rust ä¸­è‡ªå¸¦çš„æ‰€æœ‰æ•´å‹ç±»å‹ï¼š Length Signed Unsigned 8-bit i8 u8 16-bit i16 u16 32-bit i32 u32 64-bit i64 u64 128-bit i128 u128 architecture dependent isize usize å…¶ä¸­ï¼Œisizeã€usize ç±»å‹ä¾èµ–äºç¨‹åºè¿è¡Œçš„ç”µè„‘ä¸Šçš„ CPU æ¶æ„ã€‚ä¾‹å¦‚ CPU æ˜¯ 64bit çš„é‚£ä¹ˆå®ƒä»¬çš„å¤§å°å°±æ˜¯ 64 ä½ã€‚ åœ¨ç¨‹åºä¸­ä¹¦å†™æ•´å‹å¯ä»¥ä½¿ç”¨ä»¥ä¸‹æ ¼å¼ä¸­çš„ä»»ä¸€ç§ï¼š Number literals Example Decimal 98_222 Hex 0xff Octal 0o77 Binary 0b1111_0000 Byte(u8 only) bâ€™Aâ€™ è¿˜èƒ½åœ¨æ•°å­—å­—é¢å€¼çš„åé¢åŠ ä¸Šåç¼€ï¼Œä¾‹å¦‚ 57u8ï¼Œå»æŒ‡å®šç±»å‹ã€‚ æµ®ç‚¹å‹Rust ä¹Ÿæœ‰ 2 ä¸­åŸºæœ¬çš„æµ®ç‚¹æ•°ç±»å‹ï¼šf32 å’Œ f64ã€‚ 12345fn main() &#123; let x = 2.0; // f64 let y: f32 = 3.0; // f32&#125; æµ®ç‚¹æ•°éµå¾ª IEEE-754 æ ‡å‡†ã€‚ æ•°å­—è¿ç®—Rust æ”¯æŒæ‰€æœ‰åŸºæœ¬çš„æ•°å­¦è¿è¡Œæ“ä½œï¼šåŠ å‡ä¹˜é™¤ä»¥åŠå–ä½™ã€‚æ•´æ•°é™¤æ³•ä¼šä¸¢æ‰å•†çš„å°æ•°éƒ¨åˆ†ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªåšæ•°å­¦è¿ç®—çš„ä¾‹å­ï¼š 1234567891011121314151617fn main() &#123; // addition let sum = 5 + 10; // subtraction let difference = 95.5 - 4.3; // multiplication let product = 4 * 30; // division let quotient = 56.7 / 32.2; let truncated = -5 / 3; // Results in -1 // remainder let remainder = 43 % 5;&#125; å¸ƒå°”å‹å’Œå¤§å¤šæ•°å…¶ä»–ç¼–ç¨‹è¯­è¨€ä¸€æ ·ï¼Œåœ¨ Rust ä¸­å¸ƒå°”ç±»å‹æœ‰ 2 ç§å¯èƒ½çš„å€¼ï¼štrue ä»¥åŠ falseã€‚å¸ƒå°”å€¼åœ¨å¤§å°ä¸Šå ç”¨ä¸€ä¸ªå­—èŠ‚ã€‚åœ¨ Rust ä¸­ç”¨ bool è¡¨ç¤ºå¸ƒå°”å‹ï¼š 12345fn main() &#123; let t = true; let f: bool = false; // with explicit type annotation&#125; ä¸»è¦ä½¿ç”¨å¸ƒå°”å‹å€¼çš„åœºæ™¯æ˜¯æ¡ä»¶åˆ¤æ–­ï¼Œæ¯”å¦‚åœ¨ if è¡¨è¾¾å¼ä¸­ä½¿ç”¨ã€‚ å­—ç¬¦ç±»å‹Rust çš„å­—ç¬¦ç±»å‹æ˜¯è¯­è¨€ä¸­æœ€åŸºæœ¬çš„å­—æ¯ç±»å‹ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›å­—ç¬¦ç±»å‹å˜é‡çš„ç¤ºä¾‹ï¼š 12345fn main() &#123; let c = &#x27;z&#x27;; let z: char = &#x27;â„¤&#x27;; // with explicit type annotation let heart_eyed_cat = &#x27;ğŸ˜»&#x27;;&#125; è¿™é‡Œï¼Œæˆ‘ä»¬ä½¿ç”¨å•å¼•å·æŒ‡å®š char å­—é¢é‡ï¼Œè€Œå­—ç¬¦ä¸²å­—é¢é‡åˆ™ä½¿ç”¨åŒå¼•å·ã€‚Rust çš„ char ç±»å‹å¤§å°ä¸º 4 ä¸ªå­—èŠ‚ï¼Œè¡¨ç¤º Unicode æ ‡é‡å€¼ï¼Œè¿™æ„å‘³ç€å®ƒä¸ä»…å¯ä»¥è¡¨ç¤º ASCII ç ï¼Œè¿˜å¯ä»¥è¡¨ç¤ºå¾ˆå¤šå…¶ä»–å­—ç¬¦ã€‚åœ¨ Rust ä¸­ï¼Œé‡éŸ³å­—æ¯ã€ä¸­æ–‡ã€æ—¥æ–‡å’ŒéŸ©æ–‡å­—ç¬¦ã€è¡¨æƒ…ç¬¦å·å’Œé›¶å®½åº¦ç©ºæ ¼éƒ½æ˜¯æœ‰æ•ˆçš„å­—ç¬¦å€¼ã€‚Unicode æ ‡é‡å€¼çš„èŒƒå›´ä¸º U+0000 è‡³ U+D7FF å’Œ U+E000 è‡³ U+10FFFFï¼ˆå«ï¼‰ã€‚ä¸è¿‡ï¼Œâ€œå­—ç¬¦â€åœ¨ Unicode ä¸­å¹¶ä¸æ˜¯ä¸€ä¸ªçœŸæ­£çš„æ¦‚å¿µï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨ç›´è§‰ä¸Šå¯¹â€œå­—ç¬¦â€çš„ç†è§£å¯èƒ½ä¸ Rust ä¸­çš„å­—ç¬¦ä¸ä¸€è‡´ã€‚æˆ‘ä»¬å°†åœ¨åé¢è¯¦ç»†è®¨è®ºè¿™ä¸ªé—®é¢˜ã€‚ å¤åˆç±»å‹å¤åˆç±»å‹å¯ä»¥å°†å¤šä¸ªå€¼ç»„åˆåœ¨ä¸€ä¸ªç±»å‹ä¸­ã€‚Rust ä¸­æœ‰ 2 ä¸ªåŸºæœ¬çš„å¤åˆç±»å‹ï¼šå…ƒç»„å’Œæ•°ç»„ï¼ˆtuple and arrayï¼‰ã€‚ å…ƒç»„å…ƒç»„ç”¨äºå°†ä¸åŒç±»å‹çš„å€¼æ”¾åœ¨ä¸€èµ·ç»„åˆæˆä¸€ä¸ªç±»å‹ã€‚å…ƒç»„å…·æœ‰å›ºå®šé•¿åº¦ï¼Œä¹Ÿå°±æ˜¯ä¸€æ—¦å®šä¹‰å®ƒçš„å¤§å°å°±ä¸èƒ½æ”¹å˜ã€‚ å®šä¹‰å…ƒç»„å¯ä»¥ç”¨ä»¥ä¸‹æ–¹å¼ï¼š 123fn main() &#123; let tup: (i32, f64, u8) = (500, 6.4, 1);&#125; å°†ä¸åŒç±»å‹åœ¨åœ†æ‹¬å·ä¸­ç”¨é€—å·éš”å¼€ã€‚ç±»å‹å¯ä»¥ç›¸åŒä¹Ÿå¯ä»¥ä¸åŒã€‚ ä¸Šé¢å®šä¹‰çš„ tup å˜é‡ç»‘å®šåˆ°æ•´ä¸ªå…ƒç»„ï¼Œå› ä¸ºå…ƒç»„è¢«è§†ä¸ºå•ä¸ªå…ƒç´ ã€‚å¦‚æœæƒ³è·å–å…ƒç»„ä¸­çš„å•ä¸ªå€¼ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨æ¨¡å¼åŒ¹é…æ¥å–æ¶ˆå…ƒç»„ç»„åˆï¼š 1234567fn main() &#123; let tup = (500, 6.4, 1); let (x, y, z) = tup; println!(&quot;The value of y is: &#123;y&#125;&quot;);&#125; æˆ‘ä»¬è¿˜èƒ½ç›´æ¥é€šè¿‡ . åé¢è·Ÿä¸Šä¸€ä¸ªç´¢å¼•å€¼æ¥è®¿é—®å¯¹åº”çš„å€¼ï¼š 123456789fn main() &#123; let x: (i32, f64, u8) = (500, 6.4, 1); let five_hundred = x.0; let six_point_four = x.1; let one = x.2;&#125; ä¸åŒ…å«ä»»ä½•å€¼çš„å…ƒç»„å…·æœ‰ç‰¹åˆ«çš„å«ä¹‰ï¼Œç§°ä¸º unitã€‚å®ƒçš„å€¼ä»¥åŠç±»å‹éƒ½å†™ä½œ () ç”¨æ¥è¡¨ç¤ºä¸€ä¸ªç©ºå€¼æˆ–è€…ç©ºå›è¿”ç±»å‹ã€‚ä»»ä½•è¡¨è¾¾å¼å¦‚æœä¸è¿”å›å…¶ä»–ä»»ä½•å€¼é‚£ä¹ˆå®ƒå°±éšå¼è¿”å› unit å€¼ã€‚ æˆ‘ä»¬è¿˜å¯ä»¥å•ç‹¬ä¿®æ”¹å¯å˜å…ƒç»„ä¸­çš„ä¸€ä¸ªå€¼ï¼š 12345fn main() &#123; let mut x: (i32, i32) = (1, 2); x.0 = 0; x.1 += 5;&#125; æ•°ç»„å°†å¤šä¸ªå€¼æ”¾åœ¨ä¸€ä¸ªé›†åˆä¸­çš„å¦å¤–ä¸€ç§æ–¹å¼å°±æ˜¯æ•°ç»„ã€‚å’Œå…ƒç»„ä¸åŒçš„æ˜¯ï¼Œåœ¨æ•°ç»„ä¸­çš„æ¯ä¸€ä¸ªå…ƒç´ çš„ç±»å‹å¿…é¡»ç›¸åŒï¼›å’Œéƒ¨åˆ†å…¶ä»–ç¼–ç¨‹è¯­è¨€ä¸­çš„æ•°ç»„ä¸åŒçš„æ˜¯ Rust ä¸­çš„æ•°ç»„æ˜¯å›ºå®šé•¿åº¦çš„ã€‚ æ•°ç»„çš„å€¼ç”¨åœ¨æ–¹æ‹¬å·ä¸­ä»¥é€—å·å°†å„ä¸ªå…ƒç´ åˆ—å‡ºçš„æ–¹å¼å®šä¹‰ï¼š 123fn main() &#123; let a = [1, 2, 3, 4, 5];&#125; å½“æˆ‘ä»¬é‡åˆ°ä»¥ä¸‹åœºæ™¯çš„æ—¶å€™æ•°ç»„å°±å¾ˆæœ‰ç”¨ï¼š å°†ä¸€ç»„æ•°æ®åˆ†é…åœ¨æ ˆä¸Šè€Œä¸æ˜¯å †ä¸Š åœ¨ä½¿ç”¨ä¸€ç»„æ•°æ®æ—¶å¸Œæœ›å®ƒçš„å…ƒç´ ä¸ªæ•°æ˜¯å›ºå®šçš„ æˆ‘ä»¬è¿™æ ·æ¥è¡¨è¾¾æ•°ç»„çš„ç±»å‹ï¼šæ–¹æ‹¬å·é‡Œé¢å…ˆå†™å…ƒç´ ç±»å‹ï¼Œç´§æ¥ç€è·Ÿä¸Šä¸€ä¸ªåˆ†å·ï¼Œæœ€åå†™ä¸Šå…ƒç´ ä¸ªæ•°ï¼š 1let a: [i32; 5] = [1, 2, 3, 4, 5]; åˆå§‹åŒ–ä¸€ä¸ªæ¯ä¸ªå…ƒç´ å€¼éƒ½æ˜¯ç›¸åŒçš„æ•°ç»„å¯ä»¥ç”¨ä¸€ä¸ªç®€ä¾¿å†™æ³•ï¼š 1let a = [3; 5]; è¿™æ ·å†™çš„æ•ˆæœå’Œ let a = [3, 3, 3, 3, 3]; æ˜¯ä¸€æ ·çš„ã€‚ æ•°ç»„å…ƒç´ çš„è®¿é—®å’Œç»å¤§å¤šæ•°ç¼–ç¨‹è¯­è¨€ä¸€è‡´ï¼ŒRust ä¸­æ•°ç»„å…ƒç´ çš„è®¿é—®ä¹Ÿç”¨æ–¹æ‹¬å·é‡Œå†™ä¸Šå…ƒç´ ç´¢å¼•æ¥è¡¨ç¤ºï¼š 123456fn main() &#123; let a = [1, 2, 3, 4, 5]; let first = a[0]; let second = a[1];&#125; æ•°ç»„çš„éæ³•è®¿é—®å½“æˆ‘ä»¬è¶Šç•Œè®¿é—®æ•°ç»„çš„å…ƒç´ åœ¨ Rust ä¸­ä¼šå‘ç”Ÿä»€ä¹ˆå‘¢ï¼Ÿä¸‹é¢è¿™ä¸ªç¨‹åºç¤ºèŒƒäº†è¿™ç§æƒ…å†µï¼š 12345678910111213141516171819202122use std::io;fn main() &#123; let a = [1, 2, 3, 4, 5]; println!(&quot;Please enter an array index.&quot;); let mut index = String::new(); io::stdin() .read_line(&amp;mut index) .expect(&quot;Failed to read line&quot;); let index: usize = index .trim() .parse() .expect(&quot;Index entered was not a number&quot;); let element = a[index]; println!(&quot;The value of the element at index &#123;index&#125; is: &#123;element&#125;&quot;);&#125; è¿™æ®µä»£ç èƒ½ç¼–è¯‘é€šè¿‡ï¼Œä½†æ˜¯åœ¨æ‰§è¡Œç¨‹åºæ—¶ï¼Œå¦‚æœæˆ‘ä»¬æä¾›è¾“å…¥ä¸º 10 çš„æ—¶å€™å°±ä¼šå‘ç”Ÿï¼š 123thread &#x27;main&#x27; panicked at src/main.rs:19:19:index out of bounds: the len is 5 but the index is 10note: run with `RUST_BACKTRACE=1` environment variable to display a backtrace ç¨‹åºåœ¨ç´¢å¼•æ“ä½œä¸­ä½¿ç”¨æ— æ•ˆå€¼æ—¶å‡ºç°è¿è¡Œæ—¶é”™è¯¯ã€‚ç¨‹åºå¸¦ç€é”™è¯¯ä¿¡æ¯é€€å‡ºï¼Œå¹¶ä¸”æ²¡æœ‰æ‰§è¡Œæœ€åçš„ println! å½“ä½ å°è¯•ä½¿ç”¨ç´¢å¼•è®¿é—®å…ƒç´ æ—¶ï¼ŒRust ä¼šæ£€æŸ¥ä½ æŒ‡å®šçš„ç´¢å¼•æ˜¯å¦å°äºæ•°ç»„é•¿åº¦ã€‚å¦‚æœç´¢å¼•å¤§äºæˆ–ç­‰äºæ•°ç»„é•¿åº¦ï¼ŒRust å°±ä¼šè§¦å‘ panic æœºåˆ¶ã€‚è¿™ç§æ£€æŸ¥å¿…é¡»åœ¨è¿è¡Œæ—¶è¿›è¡Œï¼Œå› ä¸ºç¼–è¯‘å™¨ä¸å¯èƒ½æå‰çŸ¥é“ç”¨æˆ·ç¨åè¿è¡Œä»£ç æ—¶ä¼šè¾“å…¥ä»€ä¹ˆå€¼ã€‚ è¿™æ˜¯ Rust å†…å­˜å®‰å…¨åŸåˆ™å‘æŒ¥ä½œç”¨çš„ä¸€ä¸ªä¾‹å­ã€‚åœ¨è®¸å¤šåº•å±‚è¯­è¨€ä¸­ï¼Œè¿™ç§æ£€æŸ¥æ˜¯ä¸å­˜åœ¨çš„ï¼Œå½“ä½ æä¾›äº†ä¸€ä¸ªä¸æ­£ç¡®çš„ç´¢å¼•æ—¶ï¼Œæ— æ•ˆçš„å†…å­˜å°±ä¼šè¢«è®¿é—®ã€‚è€Œ Rust ä¼šç«‹å³é€€å‡ºï¼Œè€Œä¸æ˜¯å…è®¸è®¿é—®å†…å­˜å¹¶ç»§ç»­ï¼Œä»è€Œé˜²æ­¢å‡ºç°è¿™ç§é”™è¯¯ã€‚ å‡½æ•°to be continuedâ€¦","categories":[],"tags":[{"name":"Rust","slug":"Rust","permalink":"https://blog.mahyang.uk/tags/Rust/"}]},{"title":"Rust Journey - Part0","slug":"Rust-Journey-Part-0","date":"2025-07-26T06:06:00.000Z","updated":"2025-07-27T05:06:00.000Z","comments":true,"path":"2025/07/26/Rust-Journey-Part-0/","link":"","permalink":"https://blog.mahyang.uk/2025/07/26/Rust-Journey-Part-0/","excerpt":"Rust Programming language æ˜¯ä¸€ä¸ªç›¸å¯¹å¹´è½»çš„ç¼–ç¨‹è¯­è¨€ï¼ˆå’Œ C æ¯”è¾ƒèµ·æ¥çš„è¯ï¼‰ä¹Ÿæ˜¯ä¸€é—¨æ½œåŠ›åè¶³çš„è¯­è¨€ã€‚ç”šè‡³ä¸èƒ½è¯´æ˜¯â€œæ½œåŠ›â€äº†ï¼Œå› ä¸ºåœ¨äº§ä¸šä¸­å·²ç»æœ‰å¾ˆå¤šåº”ç”¨çš„æ¡ˆä¾‹ï¼Œæ¯”å¦‚æœ€è¿‘çš„ DebConf25 å¤§ä¼šä¸Š Fabian æŒ‡å‡ºï¼ŒDebian Sid ä¸­å¤§çº¦æœ‰ 8% çš„æºç åŒ…è‡³å°‘åŸºäºä¸€ä¸ª librust* åŒ…è¿›è¡Œæ„å»ºï¼›åˆæ¯”å¦‚ Ubuntu æ­£åœ¨ç§¯ææ¢ç´¢å°†åŸºäº Rust ç¼–å†™çš„ uutils ç”¨äºæ›¿æ¢ GNU Core Utilitiesã€‚ å¦å¤–ï¼ŒRust è¯­è¨€æœ¬èº«çš„åŠŸèƒ½å’Œç‰¹æ€§ä¹Ÿè¶‹äºç¨³å®šï¼Œå…¶å·¥å…·é“¾ä¹Ÿç›¸å½“æˆç†Ÿäº†ï¼ŒåŒæ—¶ Rust ç¤¾åŒºä¹Ÿæ˜¯éå¸¸çš„æ´»è·ƒã€‚è¿˜æœ‰å°±æ˜¯ Linus ä¹Ÿæ¯”è¾ƒæ”¯æŒ Rust è¿›å…¥ Linux Kernelï¼ˆè™½ç„¶å¹´åˆçš„æ—¶å€™å‘ç”Ÿäº†å¥½å‡ èµ·æœ‰äº‰è®®çš„äº‹ä»¶ï¼‰ã€‚åŸºäºä»¥ä¸Šï¼Œæˆ‘è§‰å¾—ç°åœ¨æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„å­¦ä¹  Rust çš„æ—¶æœºã€‚","text":"Rust Programming language æ˜¯ä¸€ä¸ªç›¸å¯¹å¹´è½»çš„ç¼–ç¨‹è¯­è¨€ï¼ˆå’Œ C æ¯”è¾ƒèµ·æ¥çš„è¯ï¼‰ä¹Ÿæ˜¯ä¸€é—¨æ½œåŠ›åè¶³çš„è¯­è¨€ã€‚ç”šè‡³ä¸èƒ½è¯´æ˜¯â€œæ½œåŠ›â€äº†ï¼Œå› ä¸ºåœ¨äº§ä¸šä¸­å·²ç»æœ‰å¾ˆå¤šåº”ç”¨çš„æ¡ˆä¾‹ï¼Œæ¯”å¦‚æœ€è¿‘çš„ DebConf25 å¤§ä¼šä¸Š Fabian æŒ‡å‡ºï¼ŒDebian Sid ä¸­å¤§çº¦æœ‰ 8% çš„æºç åŒ…è‡³å°‘åŸºäºä¸€ä¸ª librust* åŒ…è¿›è¡Œæ„å»ºï¼›åˆæ¯”å¦‚ Ubuntu æ­£åœ¨ç§¯ææ¢ç´¢å°†åŸºäº Rust ç¼–å†™çš„ uutils ç”¨äºæ›¿æ¢ GNU Core Utilitiesã€‚ å¦å¤–ï¼ŒRust è¯­è¨€æœ¬èº«çš„åŠŸèƒ½å’Œç‰¹æ€§ä¹Ÿè¶‹äºç¨³å®šï¼Œå…¶å·¥å…·é“¾ä¹Ÿç›¸å½“æˆç†Ÿäº†ï¼ŒåŒæ—¶ Rust ç¤¾åŒºä¹Ÿæ˜¯éå¸¸çš„æ´»è·ƒã€‚è¿˜æœ‰å°±æ˜¯ Linus ä¹Ÿæ¯”è¾ƒæ”¯æŒ Rust è¿›å…¥ Linux Kernelï¼ˆè™½ç„¶å¹´åˆçš„æ—¶å€™å‘ç”Ÿäº†å¥½å‡ èµ·æœ‰äº‰è®®çš„äº‹ä»¶ï¼‰ã€‚åŸºäºä»¥ä¸Šï¼Œæˆ‘è§‰å¾—ç°åœ¨æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„å­¦ä¹  Rust çš„æ—¶æœºã€‚ å­¦ä¹ ä¸€é—¨æ–°è¯­è¨€å½“ç„¶è¦ä»æ­å»ºç¯å¢ƒå¼€å§‹ã€‚æ­£å¥½ä»Šå¹´è´­å…¥ä¸€å° M4 çš„ MacBook Airï¼Œæ‰€ä»¥å°±åœ¨ MacOS çš„ç¯å¢ƒä¸­æ­å»º Rust ç¼–ç¨‹ç¯å¢ƒã€‚ Rust RoverJetBrain æ˜¯ IDE é¢†åŸŸçš„é¾™å¤´ï¼Œä»–å®¶çš„ç³»åˆ—ç¼–ç¨‹ IDE éƒ½éå¸¸çš„å¥½ç”¨ï¼Œä¾‹å¦‚é’ˆå¯¹ C&#x2F;C++ å¼€å‘äººå‘˜æ¨å‡ºçš„ Clionï¼Œé’ˆå¯¹ Go å¼€å‘äººå‘˜çš„ GoLandã€‚è¿™æ¬¡æˆ‘ä½¿ç”¨çš„ Rust Rover ä¹Ÿæ˜¯ä»–å®¶æ¨å‡ºçš„ã€‚æ­£å¥½æœ€è¿‘å…è´¹äº†ï¼ˆä¸ªäººéå•†ä¸šç”¨é€”ï¼‰ï¼Œäºæ˜¯å°è¯•ä¸€ä¸‹ã€‚ ç›´æ¥ä»å®˜æ–¹ç½‘ç«™ä¸‹è½½å³å¯ï¼šRust Roverã€‚Mac ç”¨æˆ·ä¸‹è½½æ—¶æ³¨æ„åŒºåˆ†ä¸€ä¸‹ CPU ç±»å‹ï¼ˆApple silicon &#x2F; Intelï¼‰ã€‚ Rust toolchianå®‰è£… Rust è¯­è¨€çš„å·¥å…·é“¾ä¹Ÿå¾ˆç®€å•ï¼Œæ‰“å¼€ç»ˆç«¯ï¼Œé”®å…¥å¦‚ä¸‹å‘½ä»¤å†æ•²å›è½¦å³å¯ï¼š 1$ curl --proto &#x27;=https&#x27; --tlsv1.2 https://sh.rustup.rs -sSf | sh æ­¤å¤–ï¼Œå¦‚æœ Mac ä¸Šæ²¡æœ‰å®‰è£…è¿‡å¼€å‘å·¥å…·é‚£ä¹ˆéœ€è¦å†æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼š 1$ xcode-select --install å®‰è£…ä¹‹å Mac ä¸Šå°±æœ‰äº† C&#x2F;C++ compiler ä»¥åŠ linker äº†ã€‚Rust çš„å·¥å…·é“¾ä¾èµ–è¿™ä¸ªã€‚ Hello, World!å‡†å¤‡å·¥ä½œåšå¥½ä¹‹åå°±å¯ä»¥å¼€å§‹æˆ‘ä»¬çš„ Rust ä¹‹æ—…äº†ã€‚ åˆ›å»ºä¸€ä¸ªç›®å½•ä»»ä½•ä¸€ä¸ªé¡¹ç›®éƒ½éœ€è¦åˆ›å»ºä¸€ä¸ªç›®å½•ä¾¿äºç®¡ç†æ–‡ä»¶ï¼ŒRust é¡¹ç›®ä¹Ÿä¸ä¾‹å¤–ã€‚è¿™ä¸ªé¡¹ç›®ç›®å½•åœ¨å“ªé‡Œæ— ç®¡ç´§è¦ï¼Œé‡è¦çš„æ˜¯éœ€è¦è¿™æ ·ä¸€ä¸ªç›®å½•ã€‚ æ‰“å¼€ç»ˆç«¯ï¼Œé”®å…¥ï¼š 1234$ mkdir ~/projects$ cd ~/projects$ mkdir hello_world$ cd hello_world ç¼–å†™å¹¶è¿è¡Œç¨‹åºé¦–å…ˆåœ¨ä¸ä½¿ç”¨ IDE çš„æƒ…å†µä¸‹å†™ä¸€ä¸ªç¨‹åºï¼Œå¯ä»¥ç†Ÿæ‚‰ä¸€ä¸‹ç¼–è¯‘ Rust ç¨‹åºçš„æ“ä½œæµç¨‹ã€‚Rust ç¨‹åºæºç æ–‡ä»¶æ€»æ˜¯ç”¨ .rs ç»“å°¾çš„ã€‚ç°åœ¨åˆ›å»ºå¹¶æ‰“å¼€ main.rs æ–‡ä»¶å¹¶è¾“å…¥å¦‚ä¸‹æºç ï¼š 123fn main() &#123; println!(&quot;Hello, world!&quot;);&#125; ä¿å­˜å¹¶å…³é—­æ–‡ä»¶ä¹‹åå›åˆ°ç»ˆç«¯é‡Œï¼Œè¿›å…¥ç›®å½• ~/projects/hello_worldï¼Œè¾“å…¥å¦‚ä¸‹å‘½ä»¤æ¥ç¼–è¯‘å’Œè¿è¡Œç¨‹åºï¼š 123$ rustc main.rs$ ./mainHello, world! åˆ°è¿™é‡Œï¼Œæˆ‘ä»¬å°±ç¼–å†™äº†ç¬¬ä¸€ä¸ª Rust ç¨‹åºã€‚ Rust ç¨‹åºçš„æ„æˆè®©æˆ‘ä»¬æ›´ä»”ç»†åœ°çœ‹ä¸€ä¸‹ â€œHello, world!â€ ç¨‹åºçš„æ„æˆã€‚é¦–å…ˆæ˜¯å¦‚ä¸‹ä»£ç ï¼š 123fn main() &#123;&#125; è¿™å‡ è¡Œå®šä¹‰äº†ä¸€ä¸ªåç§°ä¸º main çš„å‡½æ•°ï¼Œmain å‡½æ•°æ¯”è¾ƒç‰¹æ®Šå®ƒæ˜¯æ¯ä¸ª Rust ç¨‹åºæ‰§è¡Œçš„å…¥å£ã€‚è¿™é‡Œå®šä¹‰çš„ main å‡½æ•°æ²¡æœ‰å½¢å¼å‚æ•°ä»¥åŠè¿”å›å€¼ã€‚å¦‚æœä¸€ä¸ªå‡½æ•°æœ‰å½¢å¼å‚æ•°çš„è¯ï¼Œè¿™äº›å‚æ•°ä¼šå®šä¹‰åœ¨åœ†æ‹¬å·å†…ã€‚ å‡½æ•°çš„å‡½æ•°ä½“è¢«åŒ…å«åœ¨ &#123;&#125; é‡Œã€‚Rust ä¸­è¦æ±‚æ‰€æœ‰çš„å‡½æ•°ä½“éƒ½åŒ…å«åœ¨èŠ±æ‹¬å·å†…ã€‚åŒæ—¶ï¼Œä¸€ä¸ªæ¯”è¾ƒå¥½çš„ç¼–ç é£æ ¼æ˜¯å°†èŠ±æ‹¬å·çš„ç¬¬ä¸€ä¸ªå†™åœ¨å‡½æ•°åçš„åŒä¸€è¡Œï¼Œå¹¶ä¸”éš”å¼€ä¸€ä¸ªç©ºæ ¼ã€‚æ­¤å¤–ï¼Œå¦‚æœæ‡’å¾—å»æ³¨æ„è¿™äº›ç¼–ç é£æ ¼ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨ Rust å·¥å…·é“¾ä¸­è‡ªå¸¦çš„ rustfmt ç¨‹åºæ¥è‡ªåŠ¨è§„èŒƒç¼–ç é£æ ¼ï¼ˆå½“ç„¶ä½¿ç”¨ IDE çš„è¯ï¼ŒIDE åŸºæœ¬éƒ½å¸¦è‡ªåŠ¨ format åŠŸèƒ½ï¼‰ã€‚ æˆ‘ä»¬çš„ç¨‹åºé‡Œï¼Œå‡½æ•°ä½“é‡Œåªæœ‰ä¸€è¡Œä»£ç ï¼š 1println!(&quot;Hello, world!&quot;); è¿™è¡Œä»£ç å°±å®ç°äº†å…¨éƒ¨åŠŸèƒ½â€”â€”æ‰“å°æ–‡å­—åˆ°ç»ˆç«¯è¾“å‡ºä¸Šã€‚è¿™é‡Œè™½ç„¶åªæœ‰ä¸€è¡Œä»£ç ï¼Œä½†æ˜¯å´éœ€è¦æ³¨æ„3ç‚¹ï¼š ç¬¬ä¸€ï¼Œprintln! è°ƒç”¨çš„æ˜¯ Rust çš„å®ï¼Œå¦‚æœ println æ˜¯ä¸ªå‡½æ•°çš„è¯ï¼Œé‚£ä¹ˆè°ƒç”¨å®ƒåº”è¯¥ç›´æ¥ç”¨ printlnï¼ˆæ²¡æœ‰æ„Ÿå¹å·ï¼‰ã€‚ç›®å‰æˆ‘ä»¬åªéœ€è¦çŸ¥é“å®ä¹Ÿæ˜¯ Rust çš„ä»£ç ï¼Œä½†æ˜¯è¿™ç±»ä»£ç æ˜¯é€šè¿‡ç”Ÿæˆä»£ç æ¥æ‹“å±• Rust è¯­æ³•çš„ã€‚è°ƒç”¨å®éœ€è¦ä½¿ç”¨æ„Ÿå¹å·ï¼Œè€Œè°ƒç”¨å‡½æ•°ä¸éœ€è¦ã€‚ ç¬¬äºŒï¼ŒHello, world! æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œæˆ‘ä»¬æŠŠè¿™ä¸ªå­—ç¬¦ä¸²ä½œä¸ºå‚æ•°ä¼ ç»™äº† println!ã€‚ ç¬¬ä¸‰ï¼Œåœ¨è¿™è¡Œçš„ç»“å°¾å¤„ä½¿ç”¨äº†åˆ†å·ï¼Œç”¨äºè¡¨ç¤ºè¡¨è¾¾å¼çš„ç»“æŸä»¥åŠä¸‹ä¸€ä¸ªè¡¨è¾¾å¼çš„å¼€å§‹ã€‚ç»å¤§å¤šæ•°çš„ Rust ä»£ç éƒ½ç”¨åˆ†å·ç»“å°¾ã€‚ å¯¹äºç®€å•çš„ç¨‹åºï¼Œæˆ‘ä»¬ä½¿ç”¨ rustc æ¥ç¼–è¯‘å°±å¤Ÿäº†ï¼Œä½†æ˜¯éšç€é¡¹ç›®çš„å¼€å‘æˆ‘ä»¬éœ€è¦ä¸€ä¸ªå·¥å…·æ¥å¸®åŠ©æˆ‘ä»¬ç®¡ç†å„ç§é€‰é¡¹ç”šè‡³æ˜¯å’Œå…¶ä»–äººå…±åŒå¼€å‘ï¼Œè¿™å°±æ˜¯ Cargo çš„ä½œç”¨ã€‚ä½¿ç”¨å®ƒå¯ä»¥å¸®åŠ©æˆ‘ä»¬å†™å‡º real-world Rust ç¨‹åºã€‚ CargoCargo æ˜¯ä¸€ä¸ªå·¥å…·ç”¨æ¥ç¼–è¯‘ Rust é¡¹ç›®ä»¥åŠè¿›è¡ŒåŒ…ç®¡ç†ã€‚å› ä¸º Cargo å¯ä»¥ç®€åŒ–å¾ˆå¤šæ“ä½œåŒ…æ‹¬ä½†ä¸é™äºä»¥ä¸‹ï¼š ç¼–è¯‘é¡¹ç›®æºç  è‡ªåŠ¨ä¸‹è½½å¹¶ç¼–è¯‘é¡¹ç›®ä¾èµ–çš„åº“ æ‰€ä»¥å‡ ä¹æ‰€æœ‰ Rust ç¨‹åºå‘˜éƒ½ä¼šåœ¨é¡¹ç›®ä¸­ä½¿ç”¨è¿™ä¸ªå·¥å…·ã€‚åƒæˆ‘ä»¬å‰é¢å†™çš„ç®€å•é¡¹ç›®ï¼Œåªèƒ½ç”¨åˆ° Cargo çš„éƒ¨åˆ†åŠŸèƒ½ï¼ˆç¼–è¯‘ï¼‰ï¼Œä½†éšç€é¡¹ç›®çš„é€æ¸å˜å¤§éœ€è¦ç”¨åˆ°ç¬¬ä¸‰æ–¹åº“æ—¶ï¼Œä½¿ç”¨ Cargo å°±èƒ½ç®€åŒ–è¿™ä¸ªè¿‡ç¨‹ã€‚ å‰é¢æˆ‘ä»¬åœ¨å®‰è£… Rust å·¥å…·é“¾ä¸­å·²ç»åŒ…å«äº† Cargoï¼Œå¯ä»¥æ‰§è¡Œä»¥ä¸‹å‘½ä»¤æ¥ç¡®è®¤ï¼š 1$ cargo --version ä½¿ç”¨ Cargo æ¥åˆ›å»ºé¡¹ç›®è¿™æ¬¡æˆ‘ä»¬ç”¨ Cargo æ¥åˆ›å»ºä¸€ä¸ªâ€œHello, world!â€é¡¹ç›®ï¼Œçœ‹çœ‹å’Œå‰æ–‡åˆ›å»ºçš„é¡¹ç›®æœ‰ä»€ä¹ˆä¸ä¸€æ ·ã€‚å›åˆ°æˆ‘ä»¬çš„é¡¹ç›®ç›®å½•ä¸‹ï¼ŒåŒæ—¶æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š 12$ cargo new hello_cargo$ cd hello_cargo ç¬¬ä¸€è¡Œå‘½ä»¤ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„ç›®å½•åå« hello_cargo åŒæ—¶è¿™ä¹Ÿæ˜¯é¡¹ç›®çš„åå­—ï¼ŒCargo ä¼šåœ¨è¿™ä¸ªç›®å½•ä¸‹è‡ªåŠ¨åˆ›å»ºç›¸åº”çš„é¡¹ç›®æ–‡ä»¶ã€‚ è¿›å…¥è¿™ä¸ªç›®å½•å½“ä¸­åŒæ—¶åˆ—å‡ºæ‰€æœ‰çš„æ–‡ä»¶ï¼Œæˆ‘ä»¬ä¼šçœ‹åˆ° Cargo åˆ›å»ºäº† 2 ä¸ªæ–‡ä»¶ä»¥åŠä¸€ä¸ªç›®å½•ï¼š Cargo.toml src src&#x2F;main.rc åŒæ—¶ Cargo ä¼šåˆå§‹åŒ–ä¸€ä¸ª git ä»“åº“ã€‚éœ€è¦æ³¨æ„çš„æ˜¯å¦‚æœæŒ‡å®šçš„ç›®å½•ä¸‹å·²ç»å­˜åœ¨ä¸€ä¸ª git ä»“åº“äº† Cargo å°±ä¸ä¼šæ‰§è¡Œè¿™ä¸ªåŠ¨ä½œã€‚ æ‰“å¼€ Cargo.toml æ–‡ä»¶ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ä»¥ä¸‹å†…å®¹ï¼š 123456[package]name = &quot;hello_cargo&quot;version = &quot;0.1.0&quot;edition = &quot;2024&quot;[dependencies] æ­¤æ–‡ä»¶æ˜¯ Cargo çš„é…ç½®æ–‡ä»¶ï¼Œé‡‡ç”¨ TOML æ–‡ä»¶æ ¼å¼ã€‚[package] æ˜¯é…ç½®æ®µçš„å¤´ï¼Œè¡¨ç¤ºä¹‹åçš„å†…å®¹ç”¨äºé…ç½®æ­¤è½¯ä»¶åŒ…ã€‚åé¢çš„ä¸‰è¡Œè¡¨ç¤ºè¿™ä¸ªè½¯ä»¶åŒ…çš„é…ç½®å†…å®¹ï¼Œä¾‹å¦‚ï¼Œè½¯ä»¶åŒ…çš„åå­—ã€ç‰ˆæœ¬ä¿¡æ¯ä»¥åŠä½¿ç”¨ä»€ä¹ˆç‰ˆæœ¬çš„ rustc æ¥ç¼–è¯‘æºä»£ç ã€‚ æœ€åä¸€ä¸ªè¡Œ [dependencies] è¡¨ç¤ºä¾èµ–æ®µï¼Œæˆ‘ä»¬å¯ä»¥å°†é¡¹ç›®ä¾èµ–çš„å…¶ä»–åŒ…åˆ—åœ¨è¿™é‡Œã€‚åœ¨ Rust ä¸­ä¸€èˆ¬æŠŠè½¯ä»¶åŒ…ç§°ä½œ cratesã€‚ç›®å‰è¿™ä¸ªé¡¹ç›®è¿˜ä¸ä¾èµ–ä»»ä½•è½¯ä»¶åŒ…ï¼Œæ‰€ä»¥è¿™ä¸ªå¯ä»¥ç•™ç©ºã€‚ ç°åœ¨æ‰“å¼€ src/main.rs çœ‹çœ‹ï¼š 123fn main() &#123; println!(&quot;Hello, world!&quot;);&#125; Cargo è‡ªåŠ¨ç”Ÿæˆäº†ä¸€ä¸ªç¨‹åºå’Œæˆ‘ä»¬ä¹‹å‰å†™çš„ä¸€æ¨¡ä¸€æ ·ã€‚åˆ°ç›®å‰ Cargo ç”Ÿæˆçš„é¡¹ç›®å’Œä¹‹å‰çš„é¡¹ç›®ä¸åŒçš„åœ°æ–¹åœ¨äºæºç æ–‡ä»¶ main.rs æ”¾åœ¨äº† src ç›®å½•ä¸­ä»¥åŠå¤šäº†ä¸€ä¸ª .toml æ–‡ä»¶ã€‚ ä½¿ç”¨ Cargo æ¥ç»„ç»‡é¡¹ç›®æ–‡ä»¶çš„è¯ï¼Œæœ€å¥½æŠŠæºä»£ç æ–‡ä»¶éƒ½æ”¾åœ¨ src ç›®å½•ä¸‹ï¼Œè€Œé¡¹ç›®é¡¶å±‚ç›®å½•å¯ä»¥æ”¾ä¸€äº›å’Œæºç æ— å…³çš„æ–‡ä»¶ï¼Œä¾‹å¦‚ï¼šREADMEã€æˆæƒä¿¡æ¯æ–‡ä»¶ã€é…ç½®æ–‡ä»¶ç­‰ã€‚ ç¼–è¯‘å’Œè¿è¡Œ Cargo é¡¹ç›®é€šè¿‡ Cargo æ¥ç¼–è¯‘é¡¹ç›®åªéœ€è¦æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š 123$ cargo build Compiling hello_cargo v0.1.0 (file:///projects/hello_cargo) Finished dev [unoptimized + debuginfo] target(s) in 2.85 secs è¿™æ¡å‘½ä»¤ä¼šç¼–è¯‘å‡ºä¸€ä¸ªå¯æ‰§è¡Œæ–‡ä»¶ target/debug/hello_cargoã€‚å› ä¸ºé»˜è®¤æ˜¯ç¼–è¯‘ debug æ–‡ä»¶ï¼Œæ‰€ä»¥è·¯å¾„æ˜¯ debug ä¸‹ã€‚è¿™ä¸ªæ–‡ä»¶å¯ä»¥ç›´æ¥æ‰§è¡Œï¼š 12$ ./target/debug/hello_cargo # or .\\target\\debug\\hello_cargo.exe on WindowsHello, world! å¯ä»¥çœ‹åˆ°ç»ˆç«¯ä¸­è¾“å‡ºäº†â€œHello, world!â€ã€‚å½“ç¬¬ä¸€æ¬¡æ‰§è¡Œ cargo build æ—¶ï¼ŒCargo ä¼šåˆ›å»ºä¸€ä¸ª Cargo.lock æ–‡ä»¶ï¼Œè¿™ä¸ªæ–‡ä»¶ç”¨äºè®°å½•ç›®å½•ä½¿ç”¨çš„ç¬¬ä¸‰æ–¹åº“çš„ç‰ˆæœ¬ï¼Œæˆ‘ä»¬ä¸ç”¨è‡ªå·±å»ç»´æŠ¤è¿™ä¸ªæ–‡ä»¶ï¼Œäº¤ç»™ Cargo å°±å¥½ã€‚ æˆ‘ä»¬ä¹Ÿå¯ä»¥ç›´æ¥æ‰§è¡Œï¼š 1234$ cargo run Finished dev [unoptimized + debuginfo] target(s) in 0.0 secs Running `target/debug/hello_cargo`Hello, world! æ¥è¿è¡Œç¼–è¯‘ä¹‹åçš„æ–‡ä»¶ã€‚å¯ä»¥çœ‹åˆ°è¿™æ¬¡æ²¡æœ‰ç¼–è¯‘é¡¹ç›¸å…³çš„è¾“å‡ºï¼Œè¿™æ˜¯å› ä¸ºæˆ‘ä»¬æ²¡æœ‰ä¿®æ”¹æºç ï¼ŒCargo åˆ¤æ–­å‡ºä¸éœ€è¦é‡æ–°ç¼–è¯‘ã€‚ä½†æ˜¯å¦‚æœæˆ‘ä»¬ä¿®æ”¹äº†æºç ï¼Œå†æ‰§è¡Œè¿™ä¸ªæ¡å‘½ä»¤çš„è¯ï¼š 12345$ cargo run Compiling hello_cargo v0.1.0 (file:///projects/hello_cargo) Finished dev [unoptimized + debuginfo] target(s) in 0.33 secs Running `target/debug/hello_cargo`Hello, world! Cargo å°±ä¼šé‡æ–°ç¼–è¯‘ä»£ç ä¹‹åå†æ‰§è¡Œç¨‹åºã€‚ å¦å¤–ï¼ŒCargo è¿˜æä¾›äº†ä¸€ä¸ª check å‘½ä»¤ã€‚è¿™ä¸ªå‘½ä»¤çš„ä½œç”¨æ˜¯ç¡®ä¿æºä»£ç æ²¡æœ‰é”™è¯¯å¯ä»¥ç¼–è¯‘é€šè¿‡ï¼Œä½†ä¸ä¼šåˆ›å»ºå¯æ‰§è¡Œæ–‡ä»¶ï¼Œè¿™æ ·å°±æ¯” cargo build è¦æ‰§è¡Œå¾—å¿«ä¸€äº›ã€‚ æ€»ç»“ä¸€ä¸‹ Cargo çš„ç”¨æ³•ï¼š åˆ›å»ºé¡¹ç›®ç”¨ï¼šcargo new ç¼–è¯‘é¡¹ç›®ç”¨ï¼šcargo build ç¼–è¯‘å¹¶è¿è¡Œé¡¹ç›®ç”¨ï¼šcargo run ç¡®ä¿é¡¹ç›®æ²¡æœ‰é”™è¯¯ç”¨ï¼šcargo check ç¼–è¯‘ Release ç›®æ ‡æ–‡ä»¶å½“é¡¹ç›®æœ€åéœ€è¦é‡Šæ”¾äº†ï¼Œå°±å¯ä»¥ä½¿ç”¨ cargo build --release æ¥ç¼–è¯‘ç›®æ ‡æ–‡ä»¶ï¼Œè¿™ä¸ªå‘½ä»¤ä¼šéœ€è¦æ›´å¤šçš„æ—¶é—´æ¥æ‰§è¡Œï¼Œä½†æ˜¯ä¼šä¼˜åŒ–ä»£ç ä½¿å¾—æœ€ç»ˆçš„å¯æ‰§è¡Œæ–‡ä»¶è¿è¡Œæ•ˆç‡æ›´é«˜ã€‚åŒæ—¶è¿™ä¸ªå¯æ‰§è¡Œæ–‡ä»¶åœ¨ç›®å½• target&#x2F;release ä¸­ã€‚","categories":[],"tags":[{"name":"Rust","slug":"Rust","permalink":"https://blog.mahyang.uk/tags/Rust/"}]},{"title":"å¦‚ä½•åœ¨ WSL ä¸­è®¿é—® U ç›˜","slug":"å¦‚ä½•åœ¨-WSL-ä¸­è®¿é—®-U-ç›˜","date":"2023-09-17T02:14:11.000Z","updated":"2023-09-17T02:14:11.000Z","comments":true,"path":"2023/09/17/å¦‚ä½•åœ¨-WSL-ä¸­è®¿é—®-U-ç›˜/","link":"","permalink":"https://blog.mahyang.uk/2023/09/17/%E5%A6%82%E4%BD%95%E5%9C%A8-WSL-%E4%B8%AD%E8%AE%BF%E9%97%AE-U-%E7%9B%98/","excerpt":"åœ¨ WSL ä¸­å¯ä»¥é€šè¿‡ /mnt/ ç›®å½•å¾ˆæ–¹ä¾¿åœ°è®¿é—® Windows ä¸»æœºçš„æ–‡ä»¶ç³»ç»Ÿï¼Œä½†æ˜¯å¦‚æœæˆ‘ä»¬ PC ä¸Šæ¥ U ç›˜ï¼Œè¿™ä¸ª U ç›˜åªèƒ½åœ¨ Windows ç³»ç»Ÿé‡Œè®¿é—®è€Œä¸èƒ½åœ¨ WSL é‡Œè®¿é—®ã€‚å¦‚æœæƒ³è¦åœ¨ WSL ä¸­ä½¿ç”¨ dd å‘½ä»¤è¯»å†™ U ç›˜æˆ–è€…æŒ‚è½½ U ç›˜åˆ° WSL ç³»ç»Ÿï¼Œåˆ™éœ€è¦è®© USB è®¾å¤‡è¿æ¥åˆ° WSLï¼Œä½†æ˜¯é»˜è®¤æƒ…å†µä¸‹ WSL ä¸æ”¯æŒè¿™ç§æ“ä½œæ‰€ä»¥æˆ‘ä»¬éœ€è¦å¯¹ WSL è¿›è¡Œä¸€äº›ä¿®æ”¹ã€‚","text":"åœ¨ WSL ä¸­å¯ä»¥é€šè¿‡ /mnt/ ç›®å½•å¾ˆæ–¹ä¾¿åœ°è®¿é—® Windows ä¸»æœºçš„æ–‡ä»¶ç³»ç»Ÿï¼Œä½†æ˜¯å¦‚æœæˆ‘ä»¬ PC ä¸Šæ¥ U ç›˜ï¼Œè¿™ä¸ª U ç›˜åªèƒ½åœ¨ Windows ç³»ç»Ÿé‡Œè®¿é—®è€Œä¸èƒ½åœ¨ WSL é‡Œè®¿é—®ã€‚å¦‚æœæƒ³è¦åœ¨ WSL ä¸­ä½¿ç”¨ dd å‘½ä»¤è¯»å†™ U ç›˜æˆ–è€…æŒ‚è½½ U ç›˜åˆ° WSL ç³»ç»Ÿï¼Œåˆ™éœ€è¦è®© USB è®¾å¤‡è¿æ¥åˆ° WSLï¼Œä½†æ˜¯é»˜è®¤æƒ…å†µä¸‹ WSL ä¸æ”¯æŒè¿™ç§æ“ä½œæ‰€ä»¥æˆ‘ä»¬éœ€è¦å¯¹ WSL è¿›è¡Œä¸€äº›ä¿®æ”¹ã€‚ è‡ªå·±ç¼–è¯‘å†…æ ¸é¦–å…ˆéœ€è¦åšçš„æ˜¯ç¼–è¯‘è‡ªå·±çš„ WSL å†…æ ¸å¹¶ä¸”è®© WSL ä½¿ç”¨æˆ‘ä»¬è‡ªå·±ç¼–è¯‘çš„å†…æ ¸ï¼Œå…·ä½“çš„æ“ä½œæ­¥éª¤å¯å‚è€ƒè¿™ç¯‡ï¼šå¦‚ä½•åœ¨ WSL ä¸­ç¼–è¯‘åŠ è½½å†…æ ¸æ¨¡å—ã€‚ åœ¨ç¼–è¯‘ä¹‹å‰éœ€è¦é€šè¿‡ make menuconfig é…ç½®å†…æ ¸ï¼Œå°† USB å­˜å‚¨ç›¸å…³çš„é©±åŠ¨æ‰“å¼€ï¼š 123Device Drivers ---&gt; USB support ---&gt; USB Mass Storage support å®‰è£… usbipusbip æ˜¯ä¸€ä¸ªæœåŠ¡ç¨‹åºï¼Œå®ƒå¯ä»¥å°† USB åè®®é€šè¿‡ç½‘ç»œè½¬å‘ï¼Œä»è€Œå®ç°å°†ä¸€ä¸ªè®¾å¤‡çš„ USB è®¾å¤‡é€šè¿‡ç½‘ç»œè½¬å‘åˆ°å¦å¤–ä¸€å°è®¾å¤‡ã€‚åŒæ ·æˆ‘ä»¬å¯ä»¥åˆ©ç”¨è¿™ä¸ªç¨‹åºå°† USB è®¾å¤‡ä» Windows ä¸»æœºé€šè¿‡æœ¬åœ°ç½‘ç»œè½¬å‘åˆ° WSL ç³»ç»Ÿã€‚ Windows ä¸Šçš„æ“ä½œæˆ‘ä»¬éœ€è¦å®‰è£… usbipd è¿™ä¸ªæœåŠ¡ï¼Œå¯ä»¥é€šè¿‡ä¸‹è½½å®‰è£…åŒ…çš„æ–¹å¼ï¼Œä¹Ÿå¯ä»¥é€šè¿‡ winget å®‰è£…ï¼Œæˆ‘ä½¿ç”¨åä¸€ç§ï¼š 1winget install usbipd WSL ä¸­çš„æ“ä½œç›´æ¥é€šè¿‡ Ubuntu çš„è½¯ä»¶ä»“åº“å®‰è£…å¹¶å¯ç”¨ usbipï¼š 12sudo apt install linux-tools-generic hwdatasudo update-alternatives --install /usr/local/bin/usbip usbip /usr/lib/linux-tools/*-generic/usbip 20 usbip çš„ä½¿ç”¨Windows ä¸Šçš„æ“ä½œé¦–å…ˆå°† U ç›˜æ’å…¥åˆ° PC ä¸Šï¼Œç„¶åä½¿ç”¨ç®¡ç†å‘˜æƒé™æ‰“å¼€ Windows PowerShellï¼Œè¾“å…¥ä»¥ä¸‹å‘½ä»¤ï¼š åˆ—å‡ºæ‰€æœ‰å¯ç”¨çš„ USB è®¾å¤‡ï¼š 1usbipd wsl list ä¼šå¾—åˆ°ç±»ä¼¼å¦‚ä¸‹è¾“å‡ºï¼š 12345BUSID VID:PID DEVICE STATE1-3 04f2:b569 Integrated Camera Not attached1-4 138a:0011 Synaptics FP Sensors (WBF) (PID=0011) Not attached1-7 8087:0a2a è‹±ç‰¹å°”(R) æ— çº¿ Bluetooth(R) Not attached3-2 05e3:0736 USB å¤§å®¹é‡å­˜å‚¨è®¾å¤‡ Not attached å¯ä»¥çœ‹åˆ° BUSID 3-2 å°±æ˜¯æˆ‘ä»¬çš„ U ç›˜ï¼Œç„¶åå°±å¯ä»¥æŠŠå®ƒåŠ å…¥åˆ° WSL ä¸­äº†ï¼š 1usbipd wsl attach --busid 3-2 WSL ä¸­çš„æ“ä½œä½¿ç”¨ lsusb æŸ¥çœ‹ USB è®¾å¤‡æ˜¯å¦å·²ç»è¿æ¥åˆ°äº† WSL ä¸­ï¼š 1lsusb å¯ä»¥çœ‹åˆ°è¾“å‡ºï¼š 123Bus 002 Device 001: ID 1d6b:0003 Linux Foundation 3.0 root hubBus 001 Device 002: ID 05e3:0736 Genesys Logic, Inc. Colour arc SD Card Reader [PISEN]Bus 001 Device 001: ID 1d6b:0002 Linux Foundation 2.0 root hub è¿™ä¸ª Bus 001 å°±æ˜¯æˆ‘ä»¬çš„ U ç›˜ï¼Œè¯´æ˜å·²ç»æˆåŠŸè¿ä¸Š USB è®¾å¤‡äº†ã€‚ ç„¶åé€šè¿‡ lsblk æŸ¥çœ‹æ˜¯å¦æœ‰æ–°çš„å­˜å‚¨è®¾å¤‡å‡ºç°ï¼š 1lsblk å¯ä»¥çœ‹åˆ°è¾“å‡ºï¼š 12sdd 8:48 1 7.2G 0 diskâ””â”€sdd1 8:49 1 7.2G 0 part è¯´æ˜ USB å­˜å‚¨è®¾å¤‡ä¹ŸæˆåŠŸè¯†åˆ«äº†ã€‚æ¥ä¸‹æ¥æˆ‘ä»¬å°±å¯ä»¥é€šè¿‡ dd å‘½ä»¤è¿›è¡Œé•œåƒçƒ§å†™ï¼Œæˆ–è€…åœ¨ U ç›˜ä¸­å·²ç»æœ‰æ–‡ä»¶ç³»ç»Ÿçš„æƒ…å†µä¸‹ï¼ŒæŒ‚è½½ U ç›˜åˆ° WSL ä»è€Œè¿›è¡Œæ–‡ä»¶è®¿é—®ã€‚ åœ¨ WSL ä¸­ä½¿ç”¨å®Œ U ç›˜ä¹‹åï¼Œæˆ‘ä»¬éœ€è¦å›åˆ° Windows ç³»ç»Ÿå°† U ç›˜å–æ¶ˆè¿æ¥ï¼ŒåŒæ ·åœ¨ powershell ä¸­è¾“å…¥å¦‚ä¸‹å‘½ä»¤ï¼š 1usbipd wsl detach --busid 3-2 å°±å¯ä»¥å–æ¶ˆè¿æ¥ WSLã€‚","categories":[],"tags":[{"name":"WSL","slug":"WSL","permalink":"https://blog.mahyang.uk/tags/WSL/"}]},{"title":"å¦‚ä½•åœ¨ WSL ä¸­ç¼–è¯‘åŠ è½½å†…æ ¸æ¨¡å—","slug":"å¦‚ä½•åœ¨-WSL-ä¸­ç¼–è¯‘åŠ è½½å†…æ ¸æ¨¡å—","date":"2023-09-16T12:20:28.000Z","updated":"2023-09-17T01:20:28.000Z","comments":true,"path":"2023/09/16/å¦‚ä½•åœ¨-WSL-ä¸­ç¼–è¯‘åŠ è½½å†…æ ¸æ¨¡å—/","link":"","permalink":"https://blog.mahyang.uk/2023/09/16/%E5%A6%82%E4%BD%95%E5%9C%A8-WSL-%E4%B8%AD%E7%BC%96%E8%AF%91%E5%8A%A0%E8%BD%BD%E5%86%85%E6%A0%B8%E6%A8%A1%E5%9D%97/","excerpt":"Windows ç³»ç»Ÿä¸­é›†æˆçš„ WSL å­ç³»ç»Ÿéå¸¸å¥½ç”¨ï¼Œç‰¹åˆ«æ˜¯åˆ°äº† WSL2 è¿™ä¸ªç‰ˆæœ¬ï¼Œé…åˆ Ubuntu å‘è¡Œç‰ˆå¯ä»¥åº”ä»˜ç»å¤§å¤šæ•°å·¥ä½œéœ€æ±‚ã€‚ä½†æ˜¯è¿™ä¸ªç³»ç»Ÿä¸­ä½¿ç”¨çš„å†…æ ¸æ˜¯å¾®è½¯æä¾›çš„ï¼Œä¸å…è®¸åŠ è½½å†…æ ¸æ¨¡å—ï¼Œå¯¼è‡´è‡ªå·±ç¼–è¯‘çš„æ¨¡å—æ— æ³•ä½¿ç”¨ã€‚å¦‚æœæƒ³è¦åŠ è½½å†…æ ¸æ¨¡å—åˆ™éœ€è¦è‡ªå·±ç¼–è¯‘å†…æ ¸ä¾› WSL ä½¿ç”¨ã€‚","text":"Windows ç³»ç»Ÿä¸­é›†æˆçš„ WSL å­ç³»ç»Ÿéå¸¸å¥½ç”¨ï¼Œç‰¹åˆ«æ˜¯åˆ°äº† WSL2 è¿™ä¸ªç‰ˆæœ¬ï¼Œé…åˆ Ubuntu å‘è¡Œç‰ˆå¯ä»¥åº”ä»˜ç»å¤§å¤šæ•°å·¥ä½œéœ€æ±‚ã€‚ä½†æ˜¯è¿™ä¸ªç³»ç»Ÿä¸­ä½¿ç”¨çš„å†…æ ¸æ˜¯å¾®è½¯æä¾›çš„ï¼Œä¸å…è®¸åŠ è½½å†…æ ¸æ¨¡å—ï¼Œå¯¼è‡´è‡ªå·±ç¼–è¯‘çš„æ¨¡å—æ— æ³•ä½¿ç”¨ã€‚å¦‚æœæƒ³è¦åŠ è½½å†…æ ¸æ¨¡å—åˆ™éœ€è¦è‡ªå·±ç¼–è¯‘å†…æ ¸ä¾› WSL ä½¿ç”¨ã€‚ ç¼–è¯‘ WSL å†…æ ¸æˆ‘ä»¬å¯ä»¥ä»å¾®è½¯çš„å¼€æºä»“åº“ä¸­æ‹‰å–æœ€æ–°çš„å†…æ ¸æºç ï¼Œç„¶åè‡ªå·±ç¼–è¯‘å†…æ ¸ã€‚ æ‹‰å–æºç ï¼š 1git clone https://github.com/microsoft/WSL2-Linux-Kernel.git é…ç½®å†…æ ¸ï¼š è¿™é‡Œç›´æ¥ä½¿ç”¨å¾®è½¯çš„é»˜è®¤é…ç½®ï¼š 1mv Microsoft/config-wsl ./.config ç¼–è¯‘ï¼š 1make -j8 WSL å¯åŠ¨æ–°ç¼–è¯‘å†…æ ¸å°†æ–°ç¼–è¯‘å¥½çš„å†…æ ¸æ‹·è´åˆ°ä»»æ„ä½ç½®ï¼š 1cp arch/x86_64/boot/bzImage /mnt/c/Users/uklar/ åœ¨å¯åŠ¨ WSL çš„ç”¨æˆ·çš„æ ¹ç›®å½•ä¸­åˆ›å»º WSL é…ç½®æ–‡ä»¶ï¼š 1touch /mnt/c/Users/uklar/.wslconfig åŒæ—¶å°†å¦‚ä¸‹å†…å®¹å†™å…¥é…ç½®æ–‡ä»¶ï¼š 12[wsl2]kernel=C:\\\\Users\\\\uklar\\\\bzImage è¿™é‡Œçš„é…ç½®å°±æ˜¯æŒ‡å®š WSL å¯åŠ¨ä½¿ç”¨çš„å†…æ ¸ã€‚ å…³é—­ WSL å†å¯åŠ¨ï¼Œä»¥ç”Ÿæ•ˆæ›´æ”¹ï¼š 1wsl --shutdown æµ‹è¯•hello.c ç¨‹åºï¼š 12345678910111213141516171819#include &lt;linux/init.h&gt;#include &lt;linux/module.h&gt;#include &lt;linux/printk.h&gt;static int __init hello_init(void)&#123; pr_info(&quot;Hello, world\\n&quot;); return 0;&#125;static void __exit hello_exit(void)&#123; pr_info(&quot;Goodbye, world\\n&quot;);&#125;module_init(hello_init);module_exit(hello_exit);MODULE_LICENSE(&quot;GPL&quot;); Makefileï¼š 123456789obj-m += hello.oPWD := $(CURDIR)all: make -C /home/uklar/WSL2-Linux-Kernel M=$(PWD) modulesclean: make -C /home/uklar/WSL2-Linux-Kernel M=$(PWD) clean æ³¨æ„ï¼šè¿™é‡Œè¦ä½¿ç”¨è‡ªå·±ä¸‹è½½çš„å†…æ ¸æºç çš„è·¯å¾„ã€‚ ç¼–è¯‘ï¼š 1make æ­¤æ—¶æˆ‘ä»¬ä¼šå¾—åˆ° hello.ko ä½¿ç”¨ sudo insmod hello.ko æµ‹è¯•æ˜¯å¦å¯ä»¥åŠ è½½æ¨¡å—ï¼Œåœ¨ dmesg å‘½ä»¤çš„è¾“å‡ºä¸­æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼š 1[11114.649475] Hello, world è¯´æ˜æ­¤æ—¶å†…æ ¸æ¨¡å—å·²ç»æˆåŠŸåŠ è½½äº†ã€‚","categories":[],"tags":[{"name":"WSL","slug":"WSL","permalink":"https://blog.mahyang.uk/tags/WSL/"},{"name":"Kernel Module","slug":"Kernel-Module","permalink":"https://blog.mahyang.uk/tags/Kernel-Module/"}]},{"title":"å¤ç›˜ä¸€é“é¢è¯•ç®—æ³•é¢˜","slug":"å¤ç›˜ä¸€é“é¢è¯•ç®—æ³•é¢˜","date":"2023-06-08T14:02:40.000Z","updated":"2023-06-08T14:02:40.000Z","comments":true,"path":"2023/06/08/å¤ç›˜ä¸€é“é¢è¯•ç®—æ³•é¢˜/","link":"","permalink":"https://blog.mahyang.uk/2023/06/08/%E5%A4%8D%E7%9B%98%E4%B8%80%E9%81%93%E9%9D%A2%E8%AF%95%E7%AE%97%E6%B3%95%E9%A2%98/","excerpt":"æœ€è¿‘é¢è¯•ä¸€ä¸ªå¼€å‘å²—ä½ï¼Œé‡åˆ°ä¸€é“ç®—æ³•é¢˜ï¼Œç°åœºæˆ‘åªç»™å‡ºäº†æ€è·¯ï¼Œæ²¡èƒ½åœ¨è§„å®šæ—¶é—´é‡Œå†™å‡ºä»£ç ä¹Ÿå°±æ²¡æ³•ç°åœºéªŒè¯ï¼Œåœ¨è¿™é‡Œå¤ç›˜ä¸€ä¸‹ã€‚","text":"æœ€è¿‘é¢è¯•ä¸€ä¸ªå¼€å‘å²—ä½ï¼Œé‡åˆ°ä¸€é“ç®—æ³•é¢˜ï¼Œç°åœºæˆ‘åªç»™å‡ºäº†æ€è·¯ï¼Œæ²¡èƒ½åœ¨è§„å®šæ—¶é—´é‡Œå†™å‡ºä»£ç ä¹Ÿå°±æ²¡æ³•ç°åœºéªŒè¯ï¼Œåœ¨è¿™é‡Œå¤ç›˜ä¸€ä¸‹ã€‚ é¢˜ç›®åªèƒ½å›å¿†èµ·éƒ¨åˆ†å†…å®¹ï¼Œå¤§è‡´æ˜¯ï¼Œä»ä¸€ä¸ªç»™å®šçš„å­—ç¬¦ä¸²ä¸­æ‰¾å‡ºæœ€é•¿çš„é‡å¤çš„å­ä¸²ã€‚ åˆ†æå‡å®šè¾“å…¥å­—ç¬¦ä¸²æ˜¯ asdfddfbiibhddf234ï¼Œé•¿åº¦ä¸º 18 ä¸ªå­—ç¬¦ã€‚ å­ä¸²ï¼šé•¿åº¦è‡³å°‘è¦ä¸º 1 ä¸ªå­—ç¬¦ï¼Œæœ€å¤§ 17 ä¸ªå­—ç¬¦ã€‚ é‡å¤å­ä¸²ï¼šå½“ç¡®å®šä»¥ä¸€ä¸ªå­ä¸²ï¼Œå¦‚ä»¥ asd ä¸ºç›®æ ‡å¯»æ‰¾é‡å¤å­ä¸²ï¼Œé‚£ä¹ˆå¯»æ‰¾çš„èŒƒå›´å¿…é¡»æ˜¯è¾“å…¥å­—ç¬¦ä¸²ä¸­ a å­—ç¬¦ä¹‹åçš„éƒ¨åˆ†ã€‚ éœ€è¦éå†æ‰€æœ‰æƒ…å†µã€‚ åŸºäºä»¥ä¸Š 3 æ¡è§„åˆ™ï¼Œæˆ‘ä»¬å¯ä»¥å¾—å‡ºå¦‚ä¸‹æ€è·¯ï¼š åˆ©ç”¨åŒé‡å¾ªç¯éå†æ‰€æœ‰å¯èƒ½å‡ºç°çš„å­ä¸²ã€‚ ä½¿ç”¨ strstr ä»è¾“å…¥å­—ç¬¦ä¸²çš„å­ä¸²é¦–å­—æ¯ä¹‹åçš„éƒ¨åˆ†ä¸­å¯»æ‰¾æ˜¯å¦æœ‰é‡å¤å­ä¸²ã€‚ æ›´æ–°æœ€é•¿å­ä¸²è®°å½•ã€‚ ä»£ç 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859#include &lt;stdio.h&gt;#include &lt;stdlib.h&gt;#include &lt;string.h&gt;int substring(char *input, char **output)&#123; int i, j, n; int in_len = strlen(input); int max = 0; char *tmp; tmp = malloc(in_len); // åŒé‡å¾ªç¯è´Ÿè´£éå†æ‰€æœ‰å­ä¸² // j ä» i+1 å¼€å§‹ä¿è¯å­ä¸²æœ€çŸ­ä¸º 1 ä¸ªå­—ç¬¦ // j &lt; in_len ä¿è¯å­ä¸²æœ€å¤§ä¸º in_len-1 ä¸ªå­—ç¬¦ for (i = 0; i &lt; in_len; i++) &#123; for (j = i + 1; j &lt; in_len; j++) &#123; // å­ä¸²é•¿åº¦ n = j - i; // å–å­ä¸² strncpy(tmp, input + i, n); tmp[n] = &#x27;\\0&#x27;; // ä»å­ä¸²é¦–å­—ç¬¦ä¹‹åçš„å‰©ä½™éƒ¨åˆ†æ‰¾é‡å¤å­ä¸² if (strstr(input + i + 1, tmp)) &#123; if (n &gt; max) &#123; *output = input + i; max = n; &#125; &#125; &#125; &#125; free(tmp); return max;&#125;int main(int argc, char *argv[])&#123; char *out; int len; int i; printf(&quot; input: \\&quot;%s\\&quot;\\n&quot;, argv[1]); len = substring(argv[1], &amp;out); printf(&quot;output: \\&quot;&quot;); for (i = 0; i &lt; len; i++) printf(&quot;%c&quot;, out[i]); printf(&quot;\\&quot;\\n&quot;); return 0;&#125; æµ‹è¯•ç»“æœæµ‹è¯•å­—ç¬¦ä¸²ï¼šasdfddfbiibhddf234ç»“æœè¾“å‡ºï¼š 12 input: &quot;asdfddfbiibhddf234&quot;output: &quot;ddf&quot; æµ‹è¯•å­—ç¬¦ä¸²ï¼šaaaç»“æœè¾“å‡ºï¼š 12 input: &quot;aaa&quot;output: &quot;aa&quot; æµ‹è¯•å­—ç¬¦ä¸²ï¼šbbbbç»“æœè¾“å‡ºï¼š 12 input: &quot;bbbb&quot;output: &quot;bbb&quot; æµ‹è¯•å­—ç¬¦ä¸²ï¼šcç»“æœè¾“å‡ºï¼š 12 input: &quot;c&quot;output: &quot;&quot;","categories":[],"tags":[{"name":"é¢è¯•","slug":"é¢è¯•","permalink":"https://blog.mahyang.uk/tags/%E9%9D%A2%E8%AF%95/"},{"name":"C","slug":"C","permalink":"https://blog.mahyang.uk/tags/C/"},{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"https://blog.mahyang.uk/tags/%E7%AE%97%E6%B3%95/"}]},{"title":"ROSR å­¦ä¹ ç¬”è®° - ç¬¬3.1ç« ","slug":"ROSR-å­¦ä¹ ç¬”è®°-ç¬¬3-1ç« ","date":"2022-11-21T05:42:39.000Z","updated":"2022-11-21T05:42:39.000Z","comments":true,"path":"2022/11/21/ROSR-å­¦ä¹ ç¬”è®°-ç¬¬3-1ç« /","link":"","permalink":"https://blog.mahyang.uk/2022/11/21/ROSR-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-%E7%AC%AC3-1%E7%AB%A0/","excerpt":"ROSR æ˜¯ã€RISC-V OS using Rustã€çš„ç¼©å†™ï¼Œæ˜¯ç”± Stephen Marz åœ¨ä»–çš„ç³»åˆ—åšå®¢ä¸­æä¾›çš„æ“ä½œç³»ç»Ÿå¼€å‘æ•™ç¨‹ã€‚ æœ¬ç« æè¿°ç³»ç»Ÿå †å†…å­˜ç®¡ç†ã€‚ å‰é¢ç« èŠ‚å·²ç»æè¿°è¿‡æˆ‘ä»¬é€šè¿‡ QEMU ç»™æ•´ä¸ªç³»ç»Ÿæä¾›äº† 128M å­—èŠ‚å†…å­˜ç©ºé—´ï¼ŒELF æ–‡ä»¶åŠ è½½åˆ°å†…å­˜ä¸­åé™¤å¼€ä»£ç ã€å…¨å±€å˜é‡ã€æ ˆç­‰å ç”¨çš„å†…å­˜ä¹‹å¤–ï¼Œå…¶ä½™éƒ¨åˆ†æˆ‘ä»¬éƒ½åˆ†é…äº†å †ã€‚æ‰€ä»¥å †çš„éƒ¨åˆ†å°±ç”±æ“ä½œç³»ç»Ÿæ¥ç®¡ç†åˆ†é…ã€‚ ç®¡ç†ç³»ç»Ÿå †ç©ºé—´æ—¶ï¼Œåˆ†ä¸º 3 ä¸ªéƒ¨åˆ†ï¼š é¡µåˆ†é… å­—èŠ‚åˆ†é… ç¼–ç¨‹å†…å­˜ç®¡ç†å•å…ƒ æœ¬ 3.1 èŠ‚ä¸»è¦æè¿°é¡µåˆ†é…ã€‚","text":"ROSR æ˜¯ã€RISC-V OS using Rustã€çš„ç¼©å†™ï¼Œæ˜¯ç”± Stephen Marz åœ¨ä»–çš„ç³»åˆ—åšå®¢ä¸­æä¾›çš„æ“ä½œç³»ç»Ÿå¼€å‘æ•™ç¨‹ã€‚ æœ¬ç« æè¿°ç³»ç»Ÿå †å†…å­˜ç®¡ç†ã€‚ å‰é¢ç« èŠ‚å·²ç»æè¿°è¿‡æˆ‘ä»¬é€šè¿‡ QEMU ç»™æ•´ä¸ªç³»ç»Ÿæä¾›äº† 128M å­—èŠ‚å†…å­˜ç©ºé—´ï¼ŒELF æ–‡ä»¶åŠ è½½åˆ°å†…å­˜ä¸­åé™¤å¼€ä»£ç ã€å…¨å±€å˜é‡ã€æ ˆç­‰å ç”¨çš„å†…å­˜ä¹‹å¤–ï¼Œå…¶ä½™éƒ¨åˆ†æˆ‘ä»¬éƒ½åˆ†é…äº†å †ã€‚æ‰€ä»¥å †çš„éƒ¨åˆ†å°±ç”±æ“ä½œç³»ç»Ÿæ¥ç®¡ç†åˆ†é…ã€‚ ç®¡ç†ç³»ç»Ÿå †ç©ºé—´æ—¶ï¼Œåˆ†ä¸º 3 ä¸ªéƒ¨åˆ†ï¼š é¡µåˆ†é… å­—èŠ‚åˆ†é… ç¼–ç¨‹å†…å­˜ç®¡ç†å•å…ƒ æœ¬ 3.1 èŠ‚ä¸»è¦æè¿°é¡µåˆ†é…ã€‚ æŒ‰é¡µåˆ†é…è¡¨ç¤ºä»¥é¡µä¸ºç²’åº¦æ¥åˆ†é…å†…å­˜ç©ºé—´ï¼ŒRISC-V å’Œå¤§å¤šæ•°æ¶æ„ä¸€æ ·æœ€å°é¡µç©ºé—´å ç”¨ 4096 å­—èŠ‚ã€‚æŒ‰é¡µåˆ†é…çš„æ–¹æ³•æœ‰å¾ˆå¤šï¼Œè¿™é‡Œé‡‡ç”¨æè¿°ç¬¦åˆ†é…æ–¹å¼ã€‚ åœ¨è¿›å…¥æ­£é¢˜ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆæ¥çœ‹å‡ ä¸ªé‡è¦çš„å‚æ•°ï¼š 12PROVIDE(_heap_start = _stack_end);PROVIDE(_heap_size = _memory_end - _heap_start); linker script æä¾›äº† 2 ä¸ªé‡è¦ç¬¦å·ï¼šå †èµ·å§‹åœ°å€ï¼ˆ_heap_startï¼‰å’Œå †å¤§å°ï¼ˆ_heap_sizeï¼‰ï¼Œè¿™äº›ç¬¦å·åˆé€šè¿‡ mem.S æ–‡ä»¶ä½œä¸ºå…¨å±€å¸¸é‡ä¼ å…¥ rustï¼š 12345.global HEAP_STARTHEAP_START: .dword _heap_start.global HEAP_SIZEHEAP_SIZE: .dword _heap_size åœ¨ page.rs çš„ init å‡½æ•°ä¸­ï¼š 123456789let num_pages = HEAP_SIZE / PAGE_SIZE;// ...ALLOC_START = align_val( HEAP_START + num_pages * size_of::&lt;Page,&gt;(), PAGE_ORDER,); ç¬¬ä¸€è¡Œç®—å‡ºå †å†…å­˜æ€»å…±çš„é¡µæ•°ï¼Œæœ€åä¸€è¡Œç®—å‡ºç”¨äºåˆ†é…çš„å †å†…å­˜èµ·å§‹åœ°å€ã€‚ æè¿°ç¬¦åˆ†é…æ³•æ¯æ¬¡åˆ†é…éƒ½æŒ‰ç…§è¿ç»­é¡µåˆ†é…ï¼Œå¹¶ä¸”åªå­˜å‚¨é¦–é¡µåœ°å€ã€‚ä¸ºäº†è¾¾åˆ°æ­¤ç›®æ ‡å¿…é¡»æ¯é¡µå†…å­˜éƒ½æœ‰ä¸€ä¸ªå­—èŠ‚å¤§å°çš„æè¿°ç¬¦ã€‚æ­¤æè¿°ç¬¦åŒ…å« 2 ç§æ ‡å¿—ï¼š1ï¼‰æ­¤é¡µæ˜¯å¦è¢«åˆ†é…ï¼›2ï¼‰æ˜¯å¦ä¸ºè¿ç»­åˆ†é…å†…å­˜çš„æœ€åä¸€é¡µã€‚ ç”±æ­¤å®šä¹‰å¦‚ä¸‹æ•°æ®ç»“æ„ï¼š 12345678910#[repr(u8)]pub enum PageBits &#123; Empty = 0, Taken = 1 &lt;&lt; 0, Last = 1 &lt;&lt; 1,&#125;pub struct Page &#123; flags: u8,&#125; åˆ†é…å†…å­˜é¡µ123456789101112131415161718192021222324252627282930pub fn alloc(pages: usize) -&gt; *mut u8 &#123; assert!(pages &gt; 0); unsafe &#123; let num_pages = HEAP_SIZE / PAGE_SIZE; let ptr = HEAP_START as *mut Page; for i in 0..num_pages - pages &#123; let mut found = false; if (*ptr.add(i)).is_free() &#123; found = true; for j in i..i + pages &#123; if (*ptr.add(j)).is_taken() &#123; found = false; break; &#125; &#125; &#125; if found &#123; for k in i..i + pages - 1 &#123; (*ptr.add(k)).set_flag(PageBits::Taken); &#125; (*ptr.add(i+pages-1)).set_flag(PageBits::Taken); (*ptr.add(i+pages-1)).set_flag(PageBits::Last); return (ALLOC_START + PAGE_SIZE * i) as *mut u8; &#125; &#125; &#125; null_mut()&#125; å¦‚ä¸Šä¸ºå†…å­˜é¡µåˆ†é…å‡½æ•°ï¼Œå‡½æ•°å‚æ•°ä¸ºéœ€è¦çš„é¡µæ•°ã€‚ ç¬¬ 2 è¡Œï¼šåˆ¤æ–­é¡µæ•°æ˜¯å¦æœ‰æ•ˆï¼›ç¬¬ 4 è¡Œï¼šç®—å‡ºå †å†…å­˜ç©ºé—´æ€»é¡µæ•°ï¼›ç¬¬ 5 è¡Œï¼šå°†å †èµ·å§‹åœ°å€ç±»å‹è½¬æ¢ä¸ºå¯å˜é¡µæŒ‡é’ˆï¼›ç¬¬ 6ï½26 è¡Œï¼šæ‰¾å‡ºæ»¡è¶³è¦æ±‚è¿ç»­ç©ºé—²é¡µå¹¶åˆ†é…ï¼›ç¬¬ 8ï½16 è¡Œï¼šåœ¨ç¬¬ i é¡µä¸ºç©ºé—²çš„å‰æä¸‹çœ‹å…¶åæ˜¯å¦æœ‰æ»¡è¶³æ‰€éœ€é¡µæ•°çš„è¿ç»­é¡µï¼›ç¬¬ 17ï½25 è¡Œï¼šå¦‚æœæ‰¾åˆ°äº†æ»¡è¶³æ‰€éœ€é¡µæ•°çš„è¿ç»­ç©ºé—²é¡µï¼Œå°†é™¤æœ€åä¸€é¡µçš„å†…å­˜é¡µæ ‡è®°ä¸ºå ç”¨ï¼Œæœ€åä¸€é¡µæ ‡è®°ä¸ºå ç”¨ä»¥åŠå°¾ï¼Œå¹¶è¿”å›é¡µæŒ‡é’ˆã€‚ å›æ”¶å†…å­˜é¡µ12345678910111213141516171819pub fn dealloc(ptr: *mut u8) &#123; assert!(!ptr.is_null()); unsafe &#123; let addr = HEAP_START + (ptr as usize - ALLOC_START) / PAGE_SIZE; assert!(addr &gt;= HEAP_START &amp;&amp; addr &lt; HEAP_START + HEAP_SIZE); let mut p = addr as *mut Page; while (*p).is_taken() &amp;&amp; !(*p).is_last() &#123; (*p).clear(); p = p.add(1); &#125; assert!( (*p).is_last() == true, &quot;Possible double-free detected! (Not taken found \\ before last)&quot; ); (*p).clear(); &#125;&#125; å¦‚ä¸Šä¸ºå†…å­˜é¡µå›æ”¶å‡½æ•°ï¼Œå‡½æ•°å‚æ•°ä¸ºéœ€è¦å›æ”¶çš„é¡µæŒ‡é’ˆã€‚ ç¬¬ 2 è¡Œï¼šåˆ¤æ–­é¡µæŒ‡é’ˆæ˜¯å¦æœ‰æ•ˆï¼›ç¬¬ 4ï½7 è¡Œï¼šç®—å‡ºæ­¤é¡µå†…å­˜æ‰€å¯¹åº”çš„é¡µæè¿°ç¬¦ï¼›ç¬¬ 8ï½17 è¡Œï¼šä¾æ¬¡å°†æ‰€æœ‰åˆ†é…çš„å†…å­˜é¡µå¯¹åº”çš„é¡µæè¿°ç¬¦æ ‡è®°æ¸…é›¶ï¼Œè¡¨ç¤ºè®¾ç½®ä¸ºæœªå ç”¨ã€‚","categories":[],"tags":[{"name":"RISC-V","slug":"RISC-V","permalink":"https://blog.mahyang.uk/tags/RISC-V/"},{"name":"OS","slug":"OS","permalink":"https://blog.mahyang.uk/tags/OS/"},{"name":"Rust","slug":"Rust","permalink":"https://blog.mahyang.uk/tags/Rust/"}]},{"title":"ROSR å­¦ä¹ ç¬”è®° - ç¬¬2ç« ","slug":"ROSR-å­¦ä¹ ç¬”è®°-ç¬¬2ç« ","date":"2022-11-11T02:38:40.000Z","updated":"2022-11-11T02:38:40.000Z","comments":true,"path":"2022/11/11/ROSR-å­¦ä¹ ç¬”è®°-ç¬¬2ç« /","link":"","permalink":"https://blog.mahyang.uk/2022/11/11/ROSR-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-%E7%AC%AC2%E7%AB%A0/","excerpt":"ROSR æ˜¯ã€RISC-V OS using Rustã€çš„ç¼©å†™ï¼Œæ˜¯ç”± Stephen Marz åœ¨ä»–çš„ç³»åˆ—åšå®¢ä¸­æä¾›çš„æ“ä½œç³»ç»Ÿå¼€å‘æ•™ç¨‹ã€‚ æœ¬ç« æè¿°ä½¿ç”¨ Rust çš„ unsafe åŠŸèƒ½æ“ä½œ MMIO æ¥æ§åˆ¶ UART è¿›è€Œå®ç° println! ç­‰å®ã€‚","text":"ROSR æ˜¯ã€RISC-V OS using Rustã€çš„ç¼©å†™ï¼Œæ˜¯ç”± Stephen Marz åœ¨ä»–çš„ç³»åˆ—åšå®¢ä¸­æä¾›çš„æ“ä½œç³»ç»Ÿå¼€å‘æ•™ç¨‹ã€‚ æœ¬ç« æè¿°ä½¿ç”¨ Rust çš„ unsafe åŠŸèƒ½æ“ä½œ MMIO æ¥æ§åˆ¶ UART è¿›è€Œå®ç° println! ç­‰å®ã€‚ Universal Asynchronous Reciever &#x2F; Transmitter (UART)QEMU å†…éƒ¨è™šæ‹Ÿäº†ä¸€ä¸ª NS16550A UART èŠ¯ç‰‡ï¼ŒæŸ¥çœ‹ qemu&#x2F;hw&#x2F;riscv&#x2F;virt.c ä»£ç å¯çŸ¥ï¼š 1234static const MemMapEntry virt_memmap[] = &#123; // ... [VIRT_UART0] = &#123; 0x10000000, 0x100 &#125;,&#125;; é€šè¿‡ç‰©ç†åœ°å€ 0x10000000ï¼Œå³å¯è®¿é—® NS16550A èŠ¯ç‰‡çš„å¯„å­˜å™¨ã€‚BTWï¼Œè¿™ç§é€šè¿‡ç‰©ç†åœ°å€è®¿é—®çš„ IO è¢«ç§°ä¸º MMIOã€‚ ä»ä¸‹å›¾å¯ä»¥çœ‹åˆ°å‘é€ï¼ˆTHRï¼‰æ¥æ”¶ï¼ˆRBRï¼‰å¯„å­˜å™¨éƒ½æ˜¯ 8 bitï¼ˆ1 byteï¼‰ï¼Œæˆ‘ä»¬åªè¦ä»åœ°å€ 0x10000000 è¯»å–å°±èƒ½ä» UART æ¥æ”¶ä¸€ä¸ªå­—èŠ‚ï¼Œå‘åœ°å€ 0x10000000 å†™å…¥å°±èƒ½å‘é€ä¸€ä¸ªå­—èŠ‚ã€‚ Rust ä¸­çš„ MMIO1234567891011121314151617181920212223242526272829303132/// # Safety////// We label the mmio function unsafe since/// we will be working with raw memory. Rust cannot/// make any guarantees when we do this.fn unsafe mmio_write(address: usize, offset: usize, value: u8) &#123; // Set the pointer based off of the address let reg = address as *mut u8; // write_volatile is a member of the *mut raw // and we can use the .add() to give us another pointer // at an offset based on the original pointer&#x27;s memory // address. NOTE: The add uses pointer arithmetic so it is // new_pointer = old_pointer + sizeof(pointer_type) * offset reg.add(offset).write_volatile(value);&#125;/// # Safety////// We label the mmio function unsafe since/// we will be working with raw memory. Rust cannot/// make any guarantees when we do this.fn unsafe mmio_read(address: usize, offset: usize, value: u8) -&gt; u8 &#123; // Set the pointer based off of the address let reg = address as *mut u8; // read_volatile() is much like write_volatile() except it // will grab 8-bits from the pointer and give that value to us. // We don&#x27;t add a semi-colon at the end here so that the value // is &quot;returned&quot;. reg.add(offset).read_volatile()&#125; Rust UART é©±åŠ¨UART é©±åŠ¨åŒ…æ‹¬ï¼š æ•°æ®ç»“æ„ç”¨äºå­˜å‚¨åŸºåœ°å€ åˆå§‹åŒ–æ–¹æ³• è¾“å‡ºä¸€ä¸ªå­—ç¬¦å‡½æ•°ï¼ˆputï¼‰ è¯»å–ä¸€ä¸ªå­—ç¬¦å‡½æ•°ï¼ˆgetï¼‰ å®ç° Write traits æ•°æ®ç»“æ„å®šä¹‰123pub struct UartDriver &#123; base_address: usize,&#125; å¢åŠ åˆå§‹åŒ–æ–¹æ³•12345678910111213141516171819202122232425impl UartDriver &#123; // ... pub fn init(&amp;self) &#123; let ptr = self.base_address as *mut u8; unsafe &#123; let lcr = (1 &lt;&lt; 0) | (1 &lt;&lt; 1); ptr.add(3).write_volatile(lcr); ptr.add(2).write_volatile(1 &lt;&lt; 0); ptr.add(1).write_volatile(1 &lt;&lt; 0); let divisor: u16 = 12; let divisor_least: u8 = (divisor &amp; 0xff) as u8; let divisor_most: u8 = (divisor &gt;&gt; 8) as u8; ptr.add(3).write_volatile(lcr | 1 &lt;&lt; 7); ptr.add(0).write_volatile(divisor_least); ptr.add(1).write_volatile(divisor_most); ptr.add(3).write_volatile(lcr); &#125; &#125; // ...&#125; 7~9è¡Œï¼Œè®¾ç½®8ä½æ•°æ®ã€æ— åœæ­¢ä½ã€æ— å¥‡å¶ï¼ˆå› ä¸ºæ˜¯æ¨¡æ‹Ÿçš„ UARTï¼Œä¸€èˆ¬ç¡¬ä»¶è®¾ç½®ä¸º 8N1ï¼‰ 10ã€11è¡Œï¼Œå¼€å¯æ”¶ä¸­æ–­ã€å¼€å¯ FIFO 13~18è¡Œï¼Œè®¾ç½®æ³¢ç‰¹ç‡ 115200ï¼ˆå› ä¸ºæ˜¯æ¨¡æ‹Ÿçš„ UART æ‰€ä»¥æ³¢ç‰¹ç‡è®¾ç½®ä¸å½±å“ï¼‰ æ ¹æ® NS16550A èŠ¯ç‰‡èµ„æ–™ï¼Œå…¶å†…éƒ¨æœ‰ä¸€ä¸ªå…¨å±€æ—¶é’Ÿé¢‘ç‡ä¸º 22.729 MHzï¼ˆ22729000 Hzï¼‰ï¼Œæ‰€ä»¥è¦è®¾ç½® 115200 æ³¢ç‰¹ç‡ï¼š divisor &#x3D; 22729000 &#x2F; (115200 * 16) &#x3D; 12ã€‚ å¹¶ä¸”åœ¨è®¾ç½®æ³¢ç‰¹ç‡ä¹‹å‰éœ€æŠŠ LCR å¯„å­˜å™¨çš„ DLAB ä½ç½®1ï¼Œè®¾ç½®å®Œåå†ç½®0ã€‚ å¢åŠ  put æ–¹æ³•12345678910impl UartDriver &#123; // ... fn put(&amp;self, c: u8) &#123; let ptr = self.base_address as *mut u8; unsafe &#123; ptr.add(0).write_volatile(c); &#125; &#125; // ...&#125; å¢åŠ  get æ–¹æ³•123456789101112131415impl UartDriver &#123; // ... pub fn get(&amp;self) -&gt; Option&lt;u8&gt; &#123; let ptr = self.base_address as *mut u8; unsafe &#123; if ptr.add(5).read_volatile() &amp; 1 == 0 &#123; None &#125; else &#123; Some(ptr.add(0).read_volatile()) &#125; &#125; &#125; // ...&#125; è¿™é‡Œæˆ‘ä»¬çš„å†…æ ¸è¿˜æ²¡å¤„ç†ä¸­æ–­ï¼Œæ‰€ä»¥é‡‡ç”¨ poll çš„æ–¹å¼æ£€æµ‹æ˜¯å¦æœ‰æ•°æ®ã€‚ å®ç° Write traitsè¿™ä¸€æ­¥æ˜¯ä¸ºäº† print! å®åšå‡†å¤‡ã€‚ 123456789101112use core::fmt::&#123;Error, Write&#125;;// ...impl Write for UartDriver &#123; fn write_str(&amp;mut self, s: &amp;str) -&gt; Result&lt;(), Error&gt; &#123; for c in s.bytes() &#123; self.put(c); &#125; Ok(()) &#125;&#125; å®ç° print! å®ç¬¬1ç« ä¸­ï¼Œlib.rs æ–‡ä»¶ä¸­çš„ print! å®çš„å®ç°æ˜¯ç©ºï¼Œç°åœ¨æˆ‘ä»¬å¯ä»¥å¡«å…¥å†…å®¹äº†ï¼š 12345678#[macro_export]macro_rules! print&#123; ($($args:tt)+) =&gt; &#123;&#123; use core::fmt::Write; let _ = write!(uart::UartDriver::new(0x1000_0000), $($args)+); &#125;&#125;;&#125; Hello, World!åœ¨ kmain å…¥å£å¤„åˆå§‹åŒ– UART åå°±å¯ä»¥å‘ç»ˆç«¯è¾“å‡ºä¿¡æ¯äº†ï¼š 1234567#[no_mangle]extern &quot;C&quot; fn kmain() &#123; let my_uart = uart::UartDriver::new(0x1000_0000); my_uart.init(); println!(&quot;Hello, World!&quot;);&#125; åŒæ ·ä¹Ÿèƒ½ä»ç»ˆç«¯è·å–ç”¨æˆ·è¾“å…¥ï¼š 1234567891011121314151617181920#[no_mangle]extern &quot;C&quot; fn kmain() &#123; // ... loop &#123; if let Some(c) = my_uart.get() &#123; match c &#123; 8 | 127 =&gt; &#123; print!(&quot;&#123;&#125;&#123;&#125;&#123;&#125;&quot;, 8 as char, &#x27; &#x27;, 8 as char); &#125;, 10 | 13 =&gt; &#123; println!(); &#125;, _ =&gt; &#123; print!(&quot;&#123;&#125;&quot;, c as char); &#125; &#125; &#125; &#125;&#125;","categories":[],"tags":[{"name":"RISC-V","slug":"RISC-V","permalink":"https://blog.mahyang.uk/tags/RISC-V/"},{"name":"OS","slug":"OS","permalink":"https://blog.mahyang.uk/tags/OS/"},{"name":"Rust","slug":"Rust","permalink":"https://blog.mahyang.uk/tags/Rust/"}]},{"title":"ROSR å­¦ä¹ ç¬”è®° - ç¬¬1ç« ","slug":"ROSR-å­¦ä¹ ç¬”è®°-ç¬¬1ç« ","date":"2022-11-10T03:30:00.000Z","updated":"2022-11-10T03:30:00.000Z","comments":true,"path":"2022/11/10/ROSR-å­¦ä¹ ç¬”è®°-ç¬¬1ç« /","link":"","permalink":"https://blog.mahyang.uk/2022/11/10/ROSR-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-%E7%AC%AC1%E7%AB%A0/","excerpt":"ROSR æ˜¯ã€RISC-V OS using Rustã€çš„ç¼©å†™ï¼Œæ˜¯ç”± Stephen Marz åœ¨ä»–çš„ç³»åˆ—åšå®¢ä¸­æä¾›çš„æ“ä½œç³»ç»Ÿå¼€å‘æ•™ç¨‹ã€‚ æœ¬ç« æè¿°ä½¿ç”¨æ±‡ç¼–è¯­è¨€ç¼–å†™å¼•å¯¼ç¨‹åºä¸º Rust è¯­è¨€åˆ›å»ºæ‰§è¡Œç¯å¢ƒã€‚","text":"ROSR æ˜¯ã€RISC-V OS using Rustã€çš„ç¼©å†™ï¼Œæ˜¯ç”± Stephen Marz åœ¨ä»–çš„ç³»åˆ—åšå®¢ä¸­æä¾›çš„æ“ä½œç³»ç»Ÿå¼€å‘æ•™ç¨‹ã€‚ æœ¬ç« æè¿°ä½¿ç”¨æ±‡ç¼–è¯­è¨€ç¼–å†™å¼•å¯¼ç¨‹åºä¸º Rust è¯­è¨€åˆ›å»ºæ‰§è¡Œç¯å¢ƒã€‚ åŸºæœ¬æ€è·¯ å°†æºç ç¼–è¯‘å‡ºç›®æ ‡æ–‡ä»¶ ä½¿ç”¨ linker script é€šè¿‡é“¾æ¥å™¨å°†ç›®æ ‡æ–‡ä»¶é“¾æ¥æˆ ELF æ–‡ä»¶ QEMU ä½¿ç”¨ ELF æ–‡ä»¶å¯åŠ¨ QEMU æ ¹æ® ELF æ–‡ä»¶æŒ‡å®šçš„å†…å­˜åœ°å€å°†ä»£ç æ®µã€æ•°æ®æ®µç­‰æ”¾ç½®åˆ°å†…å­˜ä¸­ç›¸åº”çš„ä½ç½® QEMU æ¨¡æ‹Ÿå™¨å¼€å§‹æ‰§è¡Œç¨‹åº QEMU å†…å­˜æ˜ å°„æŸ¥çœ‹ qemu&#x2F;hw&#x2F;riscv&#x2F;virt.c æ–‡ä»¶å¯çŸ¥ï¼š 1234static const MemMapEntry virt_memmap[] = &#123; // ... [VIRT_DRAM] = &#123; 0x80000000, 0x0 &#125;,&#125;; QEMU ä»å†…å­˜åœ°å€ 0x80000000 å¼€å§‹æ‰§è¡Œç¨‹åºï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦æŠŠä»£ç é“¾æ¥åˆ°æ­¤åœ°å€ä¸Šï¼Œè¿™ä¸€ç‚¹ä»ç¬¬0ç« çš„ linker script ä¹Ÿèƒ½çœ‹å‡ºã€‚ å¯åŠ¨å¹¶æ‰§è¡Œ Rust ç¨‹åºåˆ†ä¸º 3 ä¸ªæ­¥éª¤ï¼š é€‰æ‹©ç”¨äºå¯åŠ¨çš„ CPU ï¼ˆä¸€èˆ¬é€‰æ‹© id ä¸º #0 çš„ï¼‰ åˆå§‹åŒ– BSS æ®µä¸º 0 è·³è½¬ Rust é€‰æ‹©å¯åŠ¨ CPUé€‰æ‹©ä¸€ä¸ª CPU æ¥æ‰§è¡Œå¯åŠ¨æµç¨‹ï¼ŒåŸå› åœ¨äºåœ¨è¿™ä¸ªé˜¶æ®µæˆ‘ä»¬å¹¶ä¸æƒ³å»å¤„ç†å¹¶å‘æˆ–è€…èµ„æºç«äº‰ç­‰é—®é¢˜ã€‚é€šè¿‡ RISC-V ç‰¹æƒçº§è§„èŒƒæ‰‹å†Œ çš„ 3.1.5 èŠ‚å¯çŸ¥ï¼Œæˆ‘ä»¬èƒ½ä½¿ç”¨ mhartid å¯„å­˜å™¨æ¥ç¡®å®šå½“å‰æŒ‡ä»¤æ­£åœ¨è¢«å“ªä¸ª CPU æ‰§è¡Œã€‚ 123456 csrr t0, mhartid bnez t0, 3f3: wfi j 3b è¿™æ®µä»£ç è®© id#0 ä¹‹å¤–çš„ CPU éƒ½è·³è½¬åˆ° wfiï¼ˆç­‰å¾…ä¸­æ–­ï¼‰ æŒ‡ä»¤å¤„ã€‚ åˆå§‹åŒ– BSS æ®µç¡®å®šå¥½ç”±å“ªä¸ª CPU æ‰§è¡Œå¯åŠ¨æµç¨‹åï¼Œå°±éœ€è¦ä½¿ç”¨å®ƒå°† BSS æ®µåˆå§‹åŒ–æ¸…é›¶ï¼š 1234567 la a0, _bss_start la a1, _bss_end bgeu a0, a1, 2f1: sd zero, (a0) addi a0, a0, 8 bltu a0, a1, 1b å…¶ä¸­æ ‡å· _bss_start ä»¥åŠ _bss_end ç”± linker script ç¡®å®šã€‚ è·³è½¬ Ruståœ¨è·³è½¬æ‰§è¡Œ Rust ä»£ç å‰æˆ‘ä»¬å¿…é¡»ä¸º Rust å‡†å¤‡æ‰§è¡Œç¯å¢ƒï¼Œä¹Ÿå°±æ˜¯è®¾ç½®å¥½æ ˆæŒ‡é’ˆï¼ˆSPï¼‰ä»¥åŠå¼‚å¸¸ç¨‹åºè®¡æ•°å™¨ï¼ˆmepcï¼‰ç„¶ååˆ©ç”¨ä¸­æ–­è¿”å›ï¼ˆmretï¼‰è®© CPU è·³è½¬åˆ°ä¸»å‡½æ•°å…¥å£ï¼ˆkmainï¼‰ã€‚ ä½†æ˜¯æ­¤æ—¶çš„ CPU å¹¶æ²¡æœ‰è¢«ä¸­æ–­ï¼Œè¦ä½¿ç”¨ä¸­æ–­è¿”å›å°±å¿…é¡»æ¨¡æ‹Ÿä¸€ä¸ªä¸­æ–­çš„åœºæ™¯ä½¿å¾— mret æŒ‡ä»¤èƒ½å¤Ÿæ­£ç¡®æ‰§è¡Œã€‚ 123456789la sp, _stackli t0, (0b11 &lt;&lt; 11) | (1 &lt;&lt; 7) | (1 &lt;&lt; 3)csrw mstatus, t0la t1, kmaincsrw mepc, t1la t2, asm_trap_vectorcsrw mtvec, t2li t3, (1 &lt;&lt; 3) | (1 &lt;&lt; 7) | (1 &lt;&lt; 11)csrw mie, t3 ä¸Šé¢è¿™æ®µä»£ç ä¸­çš„ç¬¬1è¡Œå°±æ˜¯è®¾ç½® SP å¯„å­˜å™¨ï¼ŒåŒæ · _statck ç¬¦å·ç”± linker script æä¾›ã€‚ ç¬¬2ã€3è¡Œå°† mstatus å¯„å­˜å™¨çš„ MIEã€MPIEã€MPP ä½åˆ†åˆ«ç½® b&#39;1ã€b&#39;1 ä»¥åŠ b&#39;11ï¼Œä½¿å¾— mret æ‰§è¡Œå MIE ä¸º b&#39;1ï¼ŒMPIE ä¸º b&#39;1ï¼ŒMPP ä¸º b&#39;00ï¼Œå¹¶ä¸” CPU å¤„äº M æ€ã€‚ ç¬¬4ã€5è¡Œå°† Rust ç¨‹åºçš„å…¥å£å†™å…¥ mepc å¯„å­˜å™¨ï¼Œå½“ mret æ‰§è¡Œå CPU å°±ä¼šè·³è½¬åˆ°æ­¤å¤„ã€‚ ç¬¬6ã€7è¡Œè®¾ç½®é™·é˜±å‘é‡åŸºåœ°å€ï¼Œæš‚æ—¶ä¸ç”¨å…³å¿ƒã€‚ ç¬¬8ã€9è¡Œå¼€å¯è½¯ä¸­æ–­ã€æ—¶é’Ÿä¸­æ–­ã€å¤–éƒ¨ä¸­æ–­ã€‚ Rust Code12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667// Steve Operating System// Stephen Marz// 21 Sep 2019#![no_std]#![feature(panic_info_message)]use core::arch::asm;// ///////////////////////////////////// / RUST MACROS// ///////////////////////////////////#[macro_export]macro_rules! print &#123; ($($args:tt)+) =&gt; &#123;&#123;&#125;&#125;;&#125;#[macro_export]macro_rules! println&#123; () =&gt; (&#123; print!(&quot;\\r\\n&quot;) &#125;); ($fmt:expr) =&gt; (&#123; print!(concat!($fmt, &quot;\\r\\n&quot;)) &#125;); ($fmt:expr, $($args:tt)+) =&gt; (&#123; print!(concat!($fmt, &quot;\\r\\n&quot;), $($args)+) &#125;);&#125;// ///////////////////////////////////// / LANGUAGE STRUCTURES / FUNCTIONS// ///////////////////////////////////#[no_mangle]extern &quot;C&quot; fn eh_personality() &#123;&#125;#[panic_handler]fn panic(info: &amp;core::panic::PanicInfo) -&gt; ! &#123; print!(&quot;Aborting: &quot;); if let Some(p) = info.location() &#123; println!( &quot;line &#123;&#125;, file &#123;&#125;: &#123;&#125;&quot;, p.line(), p.file(), info.message().unwrap() ); &#125; else &#123; println!(&quot;no information available.&quot;); &#125; abort();&#125;#[no_mangle]extern &quot;C&quot; fn abort() -&gt; ! &#123; loop &#123; unsafe &#123; // The asm! syntax has changed in Rust. // For the old, you can use llvm_asm!, but the // new syntax kicks ass--when we actually get to use it. asm!(&quot;wfi&quot;); &#125; &#125;&#125;#[no_mangle]extern &quot;C&quot; fn kmain() &#123; // Main should initialize all sub-systems and get // ready to start scheduling. The last thing this // should do is start the timer.&#125; è¿™é‡Œçš„ä»£ç å’Œä½œè€…åŸå…ˆçš„ä»£ç æœ‰å¦‚ä¸‹å·®å¼‚ï¼š 12345&lt; #![feature(panic_info_message,asm)]---&gt; #![feature(panic_info_message)]&gt;&gt; use core::arch::asm; å¤§æ¦‚å› ä¸ºç›®å‰çš„ Rust ç¼–è¯‘å™¨ä»¥åŠæä¾›äº†å¯¹ asm ç¨³å®šæ”¯æŒã€‚","categories":[],"tags":[{"name":"RISC-V","slug":"RISC-V","permalink":"https://blog.mahyang.uk/tags/RISC-V/"},{"name":"OS","slug":"OS","permalink":"https://blog.mahyang.uk/tags/OS/"},{"name":"Rust","slug":"Rust","permalink":"https://blog.mahyang.uk/tags/Rust/"}]},{"title":"ROSR å­¦ä¹ ç¬”è®° - ç¬¬0ç« ","slug":"ROSR-å­¦ä¹ ç¬”è®°-ç¬¬0ç« ","date":"2022-11-10T02:04:39.000Z","updated":"2022-11-10T02:04:39.000Z","comments":true,"path":"2022/11/10/ROSR-å­¦ä¹ ç¬”è®°-ç¬¬0ç« /","link":"","permalink":"https://blog.mahyang.uk/2022/11/10/ROSR-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-%E7%AC%AC0%E7%AB%A0/","excerpt":"ROSR æ˜¯ã€RISC-V OS using Rustã€çš„ç¼©å†™ï¼Œæ˜¯ç”± Stephen Marz åœ¨ä»–çš„ç³»åˆ—åšå®¢ä¸­æä¾›çš„æ“ä½œç³»ç»Ÿå¼€å‘æ•™ç¨‹ã€‚ æœ¬ç« æè¿°å®éªŒç¯å¢ƒçš„æ­å»ºã€‚","text":"ROSR æ˜¯ã€RISC-V OS using Rustã€çš„ç¼©å†™ï¼Œæ˜¯ç”± Stephen Marz åœ¨ä»–çš„ç³»åˆ—åšå®¢ä¸­æä¾›çš„æ“ä½œç³»ç»Ÿå¼€å‘æ•™ç¨‹ã€‚ æœ¬ç« æè¿°å®éªŒç¯å¢ƒçš„æ­å»ºã€‚ å¼€å‘ç¯å¢ƒæ­å»ºç°åœ¨ Rust ç¼–è¯‘å™¨å·²ç»å¢åŠ äº†å¯¹ RISC-V çš„æ”¯æŒï¼Œæ‰€ä»¥æ­å»ºå¼€å‘ç¯å¢ƒå˜å¾—å®¹æ˜“äº†å¾ˆå¤šï¼š å®‰è£… rustup é…ç½® Rust ç¼–è¯‘ç¯å¢ƒ å®‰è£… RISC-V äº¤å‰ç¼–è¯‘å·¥å…·é“¾ å®‰è£… QEMU çš„ RISC-V æ¨¡æ‹Ÿç¯å¢ƒ åœ¨ Ubuntu 20.04 ä¸Šæ­å»ºå¼€å‘ç¯å¢ƒçš„å…·ä½“æ­¥éª¤å¦‚ä¸‹ï¼š å®‰è£… rustupå‚è€ƒ Rust å®˜æ–¹æ–‡æ¡£ã€‚ é…ç½® Rust ç¼–è¯‘ç¯å¢ƒå‘½ä»¤è¡Œæ‰§è¡Œï¼š 123rustup default nightlyrustup target add riscv64gc-unknown-none-elfcargo install cargo-binutils ä½¿ç”¨ nightly æ„å»ºæ˜¯å› ä¸ºéœ€è¦ä½¿ç”¨ä¸€äº› Rust çš„ç¨³å®šç‰ˆæœ¬ä¸­æ²¡æœ‰çš„è¯­è¨€ç‰¹æ€§ #![features]ã€‚ å®‰è£… RISC-V äº¤å‰ç¼–è¯‘å·¥å…·é“¾ä½¿ç”¨ ubuntu è½¯ä»¶ä»“æä¾›çš„å·¥å…·é“¾ï¼š 12sudo apt updatesudo apt install gcc-riscv64-unknown-elf å®‰è£… QEMU çš„ RISC-V æ¨¡æ‹Ÿç¯å¢ƒ1sudo apt install qemu-system-riscv64 åˆ›å»ºå·¥ç¨‹1cargo new myos --lib åœ¨ Cargo.toml é¡¹ç›®é…ç½®æ–‡ä»¶ä¸­å¢åŠ ï¼š 12[lib]crate-type = [&quot;staticlib&quot;] åˆ›å»º .cargo/config æ–‡ä»¶ï¼š 123456[build]target = &quot;riscv64gc-unknown-none-elf&quot;rustflags = [&#x27;-Clink-arg=-Tsrc/lds/virt.lds&#x27;][target.riscv64gc-unknown-none-elf]runner = &quot;qemu-system-riscv64 -machine virt -cpu rv64 -smp 4 -m 128M -drive if=none,format=raw,file=hdd.dsk,id=foo -device virtio-blk-device,scsi=off,drive=foo -nographic -serial mon:stdio -bios none -device virtio-rng-device -device virtio-gpu-device -device virtio-net-device -device virtio-tablet-device -device virtio-keyboard-device -kernel &quot; åœ¨ src/lds/ ç›®å½•ä¸­åˆ›å»º linker script virt.ldsï¼š 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849OUTPUT_ARCH( &quot;riscv&quot; )ENTRY( _start )MEMORY&#123; ram (wxa!ri) : ORIGIN = 0x80000000, LENGTH = 128M&#125;PHDRS&#123; text PT_LOAD; data PT_LOAD; bss PT_LOAD;&#125;SECTIONS&#123; .text : &#123; PROVIDE(_text_start = .); *(.text.init) *(.text .text.*) PROVIDE(_text_end = .); &#125; &gt;ram AT&gt;ram :text PROVIDE(_global_pointer = .); .rodata : &#123; PROVIDE(_rodata_start = .); *(.rodata .rodata.*) PROVIDE(_rodata_end = .); &#125; &gt;ram AT&gt;ram :text .data : &#123; . = ALIGN(4096); PROVIDE(_data_start = .); *(.sdata .sdata.*) *(.data .data.*) PROVIDE(_data_end = .); &#125; &gt;ram AT&gt;ram :data .bss :&#123; PROVIDE(_bss_start = .); *(.sbss .sbss.*) *(.bss .bss.*) PROVIDE(_bss_end = .); &#125; &gt;ram AT&gt;ram :bss PROVIDE(_memory_start = ORIGIN(ram)); PROVIDE(_stack = _bss_end + 0x80000); PROVIDE(_memory_end = ORIGIN(ram) + LENGTH(ram)); PROVIDE(_heap_start = _stack); PROVIDE(_heap_size = _memory_end - _stack);&#125; åˆ›å»º makefileï¼š 1234567891011121314151617181920212223242526272829303132333435363738####### BUILD#####CC=riscv64-unknown-elf-g++CFLAGS=-Wall -Wextra -pedantic -Wextra -O0 -g -std=c++17CFLAGS+=-static -ffreestanding -nostdlib -fno-rtti -fno-exceptionsCFLAGS+=-march=rv64gc -mabi=lp64dINCLUDES=LINKER_SCRIPT=-Tsrc/lds/virt.ldsTYPE=debugRUST_TARGET=./target/riscv64gc-unknown-none-elf/$(TYPE)LIBS=-L$(RUST_TARGET)SOURCES_ASM=$(wildcard src/asm/*.S)LIB=-lsos -lgccOUT=os.elf####### QEMU#####QEMU=qemu-system-riscv64MACH=virtCPU=rv64CPUS=4MEM=128MDRIVE=hdd.dskall: cargo build $(CC) $(CFLAGS) $(LINKER_SCRIPT) $(INCLUDES) -o $(OUT) $(SOURCES_ASM) $(LIBS) $(LIB) run: all $(QEMU) -machine $(MACH) -cpu $(CPU) -smp $(CPUS) -m $(MEM) -nographic -serial mon:stdio -bios none -kernel $(OUT) -drive if=none,format=raw,file=$(DRIVE),id=foo -device virtio-blk-device,scsi=off,drive=foo.PHONY: cleanclean: cargo clean rm -f $(OUT) åˆ›å»ºç¡¬ç›˜é•œåƒï¼š 1dd if=/dev/zero of=hdd.dsk count=32 bs=1M","categories":[],"tags":[{"name":"RISC-V","slug":"RISC-V","permalink":"https://blog.mahyang.uk/tags/RISC-V/"},{"name":"OS","slug":"OS","permalink":"https://blog.mahyang.uk/tags/OS/"},{"name":"Rust","slug":"Rust","permalink":"https://blog.mahyang.uk/tags/Rust/"}]},{"title":"Asterisk äº¤å‰ç¼–è¯‘","slug":"asterisk-cross-compilation","date":"2021-11-02T02:06:11.000Z","updated":"2021-11-10T06:37:16.000Z","comments":true,"path":"2021/11/02/asterisk-cross-compilation/","link":"","permalink":"https://blog.mahyang.uk/2021/11/02/asterisk-cross-compilation/","excerpt":"æœ¬æ–‡å°†ä»‹ç»å¦‚ä½•äº¤å‰ç¼–è¯‘ Asteriskã€‚","text":"æœ¬æ–‡å°†ä»‹ç»å¦‚ä½•äº¤å‰ç¼–è¯‘ Asteriskã€‚ ç¯å¢ƒä»‹ç»å¼€å‘ç¯å¢ƒï¼š æ“ä½œç³»ç»Ÿ: Ubuntu 20.04 LTS CPU æ¶æ„: x86_64 ç›®æ ‡ç¯å¢ƒï¼š æ“ä½œç³»ç»Ÿ: Linux å¹³å°(å†…æ ¸ç‰ˆæœ¬ 2.6.32) CPU æ¶æ„: mipsel Asterisk ä¾èµ–è¦æ±‚Asterisk ä¸å„æ¨¡å—é—´çš„ä¾èµ–å¦‚ä¸‹å›¾ï¼š å¼€å‘ç¯å¢ƒå‡†å¤‡å®‰è£…å¿…å¤‡çš„æ„å»ºå·¥å…·ï¼š 1234567891011sudo apt install -y \\ build-essential \\ autoconf \\ automake \\ bison \\ flex \\ git \\ libtool \\ libtool-bin \\ make \\ pkg-config å‡†å¤‡äº¤å‰ç¼–è¯‘å·¥å…·é“¾ï¼š è¿™ä¸€æ­¥éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåœ¨å®‰è£…äº¤å‰ç¼–è¯‘å·¥å…·é“¾æ—¶ï¼Œéœ€è¦æŒ‡å®šä¸€ä¸ªç›®æ ‡æ¶æ„ï¼Œè¿™é‡Œæˆ‘ä»¬ä½¿ç”¨ mipselï¼Œè¿™ä¸ªæ¶æ„æ˜¯ mipsel-linux-gnu-gcc çš„ç›®æ ‡æ¶æ„ã€‚ å¯¹äº mipsel æ¶æ„æ‰€å¯¹åº”çš„äº¤å‰ç¼–è¯‘å·¥å…·è½¯ä»¶åŒ…å¯ä»ä¸Šæ¸¸å‚å•†å¤„è·å–ã€‚å…¶ä»–æ¶æ„å¦‚ armã€arm64 å¯ä» ARM å®˜æ–¹ä¸‹è½½ï¼Œæˆ–ç›´æ¥é€šè¿‡è½¯ä»¶åŒ…ç®¡ç†å·¥å…·è·å–ï¼ˆdebian ä»“åº“ï¼‰ï¼Œæˆ–è€…ä¸‹è½½ç¬¬ä¸‰æ–¹æä¾›çš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼ˆå¦‚ Linaro æä¾›ï¼‰ã€‚ å·¥ä½œç›®å½•å‡†å¤‡ï¼š 12345MIPSEL_Cross-Compileâ”œâ”€â”€ build_optâ”œâ”€â”€ build_sourceâ”œâ”€â”€ build_startâ””â”€â”€ toolchain å»ºç«‹ç›®å½• MIPSEL_Cross-Compile ä¸å­ç›®å½• build_optã€build_sourceã€build_startã€toolchainï¼Œå¹¶å°† MIPSEL_Cross-Compile/toolchain ç›®å½•ä¸­çš„äº¤å‰ç¼–è¯‘å·¥å…·é“¾æ·»åŠ åˆ°ç¯å¢ƒå˜é‡ä¸­ï¼Œä»¥ä¾¿åç»­çš„ç¼–è¯‘æ“ä½œå¯ä»¥ä½¿ç”¨ã€‚ 12export PATH=&quot;$PATH:/home/ubuntu/MIPSEL_Cross-Compile/toolchain/gcc-4.4-gnu/bin&quot;export LD_LIBRARY_PATH=&quot;$LD_LIBRARY_PATH:/home/ubuntu/MIPSEL_Cross-Compile/toolchain/gcc-4.4-gnu/mipsel-linux/lib&quot; build_opt: å­˜æ”¾ç¼–è¯‘åäº§ç”Ÿçš„å¯æ‰§è¡Œæ–‡ä»¶ã€åº“æ–‡ä»¶ç­‰ build_source: å­˜æ”¾æºä»£ç å‹ç¼©åŒ… build_start: å­˜æ”¾æºä»£ç  toolchain: å­˜æ”¾äº¤å‰ç¼–è¯‘å·¥å…·é“¾ å‡†å¤‡æºä»£ç ï¼š å„ä¸ªæ‰€éœ€æ¨¡å—çš„æºä»£ç é€šè¿‡ä¸‹è½½è·å–ï¼ˆæœç´¢ä¸€ä¸‹ä¾¿å¯å¾—åˆ°ä¸‹è½½åœ°å€ï¼‰ï¼Œå¹¶å°†æºä»£ç å‹ç¼©åŒ…æ‹·è´åˆ° build_source ç›®å½•ä¸­ã€‚ 12345678910asterisk-18-current.tar.gzasterisk-g72x.zipbcg729-1.1.1.tar.gzlibedit-20210910-3.1.tar.gzlibuuid-1.0.3.tar.gzlibxml2-2.9.12.tar.gzncurses-6.2.tar.gzopenssl-1.1.1l.tar.gzsqlite-autoconf-3360000.tar.gzzlib-1.2.11.tar.gz å°†è¿™äº›å‹ç¼©åŒ…éƒ½è§£å‹åˆ° build_start ç›®å½•ä¸­ã€‚ äº¤å‰ç¼–è¯‘ç¼–è¯‘é¡ºåºä¸ºï¼š 12345678910ncurseslibeditsqlite3libuuidzliblibxml2opensslasteriskbcg729asterisk-g72x ncurses12345678910cd /home/ubuntu/MIPSEL_Cross-Compile/build_start/ncurses-6.2CC=mipsel-linux-gcc CXX=mipsel-linux-g++ \\./configure --build=x86_64-linux-gnu --host=mipsel-none-linux-gnu \\--disable-stripping \\--with-shared --without-ada --enable-termcap \\--with-build-cc=gcc --with-build-cpp=gcc \\--prefix=/home/ubuntu/MIPSEL_Cross-Compile/build_opt/ncurses_build_for_mipselmake &amp;&amp; make install Tips: å‚æ•° --with-build-cc ä»¥åŠ --with-build-cpp æŒ‡å®šçš„æ˜¯å¼€å‘ç¯å¢ƒæœ¬åœ°ç¼–è¯‘ä½¿ç”¨çš„ gcc å·¥å…·é“¾ï¼Œè€Œéäº¤å‰ç¼–è¯‘å·¥å…·é“¾ã€‚ libedit123456789cd /home/ubuntu/MIPSEL_Cross-Compile/build_start/libedit-20210910-3.1CC=mipsel-linux-gcc \\CFLAGS=&quot;-I/home/ubuntu/MIPSEL_Cross-Compile/build_opt/ncurses_build_for_mipsel/include -I/home/ubuntu/MIPSEL_Cross-Compile/build_opt/ncurses_build_for_mipsel/include/ncurses&quot; \\LDFLAGS=&quot;-L/home/ubuntu/MIPSEL_Cross-Compile/build_opt/ncurses_build_for_mipsel/lib&quot; \\./configure --build=x86_64-linux-gnu --host=mipsel-none-linux-gnu \\--prefix=/home/ubuntu/MIPSEL_Cross-Compile/build_opt/libedit_build_for_mipselmake &amp;&amp; make install Tips: libedit ä¾èµ–äº ncursesï¼Œæ‰€ä»¥éœ€è¦æŒ‡å®š CFLAGSã€LDFLAGS ç­‰å‚æ•°ï¼Œä»¥ä¾¿ç¼–è¯‘æ—¶èƒ½å¤Ÿæ­£ç¡®æœç´¢ ncurses ç›¸å…³çš„å¤´æ–‡ä»¶å’Œåº“æ–‡ä»¶ã€‚ sqlite31234567cd /home/ubuntu/MIPSEL_Cross-Compile/build_start/sqlite-autoconf-3360000CC=mipsel-linux-gcc CXX=mipsel-linux-g++ \\./configure --build=x86_64-linux-gnu --host=mipsel-none-linux-gnu \\--prefix=/home/ubuntu/MIPSEL_Cross-Compile/build_opt/sqlite3_build_for_mipselmake &amp;&amp; make install libuuid1234567cd /home/ubuntu/MIPSEL_Cross-Compile/build_start/libuuid-1.0.3CC=mipsel-linux-gcc CXX=mipsel-linux-g++ \\./configure --build=x86_64-linux-gnu --host=mipsel-none-linux-gnu \\--prefix=/home/ubuntu/MIPSEL_Cross-Compile/build_opt/libuuid_build_for_mipselmake &amp;&amp; make install zlib123456cd /home/ubuntu/MIPSEL_Cross-Compile/build_start/zlib-1.2.11CC=mipsel-linux-gcc CXX=mipsel-linux-g++ \\./configure --prefix=/home/ubuntu/MIPSEL_Cross-Compile/build_opt/zlib_build_for_mipselmake &amp;&amp; make install libxml2123456789cd /home/ubuntu/MIPSEL_Cross-Compile/build_start/libxml2-2.9.12./autogen.sh CC=mipsel-linux-gcc \\CFLAGS=&quot;-I/home/ubuntu/MIPSEL_Cross-Compile/build_opt/zlib_build_for_mipsel/include&quot; \\LDFLAGS=&quot;-L/home/ubuntu/MIPSEL_Cross-Compile/build_opt/zlib_build_for_mipsel/lib&quot; \\--build=x86_64-linux-gnu --host=mipsel-none-linux-gnu \\--prefix=/home/ubuntu/MIPSEL_Cross-Compile/build_opt/libxml2_build_for_mipselmake &amp;&amp; make install Tips: libxml2 ä¾èµ–äº zlibï¼Œæ‰€ä»¥éœ€è¦æŒ‡å®š CFLAGSã€LDFLAGS ç­‰å‚æ•°ï¼Œä»¥ä¾¿ç¼–è¯‘æ—¶èƒ½å¤Ÿæ­£ç¡®æœç´¢ zlib ç›¸å…³çš„å¤´æ–‡ä»¶å’Œåº“æ–‡ä»¶ã€‚ Notice: ä¸å‰é¢ç¼–è¯‘å‘½ä»¤ä¸åŒ libxml2 ä½¿ç”¨ ./autogen.sh è€Œä¸æ˜¯ ./configureï¼Œautogen.sh ä¼šç”Ÿæˆå¹¶è¿è¡Œ configure åŒæ—¶å°†ä¼ ç»™ autogen.sh çš„ç¼–è¯‘å‚æ•°ä¼ ç»™ configureã€‚ openssl123456789101112cd /home/ubuntu/MIPSEL_Cross-Compile/build_start/openssl-1.1.1l./Configure linux-mips32 \\--prefix=/home/ubuntu/MIPSEL_Cross-Compile/build_opt/openssl_build_for_mipsel \\--openssldir=/home/ubuntu/MIPSEL_Cross-Compile/build_opt/openssl_build_for_mipsel \\sharedsed -i &quot;s/\\(CROSS_COMPILE=\\).*/\\1mipsel-linux-/g&quot; Makefilesed -i &quot;s/\\(CFLAGS=.*\\)/\\1 -mabi=32 -mglibc -march=mips32/g&quot; Makefilesed -i &quot;s/\\(CXXFLAGS=.*\\)/\\1 -mabi=32 -mglibc -march=mips32/g&quot; Makefilemake &amp;&amp; make install Notice: Configure æ˜¯å¤§å†™çš„ Cï¼Œå¹¶ä¸”æ‰§è¡Œå®Œæˆåéœ€è¦æ‰‹åŠ¨ä¿®æ”¹ Makefileã€‚ asteriskè®¾ç½®ç¼–è¯‘ Asterisk ä½¿ç”¨çš„ CFLAGSã€LDFLAGS å‚æ•°ï¼š 123456789101112131415161718AST_CFLAGS=&quot;-I/home/ubuntu/MIPSEL_Cross-Compile/build_opt/ncurses_build_for_mipsel/include&quot;AST_CFLAGS=&quot;$AST_CFLAGS -I/home/ubuntu/MIPSEL_Cross-Compile/build_opt/ncurses_build_for_mipsel/include/ncurses&quot;AST_CFLAGS=&quot;$AST_CFLAGS -I/home/ubuntu/MIPSEL_Cross-Compile/build_opt/libedit_build_for_mipsel/include&quot;AST_CFLAGS=&quot;$AST_CFLAGS -I/home/ubuntu/MIPSEL_Cross-Compile/build_opt/sqlite3_build_for_mipsel/include&quot;AST_CFLAGS=&quot;$AST_CFLAGS -I/home/ubuntu/MIPSEL_Cross-Compile/build_opt/libuuid_build_for_mipsel/include&quot;AST_CFLAGS=&quot;$AST_CFLAGS -I/home/ubuntu/MIPSEL_Cross-Compile/build_opt/zlib_build_for_mipsel/include&quot;AST_CFLAGS=&quot;$AST_CFLAGS -I/home/ubuntu/MIPSEL_Cross-Compile/build_opt/libxml2_build_for_mipsel/include&quot;AST_CFLAGS=&quot;$AST_CFLAGS -I/home/ubuntu/MIPSEL_Cross-Compile/build_opt/libxml2_build_for_mipsel/include/libxml2&quot;AST_CFLAGS=&quot;$AST_CFLAGS -I/home/ubuntu/MIPSEL_Cross-Compile/build_opt/openssl_build_for_mipsel/include&quot;AST_LDFLAGS=&quot;-L/home/ubuntu/MIPSEL_Cross-Compile/build_opt/ncurses_build_for_mipsel/lib&quot;AST_LDFLAGS=&quot;$AST_LDFLAGS -L/home/ubuntu/MIPSEL_Cross-Compile/build_opt/libedit_build_for_mipsel/lib&quot;AST_LDFLAGS=&quot;$AST_LDFLAGS -L/home/ubuntu/MIPSEL_Cross-Compile/build_opt/sqlite3_build_for_mipsel/lib&quot;AST_LDFLAGS=&quot;$AST_LDFLAGS -L/home/ubuntu/MIPSEL_Cross-Compile/build_opt/libuuid_build_for_mipsel/lib&quot;AST_LDFLAGS=&quot;$AST_LDFLAGS -L/home/ubuntu/MIPSEL_Cross-Compile/build_opt/zlib_build_for_mipsel/lib&quot;AST_LDFLAGS=&quot;$AST_LDFLAGS -L/home/ubuntu/MIPSEL_Cross-Compile/build_opt/libxml2_build_for_mipsel/lib&quot;AST_LDFLAGS=&quot;$AST_LDFLAGS -L/home/ubuntu/MIPSEL_Cross-Compile/build_opt/openssl_build_for_mipsel/lib&quot;AST_LDFLAGS=&quot;$AST_LDFLAGS -lncurses&quot; è®¾ç½® Asterisk è¿è¡Œæ—¶è·¯å¾„ï¼š 1AST_RUNTIME_DIR=&quot;/root&quot; å¼€å§‹ç¼–è¯‘ï¼š 123456789101112131415161718192021222324CC=mipsel-linux-gcc CXX=mipsel-linux-g++ AR=mipsel-linux-ar RANLIB=mipsel-linux-ranlib \\CFLAGS=$AST_CLFAGS LDFLAGS=$AST_LDFLAGS \\./configure --build=x86_64-linux-gnu --host=mipsel-none-linux-gnu \\--prefix=$AST_RUNTIME_DIR/build_opt/asterisk_build_for_mipsel \\--with-libedit=/home/ubuntu/MIPSEL_Cross-Compile/build_opt/libedit_build_for_mipsel \\--with-sqlite3=/home/ubuntu/MIPSEL_Cross-Compile/build_opt/sqlite3_build_for_mipsel \\--with-libxml2=/home/ubuntu/MIPSEL_Cross-Compile/build_opt/libxml2_build_for_mipsel \\--with-crypto=/home/ubuntu/MIPSEL_Cross-Compile/build_opt/openssl_build_for_mipsel \\--with-ssl=/home/ubuntu/MIPSEL_Cross-Compile/build_opt/openssl_build_for_mipsel \\--without-bluetooth \\--without-dahdi \\--with-jansson-bundled \\--with-pjproject-bundled \\--without-ldap \\--without-netsnmp \\--without-pri \\--disable-xmldocmake menuselect/menuselect menuselect-tree menuselect.makeoptsmenuselect/menuselect --enable-allmakemake install DESTDIR=/home/ubuntu/MIPSEL_Cross-Compile/build_opt/asterisk_build_for_mipselmake samples DESTDIR=/home/ubuntu/MIPSEL_Cross-Compile/build_opt/asterisk_build_for_mipsel Tips: å¦‚æœç¬¬ 19 è¡ŒæŠ¥é”™ï¼Œåˆ™å†è¿è¡Œä¸€æ¬¡å³å¯ã€‚ ç”±äºæŒ‡å®šçš„è¿è¡Œè·¯å¾„å’Œå®‰è£…è·¯å¾„æœ‰å¯èƒ½ä¸ä¸€è‡´ï¼Œæ‰€ä»¥éœ€è¦ä¿®å¤ä¸€ä¸‹ï¼š 123mv /home/ubuntu/MIPSEL_Cross-Compile/build_opt/asterisk_build_for_mipsel/$AST_RUNTIME_DIR/build_opt/asterisk_build_for_mipsel /tmp/ast_tmprm -rf /home/ubuntu/MIPSEL_Cross-Compile/build_opt/asterisk_build_for_mipselmv /tmp/ast_tmp /home/ubuntu/MIPSEL_Cross-Compile/build_opt/asterisk_build_for_mipsel bcg729123456cd /home/ubuntu/MIPSEL_Cross-Compile/build_start/bcg729-1.1.1CC=mipsel-linux-gcc \\cmake . -DCMAKE_INSTALL_PREFIX=/home/ubuntu/MIPSEL_Cross-Compile/build_opt/bcg729_build_for_mipselmake &amp;&amp; make install Tips: bcg729 æœ€è¿‘çš„å‡ ä¸ªç‰ˆæœ¬æ”¹ä¸ºä½¿ç”¨ cmake æ„å»ºï¼Œå¦‚æœéœ€è¦ç”¨ configure çš„æ„å»ºæ–¹å¼ä¸‹è½½æ—§ç‰ˆæœ¬å³å¯ã€‚ asterisk-g72x123456789101112cd /home/ubuntu/MIPSEL_Cross-Compile/build_start/asterisk-g72x-master./autogen.shCC=mipsel-linux-gcc \\CFLAGS=&quot;-O3 -fomit-frame-pointer -I/home/ubuntu/MIPSEL_Cross-Compile/build_opt/bcg729_build_for_mipsel/include&quot; \\LDFLAGS=&quot;-L/home/ubuntu/MIPSEL_Cross-Compile/build_opt/bcg729_build_for_mipsel/lib&quot; \\./configure --build=x86_64-linux-gnu --host=mipsel-none-linux-gnu \\--prefix=/home/ubuntu/MIPSEL_Cross-Compile/build_opt/asterisk_build_for_mipsel \\--with-bcg729 \\--with-asterisk-includes=/home/ubuntu/MIPSEL_Cross-Compile/build_start/asterisk-18.7.1/includemake &amp;&amp; make install Tips: --with-asterisk-includes å‚æ•°æŒ‡å®š Asterisk æºä»£ç è·¯å¾„ä¸­çš„å¤´æ–‡ä»¶ã€‚ åº“å®‰è£…æœ€åï¼Œå°†å‰é¢ç¼–è¯‘å‡ºçš„æ‰€æœ‰åŠ¨æ€é“¾æ¥åº“ï¼ˆé™¤ asterisk ä»¥åŠ asterisk-g72x å¤–ï¼‰éƒ½æ”¾ç½®åˆ° Asterisk çš„è¿è¡Œç›®å½•ä¸­ã€‚ é™„å½•å°†ä»¥ä¸Šæè¿°çš„è¿‡ç¨‹æ•´ç†æˆä¸€ä¸ª Makefile æ–‡ä»¶ï¼Œå¦‚ä¸‹ï¼š","categories":[],"tags":[{"name":"Asterisk","slug":"Asterisk","permalink":"https://blog.mahyang.uk/tags/Asterisk/"},{"name":"Cross Compilation","slug":"Cross-Compilation","permalink":"https://blog.mahyang.uk/tags/Cross-Compilation/"}]},{"title":"ä½¿ç”¨ SIPp æµ‹è¯• Asterisk å¤„ç†èƒ½åŠ›","slug":"testing-asterisk-using-sipp","date":"2021-03-05T09:06:27.000Z","updated":"2021-03-05T09:06:27.000Z","comments":true,"path":"2021/03/05/testing-asterisk-using-sipp/","link":"","permalink":"https://blog.mahyang.uk/2021/03/05/testing-asterisk-using-sipp/","excerpt":"æœ¬æ–‡å°†ç®€å•ä»‹ç» SIPp çš„ä½¿ç”¨æ–¹æ³•ï¼Œç„¶åé‡ç‚¹ä»‹ç»å¦‚ä½•ä½¿ç”¨ SIPp å¯¹ Asterisk æœåŠ¡è¿›è¡Œ SIP æ³¨å†Œä¸é€šè¯æµ‹è¯•ã€‚","text":"æœ¬æ–‡å°†ç®€å•ä»‹ç» SIPp çš„ä½¿ç”¨æ–¹æ³•ï¼Œç„¶åé‡ç‚¹ä»‹ç»å¦‚ä½•ä½¿ç”¨ SIPp å¯¹ Asterisk æœåŠ¡è¿›è¡Œ SIP æ³¨å†Œä¸é€šè¯æµ‹è¯•ã€‚ ç¯å¢ƒæœ¬æ–‡æ‰€æœ‰æ“ä½œåœ¨ Ubuntu 20.04 å’Œ Debian 10 æ“ä½œç³»ç»Ÿä¸Šå®Œæˆã€‚ SIPpSIPp æ˜¯ä¸€æ¬¾é’ˆå¯¹ SIP åè®®çš„å¼€æºæµ‹è¯•å·¥å…·ï¼Œä½¿ç”¨æ­¤å·¥å…·å¯ä»¥è‡ªå®šä¹‰å‘é€å„ç±» SIP åè®®è¯·æ±‚ä»¥åŠæ¥æ”¶åˆ†æ SIP åè®®å“åº”ï¼Œå¯ç”¨äºæ¨¡æ‹Ÿ VoIP é€šè¯è¿›è¡Œè¯éŸ³æµ‹è¯•ã€‚ è½¯ä»¶å®‰è£…ä¸‹è½½å¹¶è§£å‹æºç ï¼š 1wget -c https://github.com/SIPp/sipp/releases/download/v3.6.1/sipp-3.6.1.tar.gz -O - | tar -xz -C /tmp ç¼–è¯‘å®‰è£…ï¼š 1234cd /tmp/sipp-3.6.1./build.sh --commonmake -j4sudo make install ä½¿ç”¨æ–¹æ³•SIPp çš„è¯¦ç»†ä½¿ç”¨æ–¹æ³•è¯·å‚è€ƒå®˜æ–¹æ‰‹å†Œã€‚æ­¤å¤–å¯ä½¿ç”¨ sipp -h å‘½ä»¤æŸ¥çœ‹ SIPp è½¯ä»¶çš„å‘½ä»¤è¡Œå‚æ•°è¯´æ˜ã€‚ å‘½ä»¤è¡Œå‚æ•°SIPp ä½¿ç”¨ XML æè¿°è¯­è¨€æ¥æè¿°è½¯ä»¶äº¤äº’è¡Œä¸ºï¼ˆæƒ…æ™¯ï¼‰ï¼Œå¯é€šè¿‡å‘½ä»¤è¡Œå‚æ•° -sf æŒ‡å®šè‡ªå®šä¹‰çš„ XML æ–‡ä»¶ï¼š 1sipp -sf &lt;your_xml_file&gt; åŒæ—¶ SIPp ä¹Ÿå†…ç½®äº†ä¸€äº› XML æ–‡ä»¶æ¥æè¿°ä¸€äº›ç‰¹å®šåœºæ™¯çš„äº¤äº’è¿‡ç¨‹ï¼Œå¯é€šè¿‡ -sn å‘½ä»¤è¡Œå‚æ•°åŠ è½½å†…ç½®æ–‡ä»¶ï¼š 1sipp -sn &lt;default_xml_file&gt; ä¾‹å¦‚ï¼Œè¿è¡Œ SIPp å†…ç½®çš„ SIP æœåŠ¡ç«¯ç¤ºä¾‹ï¼š 1./sipp -sn uas åœ¨åŒä¸€å°ç”µè„‘ä¸Šå†è¿è¡Œ SIPp å†…ç½®çš„ SIP å®¢æˆ·ç«¯ç¤ºä¾‹ï¼š 1./sipp -sn uac 127.0.0.1 æ­¤æ—¶ SIPp ä¾¿å¼€å§‹æ‰§è¡Œæµ‹è¯•æµç¨‹ï¼Œç•Œé¢å¦‚ä¸‹ï¼š æˆ‘ä»¬ä¸ä½†å¯ä»¥ä¼ é€’é¢„è®¾å‚æ•°ç»™ SIPpï¼Œå¯èƒ½ä¼ é€’è‡ªå®šä¹‰å‚æ•°ï¼Œè‡ªå®šä¹‰å‚æ•°ä¿å­˜åœ¨ csv æ–‡ä»¶ä¸­ï¼Œå¯é€šè¿‡å¦‚ä¸‹æ–¹å¼ä¼ å…¥ï¼š 1sipp -inf &lt;your_csv_file&gt; SIPp ä½¿ç”¨çš„ csv æ–‡ä»¶ç¬¬ä¸€è¡ŒæŒ‡å®šè¯»å–æ–¹å¼ï¼š SEQUENTIAL é¡ºåºè¯»å– RANDOM éšå³è¯»å– USER åŸºäºç”¨æˆ·è¯»å– ä»ç¬¬2è¡Œå¼€å§‹ä¾¿æ˜¯ SIPp è¯»å–çš„æ•°æ®ï¼Œæ¯ä¸ªæµ‹è¯•å®ä¾‹è¯»å–ä¸€è¡Œï¼Œæ¯è¡Œä¸­çš„å‚æ•°ä»¥ ; å·éš”å¼€ï¼š 1uklar;age;address åœ¨ XML æ–‡ä»¶ä¸­å¼•ç”¨å¦‚ä¸Šå‚æ•°åˆ™åˆ†åˆ«ä½¿ç”¨ [field0]ã€[field1]ã€[field2]ã€‚ XML æƒ…æ™¯æè¿°è¿™é‡Œç”¨ SIP æ³¨å†Œä¸ºä¾‹è®²è§£å¦‚ä½•ç¼–å†™æƒ…æ™¯æè¿°æ–‡ä»¶ã€‚ SIPp ä½¿ç”¨çš„ XML æè¿°æ–‡ä»¶å‡ä»¥å¦‚ä¸‹å†…å®¹å¼€å¤´ï¼š 12&lt;?xml version=&quot;1.0&quot; encoding=&quot;ISO-8859-1&quot; ?&gt;&lt;!DOCTYPE scenario SYSTEM &quot;sipp.dtd&quot;&gt; æ¥ç€ä¾¿æ˜¯æè¿°æƒ…æ™¯çš„ sectionï¼š 123&lt;scenario name=&quot;My UAC registor&quot;&gt;&lt;!-- describe your scenario here --&gt;&lt;/scenario&gt; æ‰€æœ‰çš„äº¤äº’åŠ¨ä½œå‡è¦ç¼–å†™åœ¨ &lt;scenario/&gt; section é‡Œã€‚ æ ¹æ® SIP åè®®ç¤ºä¾‹æ–‡æ¡£ï¼ˆrfc3665ï¼‰ç¡®å®šäº¤äº’æµç¨‹ï¼š æ³¨å†Œäº¤äº’æµç¨‹UAC SIP Server | | | REGISTER | |---------------------------&gt;| | 401 Unauthorized | |&lt;---------------------------| | REGISTER | |---------------------------&gt;| | 200 OK | |&lt;---------------------------| | | æ ¹æ®äº¤äº’æµç¨‹ç¼–å†™åŸºæœ¬æ¡†æ¶ï¼š 123456789101112131415161718192021&lt;send retrans=&quot;500&quot;&gt; &lt;![CDATA[ REGISTER ]]&gt;&lt;/send&gt;&lt;recv response=&quot;401&quot; auth=&quot;true&quot;&gt;&lt;/recv&gt;&lt;send retrans=&quot;500&quot;&gt; &lt;![CDATA[ REGISTER ]]&gt;&lt;/send&gt;&lt;recv response=&quot;200&quot; crlf=&quot;true&quot;&gt;&lt;/recv&gt; å…¶ä¸­ &lt;![CDATA[ ... ]]&gt; ç”¨äºæŒ‡å®š SIPp å‘é€çš„ SIP åè®®å¸§å†…å®¹ï¼Œæˆ‘ä»¬å¯ä»¥æ ¹æ®ä¸åŒçš„åœºæ™¯è‡ªå®šä¹‰å¸§å†…å®¹ã€‚ ä¾‹å¦‚ï¼Œæ¨¡æ‹Ÿå®¢æˆ·ç«¯ 101 å‘æœåŠ¡å™¨ï¼ˆasteriskï¼‰ 192.168.199.59 å‘é€ SIP æ³¨å†Œè¯·æ±‚ï¼š 1234567891011121314&lt;![CDATA[ REGISTER sip:192.168.199.59 SIP/2.0 Via: SIP/2.0/[transport] [local_ip]:[local_port];branch=[branch] Max-Forwards: 70 From: &quot;101&quot; &lt;sip:101@192.168.199.59&gt;;tag=[pid]101[call_number] To: &quot;101&quot; &lt;sip:101@192.168.199.59&gt; Call-ID: [call_id] CSeq: 1 REGISTER Contact: &lt;sip:101@[local_ip]:[local_port]&gt;;transport=[transport] Expires: 3600 Content-Length: 0]]&gt; å¦‚ä¸Šï¼Œæ‰€æœ‰ [] å†…çš„å­—æ®µå‡å¯é€šè¿‡å‘½ä»¤è¡Œå‚æ•°æŒ‡å®šï¼Œæˆ– SIPp è‡ªåŠ¨å¡«å…¥é»˜è®¤å€¼ã€‚ å‘é€ SIP æ³¨å†Œæ¶ˆæ¯åï¼Œæˆ‘ä»¬ç­‰å¾…æœåŠ¡ç«¯å“åº” 401 æœªæˆæƒæ¶ˆæ¯ï¼Œç„¶åå‘é€æºå¸¦è®¤è¯ä¿¡æ¯çš„æ³¨å†Œè¯·æ±‚ï¼š 123456789101112131415&lt;![CDATA[ REGISTER sip:192.168.199.59 SIP/2.0 Via: SIP/2.0/[transport] [local_ip]:[local_port];branch=[branch] Max-Forwards: 70 From: &quot;101&quot; &lt;sip:101@192.168.199.59&gt;;tag=[pid]101[call_number] To: &quot;101&quot; &lt;sip:101@192.168.199.59&gt; Call-ID: [call_id] CSeq: 2 REGISTER Contact: &lt;sip:101@[local_ip]:[local_port]&gt;;transport=[transport] [authentication username=101 password=1234abcd] Expires: 3600 Content-Length: 0]]&gt; æˆ‘ä»¬åªéœ€åœ¨æ¶ˆæ¯å¸§ä¸­åŠ å…¥ [authentication username=USERNAME password=PASSWD]ï¼ŒSIPp ä¾¿å¯æ ¹æ®å‰ä¸€æ¡æ¶ˆæ¯çš„å†…å®¹è‡ªåŠ¨è®¡ç®—å¹¶å¡«å…¥è®¤è¯ä¿¡æ¯ã€‚ éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå®šä¹‰å‰ä¸€æ¡æ¶ˆæ¯æ—¶ï¼ˆè¿™é‡Œæ˜¯ 401ï¼‰ï¼Œéœ€è¦åŠ å…¥å±æ€§ auth=&quot;true&quot;ã€‚ æœ€åæˆ‘ä»¬ç­‰å¾…æœåŠ¡ç«¯å‘é€ 200 OK å“åº”ä»¥å®Œæˆ SIP æ³¨å†Œæµç¨‹ã€‚ æ‰¹é‡è¿è¡ŒSIPp çš„ä¸»è¦åŠŸèƒ½æ˜¯å°†å®šä¹‰çš„æƒ…æ™¯é€šè¿‡ä¸åŒçš„å‚æ•°å®ä¾‹åŒ–å‡ºå¤šä¸ªæµ‹è¯•è¿›ç¨‹ï¼Œå®ç°å¹¶å‘æµ‹è¯•ã€‚ è¿˜æ˜¯ä»¥ SIP æ³¨å†Œä¸ºä¾‹ï¼Œæˆ‘ä»¬å°†ä¹‹å‰çš„å•ç”¨æˆ·æ³¨å†Œæ”¹é€ ä¸ºå¤šç”¨æˆ·å¹¶å‘å‘æŒ‡å®šæœåŠ¡å™¨æ³¨å†Œï¼Œå‘½ä»¤è¡ŒæŒ‡ä»¤å¦‚ä¸‹ï¼š 1sipp -sf ./register.xml &lt;server_ip&gt; -i &lt;local_ip&gt; -users &lt;number_of_users&gt; -inf ./data.csv ç›¸åº”å‚æ•°çš„è§£é‡Šå¦‚ä¸‹ï¼š server_ipï¼šæŒ‡å®šæœåŠ¡ç«¯ IP åœ°å€ï¼Œåœ¨ XML æ–‡ä»¶ä¸­é€šè¿‡ [remote_ip] å¼•ç”¨ local_ipï¼šæŒ‡å®šå®¢æˆ·ç«¯ IP åœ°å€ï¼Œåœ¨ XML æ–‡ä»¶ä¸­é€šè¿‡ [local_ip] å¼•ç”¨ number_of_usersï¼šæŒ‡å®šåŒæ—¶å­˜åœ¨çš„ç”¨æˆ·æ•°é‡ å‡å®šæˆ‘ä»¬éœ€è¦åŒæ—¶å­˜åœ¨ 3 ä¸ªç”¨æˆ·å‘æœåŠ¡å™¨å‘èµ·æ³¨å†Œï¼Œåˆ™ï¼š data.csv æ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š 1234SEQUENTIAL101,[authentication username=101 password=1234abcd]102,[authentication username=102 password=1234abcd]103,[authentication username=103 password=1234abcd] å†ä¿®æ”¹å‰é¢ä¾‹å­ä¸­éƒ¨åˆ†å‚æ•°ï¼š æœåŠ¡ç«¯ IP åœ°å€ 192.168.199.59 æ›¿æ¢ä¸º [remote_ip] ç”¨æˆ·å 101 æ›¿æ¢ä¸º [field0] æˆæƒä¿¡æ¯ [authentication username=101 password=1234abcd] æ›¿æ¢ä¸º [field1] å¯åŠ¨æ‰¹é‡æ³¨å†Œæµ‹è¯•ï¼š 1sipp -sf ./register.xml 192.168.199.59 -i 192.168.199.30 -users 3 -inf ./data.csv é€šè¯æµ‹è¯•ä»¥ä¸‹æ“ä½œæµç¨‹ä¸­æ¶‰åŠåˆ°çš„æ–‡ä»¶éƒ½èƒ½ç‚¹å‡»æ­¤å¤„è·å–ã€‚ æ¨¡æ‹Ÿ SIP é€šè¯åœºæ™¯å¦‚ä¸‹å›¾ï¼š æ¨¡æ‹Ÿåœºæ™¯+---------------------------+ +---------------------------+ +----------------------------+| Host Caller | | Asterisk Server | | Host Callee || | | +&lt;---&gt;+ || N_Users: 49 +&lt;--&gt;+ N_Users: 98 | | N_Users: 48 || Codec : G729 | | Codecs : G711a G729 +&lt;-+ | Codec : G711a || IP : 192.168.199.30 | | IP : 192.168.199.59 | | | IP : 192.168.199.227 |+---------------------------+ +---------------------------+ | +----------------------------+ | | +----------------------------+ | | Yealink | | | | +-&gt;+ Codec : G711a | | IP : 192.168.199.35 | +----------------------------+ åœ¨ Asterisk æœåŠ¡å™¨ä¸Šåˆ›å»º 98 ä¸ªç”¨æˆ·ï¼š 123for i in &#123;101..198&#125;; do ext_manage.sh add $i; doneasterisk -rx &quot;core stop now&quot;asterisk åœ¨ Host Caller ä¸Šç”Ÿæˆ test_data.csv æ–‡ä»¶ï¼š 12echo &quot;SEQUENTIAL&quot; &gt; test_data.csvfor i in &#123;101..149&#125;; do echo &quot;$i;$(expr $i + 49);[authentication username=$i password=1234abcd];[authentication username=$(expr $i + 49) password=1234abcd]&quot; &gt;&gt; test_data.csv; done åœ¨ Host Callee ä¸Šç”Ÿæˆ test_data.csv æ–‡ä»¶ï¼š 12echo &quot;SEQUENTIAL&quot; &gt; test_data.csvfor i in &#123;101..148&#125;; do echo &quot;$i;$(expr $i + 49);[authentication username=$i password=1234abcd];[authentication username=$(expr $i + 49) password=1234abcd]&quot; &gt;&gt; test_data.csv; done åœ¨ Host Caller ä¸Šç”¨ SIPp æ³¨å†Œ 49 ä¸ªç”¨æˆ·ï¼š 1sudo sipp -sf ./my_caller_register.xml 192.168.199.59 -i 192.168.199.30 -users 49 -inf ./test_data.csv åœ¨ Host Callee ä¸Šç”¨ SIPp æ³¨å†Œ 48 ä¸ªç”¨æˆ·ï¼š 1sudo sipp -sf ./my_callee_register.xml 192.168.199.59 -i 192.168.199.227 -users 48 -inf ./test_data.csv åœ¨ Yealink ä¸Šä½¿ç”¨è´¦æˆ· 198 å‘æœåŠ¡å™¨æ³¨å†Œï¼Œå¹¶åœ¨è®¾ç½®ä¸­å…³é—­è§†é¢‘é€šè¯ï¼Œåªå¼€å¯ g711a è¯éŸ³ç¼–ç ã€‚ åœ¨ Host Callee ä¸Šç”¨ SIPp å¯åŠ¨æ¥æ”¶ 48 è·¯é€šè¯ï¼š 1sudo sipp -sf ./my_callee_flow.xml 192.168.199.59 -i 192.168.199.227 -users 48 -inf ./test_data.csv åœ¨ Host Caller ä¸Šç”¨ SIPp å¯åŠ¨å‘¼å« 49 è·¯é€šè¯ï¼š 1sudo sipp -sf ./my_caller_flow.xml 192.168.199.59 -i 192.168.199.30 -users 49 -inf ./test_data.csv æ­¤æ—¶æˆ‘ä»¬å¯ä»¥åœ¨ Yealink ä¸Šæ”¶åˆ°å‘¼å«ï¼Œæ¥å¬åå¯é€šè¿‡è¯éŸ³è´¨é‡æ¥ä¸»è§‚æ„Ÿå—æœåŠ¡å™¨å‹åŠ›çŠ¶æ€ã€‚ åŒæ—¶å¯æŸ¥çœ‹æœåŠ¡å™¨ CPU å ç”¨çŠ¶å†µï¼š","categories":[],"tags":[{"name":"æ“ä½œæ–¹æ³•","slug":"æ“ä½œæ–¹æ³•","permalink":"https://blog.mahyang.uk/tags/%E6%93%8D%E4%BD%9C%E6%96%B9%E6%B3%95/"},{"name":"QEMU","slug":"QEMU","permalink":"https://blog.mahyang.uk/tags/QEMU/"},{"name":"ARM64","slug":"ARM64","permalink":"https://blog.mahyang.uk/tags/ARM64/"},{"name":"Ubuntu","slug":"Ubuntu","permalink":"https://blog.mahyang.uk/tags/Ubuntu/"}]},{"title":"ä½¿ç”¨ QEMU å¯åŠ¨ ARM aarch64 æ¶æ„ Ubuntu è™šæ‹Ÿæœº","slug":"QEMU-å®‰è£…-Ubuntu-ARM64-æ¶æ„æ“ä½œç³»ç»Ÿ","date":"2021-03-01T01:35:03.000Z","updated":"2021-03-13T07:51:43.000Z","comments":true,"path":"2021/03/01/QEMU-å®‰è£…-Ubuntu-ARM64-æ¶æ„æ“ä½œç³»ç»Ÿ/","link":"","permalink":"https://blog.mahyang.uk/2021/03/01/QEMU-%E5%AE%89%E8%A3%85-Ubuntu-ARM64-%E6%9E%B6%E6%9E%84%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/","excerpt":"æœ¬æ–‡å°†ä»‹ç»å¦‚ä½•ä½¿ç”¨ QEMU å¯åŠ¨ aarch64 æ¶æ„çš„ Ubuntu æ“ä½œç³»ç»Ÿä»¥åŠå®¿ä¸»æœºä¸Šç›¸å…³é…ç½®çš„æ“ä½œæ–¹æ³•ã€‚","text":"æœ¬æ–‡å°†ä»‹ç»å¦‚ä½•ä½¿ç”¨ QEMU å¯åŠ¨ aarch64 æ¶æ„çš„ Ubuntu æ“ä½œç³»ç»Ÿä»¥åŠå®¿ä¸»æœºä¸Šç›¸å…³é…ç½®çš„æ“ä½œæ–¹æ³•ã€‚ ç¯å¢ƒæœ¬æ–‡æ‰€æœ‰æ“ä½œå‡åœ¨ Ubuntu20.04 æ“ä½œç³»ç»Ÿä¸Šå®Œæˆã€‚ å®‰è£… QEMUå®‰è£…å¯åŠ¨ aarch64 ubuntu æ‰€éœ€çš„ä¾èµ–ç¨‹åºï¼š 1234sudo apt install qemu-kvm libvirt-daemon-system libvirt-clients bridge-utils virtinst virt-manager qemusudo apt install qemu-system-aarch64sudo apt install qemu-efi-aarch64sudo apt install qemu-utils åˆ›å»ºé•œåƒåˆ›å»ºå¯åŠ¨å¿…å¤‡çš„ flash é•œåƒï¼š 123dd if=/dev/zero of=flash1.img bs=1M count=64dd if=/dev/zero of=flash0.img bs=1M count=64dd if=/usr/share/qemu-efi-aarch64/QEMU_EFI.fd of=flash0.img conv=notrunc ä¸‹è½½æƒ³è¦å¯åŠ¨çš„é•œåƒï¼Œæœ¬æ–‡é€‰ç”¨ Ubuntu16.04ï¼š 1wget http://ports.ubuntu.com/ubuntu-ports/dists/xenial-updates/main/installer-arm64/current/images/netboot/mini.iso åˆ›å»ºç©ºç¡¬ç›˜é•œåƒï¼Œæ­¤é•œåƒç”¨äºå®‰è£…æ“ä½œç³»ç»Ÿï¼š 1qemu-img create ubuntu-image.img 20G è‡³æ­¤å‡†å¤‡å·¥ä½œå®Œæˆã€‚ å®‰è£…ç³»ç»Ÿå¯åŠ¨ç³»ç»Ÿå®‰è£…å™¨ï¼š 12345qemu-system-aarch64 -nographic -machine virt,gic-version=max -m 512M -cpu max -smp 4 \\-netdev user,id=vnet,hostfwd=:127.0.0.1:0-:22 -device virtio-net-pci,netdev=vnet \\-drive file=ubuntu-image.img,if=none,id=drive0,cache=writeback -device virtio-blk,drive=drive0,bootindex=0 \\-drive file=mini.iso,if=none,id=drive1,cache=writeback -device virtio-blk,drive=drive1,bootindex=1 \\-drive file=flash0.img,format=raw,if=pflash -drive file=flash1.img,format=raw,if=pflash æ ¹æ®æç¤ºä¿¡æ¯å®Œæˆæ“ä½œç³»ç»Ÿå®‰è£…ã€‚ å®‰è£…å®Œæˆä¹‹åé€šè¿‡ Ctrl-a x é€€å‡º QEMU ã€‚ å¯åŠ¨é•œåƒè¿™é‡Œæˆ‘ä»¬å¸Œæœ›å°†è™šæ‹Ÿæœºæ¥å…¥å®¿ä¸»æœºæ‰€åœ¨ç½‘ç»œï¼Œå¦‚ä¸‹å›¾ï¼š ç½‘ç»œè¿æ¥å›¾+-----------------------------------------------------------------+| Host || +---------------------+ || | | || | br0: | || | 192.168.199.32/24 +-----+ || | | | || +----+----------------+ | +-------------------------+ || | | | Guest | || | | | +---------------------+ | || +----+----------------+ +--+---+ | | | | || | | | | | | eth0: | | || | enp3s0: | | tap0 | | | 192.168.199.33/24 | | || | 192.168.199.30/24 | | +-----+ | | || | | | | | +---------------------+ | || +---------------------+ +------+ +-------------------------+ |+-----------------------------------------------------------------+ é…ç½®ç½‘æ¡¥ br0ï¼š 12345sudo ip link add name br0 type bridgesudo ip link set dev br0 downsudo ip addr flush dev br0sudo ip addr add 192.168.199.32/24 dev br0sudo ip link set dev br0 up é…ç½® tap è®¾å¤‡ tap0ï¼š 12sudo ip tuntap add name tap0 mode tapsudo ip link set dev tap0 up å°†å®¿ä¸»æœºç½‘ç»œæ¥å£ enp3s0 å’Œ tap0 æ¥å…¥ç½‘æ¡¥ br0ï¼š 12sudo ip link set enp3s0 master br0sudo ip link set tap0 master br0 å¯åŠ¨è™šæ‹Ÿæœºç³»ç»Ÿï¼š 1234567sudo qemu-system-aarch64 -nographic -machine virt,gic-version=max -m 1G -cpu max -smp 4 \\-netdev tap,id=mynet0,ifname=tap0,script=no,downscript=no \\-device virtio-net-pci,netdev=mynet0,mac=$(qemu-mac-hasher.py ubuntu1604-arm64) \\-drive file=ubuntu-image.img,if=none,id=drive0,cache=writeback \\-device virtio-blk,drive=drive0,bootindex=0 \\-drive file=flash0.img,format=raw,if=pflash -drive file=flash1.img,format=raw,if=pflash \\-device virtio-rng-pci ä»¥ä¸Šå‘½ä»¤æŒ‡å®š qemu ä½¿ç”¨ tap è®¾å¤‡ä½œä¸ºè™šæ‹Ÿæœºç½‘ç»œæ¥å£å¹¶ä¸”æŒ‡å®šä½¿ç”¨åˆšåˆšåˆ›å»ºçš„ tap0 æ¥å£ã€‚ ä¸ºäº†æŒ‡å®šè™šæ‹Ÿå™¨çš„ MAC åœ°å€æˆ‘ä»¬ä½¿ç”¨ä¸€ä¸ªè„šæœ¬æ¥ä¸ºæ¯ä¸ªè™šæ‹Ÿæœºç”Ÿæˆç‰¹å®šåœ°å€ã€‚MAC åœ°å€çš„ç”Ÿæˆè„šæœ¬å¦‚ä¸‹ï¼š qemu-mac-hasher.py12345678#!/usr/bin/env python# usage: qemu-mac-hasher.py &lt;VMName&gt;import sysimport zlibcrc = str(hex(zlib.crc32(sys.argv[1].encode(&quot;utf-8&quot;))))[-8:]print(&quot;52:54:%s%s:%s%s:%s%s:%s%s&quot; % tuple(crc)) è™šæ‹Ÿæœºå¯åŠ¨åæ ¹æ®éœ€è¦é…ç½®å…¶ç½‘ç»œå‚æ•°å³å¯ã€‚ ä¼˜åŒ–ç½‘ç»œä»¥ä¸Šæ­¥éª¤å®Œæˆåè™šæ‹Ÿæœºå¯ä¸å®¿ä¸»æœºæ‰€åœ¨ç½‘ç»œçš„å…¶ä»–è®¾å¤‡äº’è¿ï¼ˆåŒ…æ‹¬å®¿ä¸»æœºï¼‰ï¼Œä¹Ÿå¯ä»¥é€šè¿‡æŒ‡å®šçš„ç½‘å…³è¿æ¥äº’è”ç½‘ï¼Œä½†æ˜¯æ­¤æ—¶å®¿ä¸»æœºæ— æ³•è¿æ¥äº’è”ç½‘ï¼Œè§£å†³æ–¹æ³•å¦‚ä¸‹ï¼š åˆ é™¤ enp3s0 æ¥å£çš„é»˜è®¤ç½‘å…³ï¼š 1sudo ip route del default dev enp3s0 ä¸º br0 æ·»åŠ é»˜è®¤ç½‘å…³ï¼š 1sudo ip route add default via 192.168.199.1 dev br0","categories":[],"tags":[{"name":"æ“ä½œæ–¹æ³•","slug":"æ“ä½œæ–¹æ³•","permalink":"https://blog.mahyang.uk/tags/%E6%93%8D%E4%BD%9C%E6%96%B9%E6%B3%95/"},{"name":"QEMU","slug":"QEMU","permalink":"https://blog.mahyang.uk/tags/QEMU/"},{"name":"ARM64","slug":"ARM64","permalink":"https://blog.mahyang.uk/tags/ARM64/"},{"name":"Ubuntu","slug":"Ubuntu","permalink":"https://blog.mahyang.uk/tags/Ubuntu/"}]},{"title":"ç”¨ LXD å®¹å™¨åŒ– VoIP æœåŠ¡","slug":"create-a-linux-container-of-debian-with-asterisk-freepbx-installed","date":"2020-07-25T02:39:18.000Z","updated":"2020-07-26T08:31:33.000Z","comments":true,"path":"2020/07/25/create-a-linux-container-of-debian-with-asterisk-freepbx-installed/","link":"","permalink":"https://blog.mahyang.uk/2020/07/25/create-a-linux-container-of-debian-with-asterisk-freepbx-installed/","excerpt":"å°†æœ‰ç¹çé…ç½®çš„å¼€å‘ç¯å¢ƒæ‰“åŒ…è¿›å®¹å™¨ä¸­èƒ½å‡å°‘æˆ‘ä»¬çš„å¼€å‘è´Ÿæ‹…ï¼Œæœ¬æ–‡å°†ä»‹ç»å¦‚ä½•æŠŠåŸºäº Asterisk çš„ VoIP æœåŠ¡å®¹å™¨åŒ–ã€‚","text":"å°†æœ‰ç¹çé…ç½®çš„å¼€å‘ç¯å¢ƒæ‰“åŒ…è¿›å®¹å™¨ä¸­èƒ½å‡å°‘æˆ‘ä»¬çš„å¼€å‘è´Ÿæ‹…ï¼Œæœ¬æ–‡å°†ä»‹ç»å¦‚ä½•æŠŠåŸºäº Asterisk çš„ VoIP æœåŠ¡å®¹å™¨åŒ–ã€‚ Whyå¦‚æœä½ çš„ VoIP æœåŠ¡å¼€å‘ç¯å¢ƒã€æµ‹è¯•ç¯å¢ƒå’Œç”Ÿäº§ç¯å¢ƒåœ¨åŒä¸€å°ç‰©ç†æœºä¸Šï¼Œä¹Ÿè®¸ä¸ä¼šå¯Ÿè§‰åˆ°ç¯å¢ƒæ­å»ºçš„ç¹çä»¥åŠæ¶ˆè€—åœ¨é…ç½®ç¯å¢ƒä¸Šçš„æ—¶é—´ã€‚è®©æˆ‘ä»¬æ¥è®¾æƒ³è¿™æ ·ä¸€ä¸ªåœºæ™¯ï¼šå®¢æˆ·æŒ‡å®šä½¿ç”¨æŸä¸€ä¸ª Linux å‘è¡Œç‰ˆå®‰è£… Asteriskï¼ˆæˆ–è€…é…åˆ FreePBXï¼‰å¼€å‘ä¸€å¥—å­˜åœ¨ç‰¹å®šéœ€æ±‚çš„ VoIP æœåŠ¡ï¼ŒåŸºäºè¿™ä¸ªå‰æä½ æ‹¿åˆ°ä¸€å°æ–°çš„è®¾å¤‡å¼€å§‹å·¥ä½œï¼š é¦–å…ˆå®‰è£…é…ç½®æŸä¸ªæŒ‡å®š Linux å‘è¡Œç‰ˆï¼ˆèŠ±è´¹1ã€2ä¸ªå°æ—¶ï¼‰ï¼› æ¥ç€ç¼–è¯‘ã€å®‰è£…ã€é…ç½® Asteriskï¼ˆ1ä¸ªå°æ—¶ï¼‰ï¼› ç„¶åå®‰è£…é…ç½® FreePBXï¼ˆèŠ±è´¹2å°æ—¶è§£å†³æ— æ•°ä¸ªé—®é¢˜ï¼‰ï¼› æœ€åå®Œæˆæµ‹è¯•ï¼ˆèŠ±è´¹1å°æ—¶ï¼‰ã€‚ ç»ˆäºåœ¨5ã€6ä¸ªå°æ—¶åä½ æ­å»ºå¥½äº†å¼€å‘ç¯å¢ƒï¼Œæ¥ç€å‘ç°è¿˜æœ‰æµ‹è¯•ç¯å¢ƒå’Œç”Ÿäº§ç¯å¢ƒéœ€è¦æ­å»ºï¼Œäºæ˜¯ä½ å†èŠ±ä¸Š2å€äºä¹‹å‰çš„æ—¶é—´å®Œæˆäº†ç¯å¢ƒæ­å»ºå·¥ä½œã€‚æ€»ç®—å¯ä»¥å¼€å§‹å¼€å‘äº†ï¼Œä½ å¼€å§‹å®ç°æŸä¸€é¡¹åŠŸèƒ½ï¼Œä¸ºäº†å®Œæˆè¿™é¡¹åŠŸèƒ½å¯èƒ½ï¼š éœ€è¦å˜åŠ¨ Asterisk çš„é…ç½®ï¼› éœ€è¦å˜åŠ¨ FreePBX çš„æ¥å£ï¼› ç³»ç»ŸæŸäº›ç¯å¢ƒå˜é‡ã€é…ç½®å‚æ•°éœ€è¦æ”¹åŠ¨ã€‚ äºæ˜¯ä½ å°†è¿™äº›å˜åŠ¨éƒ½åŒæ­¥æ‰§è¡Œåˆ°æµ‹è¯•å’Œç”Ÿäº§ç¯å¢ƒä»¥ä¿è¯å„å¹³å°çš„ç¯å¢ƒä¸€è‡´ï¼Œè¿™å°†è€—è´¹å¼€å‘äººå‘˜å¤§é‡çš„æ—¶é—´ã€‚åŒæ—¶ï¼Œä¸€ä¸ªé¡¹ç›®ä¸­é¢ä¸´å‡ åä¸Šç™¾é¡¹åŠŸèƒ½çš„å¼€å‘éœ€æ±‚ï¼Œå¾ˆå¿«ä½ å°±ä¼šå‘ç°å› ä¸ºç¯å¢ƒé…ç½®å¤±æ­¥å¯¼è‡´çš„å¼€å‘æµç¨‹å¤±æ§ï¼Œæ¯”å¦‚å¼€å‘ç¯å¢ƒèƒ½å®ç°çš„åŠŸèƒ½åœ¨æµ‹è¯•ç¯å¢ƒå¤±æ•ˆï¼Œåœ¨ç”Ÿäº§ç¯å¢ƒå‡ºç°çš„é—®é¢˜åœ¨å¼€å‘ç¯å¢ƒæ— æ³•å¤ç°ã€‚ é—®é¢˜æ€»ç»“ï¼š å¼€å‘äººå‘˜åœ¨æ­å»ºç¯å¢ƒå’Œä¿è¯å„å¹³å°ç¯å¢ƒé…ç½®åŒæ­¥çš„è¿‡ç¨‹ä¸­è€—è´¹å¤§é‡æ—¶é—´ï¼› æ‰‹åŠ¨æ“ä½œè¿›è¡Œé…ç½®åŒæ­¥éš¾å…ä¼šå‡ºé”™ï¼Œå‡ºç°è¿è¡Œç¯å¢ƒå¤±æ§çš„æƒ…å†µã€‚ ä¸ºäº†è§£å†³è¿™2æ–¹é¢é—®é¢˜ï¼Œæˆ‘ä»¬å¯ä»¥å°†æœåŠ¡ç¨‹åºåŠå…¶æ‰€ä¾èµ–çš„ç¯å¢ƒæ‰“åŒ…è¿›å®¹å™¨ä¸­ä½¿å¾—æ•´å¥—ç¯å¢ƒå®¹å™¨åŒ–ï¼Œç„¶ååœ¨å„ä¸ªå¹³å°åˆ†å‘æ­¤å®¹å™¨ä»¥ä¿è¯ç¯å¢ƒçš„ä¸€è‡´æ€§ã€‚ Howæœ¬æ¬¡æµ‹è¯•çš„ç¯å¢ƒæ˜¯ Debian 10ï¼Œä»¥ä¸‹åˆ†4ä¸ªæ­¥éª¤å®Œæˆ VoIP æœåŠ¡å®¹å™¨åŒ–ï¼š å®‰è£…å¹¶é…ç½® LXDï¼› åˆ¶ä½œæ ¹æ–‡ä»¶ç³»ç»Ÿï¼Œå…¶ä¸­å®‰è£…äº† Asterisk ä»¥åŠ FreePBXï¼› å°†æ­¤æ ¹æ–‡ä»¶ç³»ç»Ÿæ‰“åŒ…ä½œä¸ºåŸºç¡€é•œåƒå¯¼å…¥ LXDï¼› ä» LXD ä¸­çš„åŸºç¡€é•œåƒå¯åŠ¨ä¸€ä¸ªå®ä¾‹ï¼Œå¹¶é…ç½®ç½‘ç»œã€‚ å®‰è£…å¹¶é…ç½® LXDLXD æ˜¯ä¸€ä¸‹ä»£å¼€æºç³»ç»Ÿå®¹å™¨ã€è™šæ‹Ÿæœºç®¡ç†å™¨ã€‚å…³äº LXD æ›´ä¸ºè¯¦ç»†çš„ä»‹ç»è¯·å‚è€ƒå®˜æ–¹æ–‡æ¡£ã€‚ ä½¿ç”¨ snap å®‰è£… LXDï¼Œå¦‚æœç³»ç»Ÿæ²¡æœ‰ snap å…ˆå®‰è£… snapï¼š 12sudo apt install snapsudo snap install core å®‰è£… LXDï¼š 1sudo snap install lxd å°†ç”¨æˆ·æ·»åŠ åˆ° lxd ç»„ï¼š 1sudo usermod -a -G lxd $YOUR_USERNAME é…ç½® LXDä¸€èˆ¬æƒ…å†µä¸‹ç›´æ¥åœ¨å‘½ä»¤è¡Œä¸­è¾“å…¥ lxd init ç„¶åå…¨éƒ¨é€‰æ‹©éƒ½ä½¿ç”¨é»˜è®¤é€‰é¡¹å³å¯ã€‚è¿™é‡Œæˆ‘å¸Œæœ›ä½¿ç”¨è‡ªå®šä¹‰çš„å­˜å‚¨è®¾å¤‡ä½œä¸º lxd çš„ storage poolã€‚ é¦–å…ˆåˆ›å»ºä¸€ä¸ªå¤§å°åˆé€‚çš„ç©ºæ–‡ä»¶ï¼š 12mkdir $HOME/lxd_storagedd if=/dev/zero of=$HOME/lxd_storage/disk bs=1M count=51200 # 50G åˆ›å»ºæ–°çš„ loop device å¹¶å°†åˆšåˆšåˆ›å»ºçš„ç©ºæ–‡ä»¶å…³è”åˆ°æ­¤è®¾å¤‡ï¼š 12losetup /dev/loop14 $HOME/lxd_storage/disk # å…ˆæŸ¥çœ‹ /dev ç›®å½•ä¸‹æ˜¯å¦å·²æœ‰ loop14ï¼Œæœ‰åˆ™æ¢ä¸€ä¸ªå¦‚ï¼šloop15sudo reboot # é‡å¯ç”Ÿæ•ˆé…ç½® åˆå§‹åŒ– lxd é…ç½®ï¼š 1234567891011121314151617uklar@debian:~# lxd initWould you like to use LXD clustering? (yes/no) [default=no]:Do you want to configure a new storage pool? (yes/no) [default=yes]:Name of the new storage pool [default=default]:Name of the storage backend to use (btrfs, dir) [default=btrfs]:Would you like to create a new btrfs subvolume under /var/lib/lxd? (yes/no) [default=yes]: noCreate a new BTRFS pool? (yes/no) [default=yes]:Would you like to use an existing block device? (yes/no) [default=no]: yesPath to the existing block device: /dev/loop14Would you like to connect to a MAAS server? (yes/no) [default=no]:Would you like to create a new local network bridge? (yes/no) [default=yes]:What should the new bridge be called? [default=lxdbr0]:What IPv4 address should be used? (CIDR subnet notation, â€œautoâ€ or â€œnoneâ€) [default=auto]:What IPv6 address should be used? (CIDR subnet notation, â€œautoâ€ or â€œnoneâ€) [default=auto]: noneWould you like LXD to be available over the network? (yes/no) [default=no]:Would you like stale cached images to be updated automatically? (yes/no) [default=yes] noWould you like a YAML &quot;lxd init&quot; preseed to be printed? (yes/no) [default=no]: åˆ¶ä½œæ ¹æ–‡ä»¶ç³»ç»Ÿè¿™é‡Œä½¿ç”¨ debootstrap è·å– debian çš„æ ¹æ–‡ä»¶ç³»ç»Ÿï¼š 123sudo apt install debootstrapmkdir /tmp/debiansudo debootstrap buster /tmp/debian ä½¿ç”¨ systemd-nspawn ä»¥ chroot æ¨¡å¼åˆ‡æ¢åˆ° /tmp/debian ä¸­ï¼š 12sudo apt install systemd-container # æ­¤è½¯ä»¶åŒ…ä¸­åŒ…å«äº† systemd-nspawnsudo systemd-container -D /tmp/debian åšä¸€äº›åŸºæœ¬é…ç½®ï¼Œå¦‚è®¾ç½® root ç”¨æˆ·å¯†ç ã€æ·»åŠ æ™®é€šç”¨æˆ·ä»¥åŠé…ç½®ç½‘ç»œç­‰ï¼Œç„¶åé€€å‡ºï¼š 12345678910111213141516171819202122232425passwduseradd -m $USERNAMEpasswd $USERNAMEapt install sudousermod -a -G sudo $USERNAMEusermod --shell /bin/bash $USERNAMEcat &lt;&lt;EOF &gt;/etc/network/interfaces# This file describes the network interfaces available on your system# and how to activate them. For more information, see interfaces(5).source /etc/network/interfaces.d/*# The loopback network interfaceauto loiface lo inet loopback# The eth0 network interfaceauto eth0iface eth0 inet dhcpEOFexit æ¥ç€ä½¿ç”¨ systemd-nspawn çš„å®¹å™¨æ¨¡å¼å¯åŠ¨ /tmp/debian ä»¥ root èº«ä»½ç™»é™†ï¼š 1sudo systemd-nspawn -D /tmp/debian --boot åœ¨å®¹å™¨ä¸­å®‰è£… Asterisk ä»¥åŠ FreePBXï¼Œè¿‡ç¨‹è¯·å‚è€ƒï¼š Asterisk å®‰è£…è„šæœ¬ FreePBX å®‰è£…è„šæœ¬ é…ç½® hostnameï¼š 123apt install dbushostnamectl set-hostname debian.voip.netecho &#x27;127.0.0.1 debian.voip.net&#x27; &gt;&gt;/etc/hosts è®¿é—®æœåŠ¡å™¨ Web é¡µé¢éªŒè¯å®¹å™¨ä¸­çš„ VoIP æœåŠ¡æ˜¯å¦æ­£å¸¸è¿è¡Œï¼š ä» systemd-nspawn å®¹å™¨ä¸­é€€å‡ºï¼š 1shutdown now åˆ›å»º LXD é•œåƒå°†åˆšåˆšé…ç½®å®Œæˆçš„æ ¹æ–‡ä»¶ç³»ç»Ÿæ‰“åŒ…å¹¶å‹ç¼©ï¼š 123mkdir -p ~/container/images/voip_basecd ~/container/images/voip_basesudo tar czf voip_base.tar.gz -C /tmp/debian . ä¸ºé•œåƒåˆ›å»º metadata æ–‡ä»¶ï¼š 1234567891011cat &lt;&lt;EOF &gt;./metadata.yamlarchitecture: &quot;x86_64&quot;creation_date: $(date +%s)properties: architecture: &quot;x86_64&quot; description: &quot;Debian(buster) with preinstalled Asterisk13&amp;FreePBX15 ($(date +%Y%m%d))&quot; os: &quot;debian&quot; release: &quot;buster&quot;EOFtar czf metadata.tar.gz metadata.yaml å°†å‹ç¼©åŒ…ä½œä¸ºé•œåƒå¯¼å…¥ LXDï¼š 1234lxc image import \\~/container/images/voip_base/metadata.tar.gz \\~/container/images/voip_base/voip_base.tar.gz \\--alias voip-base æŸ¥çœ‹é•œåƒæ˜¯å¦æˆåŠŸå¯¼å…¥ï¼š 1lxc image list ä»é•œåƒå¯åŠ¨å®ä¾‹æœ‰äº†åŸºç¡€é•œåƒä¹‹åï¼Œå¯åŠ¨ä¸€ä¸ªæ–°çš„ VoIP æœåŠ¡å®ä¾‹åªéœ€ä¸€è¡Œå‘½ä»¤ï¼š 1lxc launch voip-base test æŸ¥çœ‹å®ä¾‹è¿è¡ŒçŠ¶æ€ï¼š 1lxc list å¯ä»¥çœ‹åˆ° VoIP æœåŠ¡å®ä¾‹ï¼ˆåå­—ä¸º testï¼‰æ­£åœ¨è¿è¡Œï¼Œåˆ†é…çš„å†…éƒ¨ IP åœ°å€æ˜¯ 10.72.18.48ã€‚ å¯ç”¨ä»¥ä¸‹å‘½ä»¤ç™»é™†åˆ°å®ä¾‹ä¸­ï¼š 1lxc exec test bash æŸ¥çœ‹å„ç±»æœåŠ¡ä½¿ç”¨çš„ç«¯å£ï¼š 1lsof -i -P -n å®¿ä¸»æœºç½‘ç»œé…ç½®è®©å®¿ä¸»æœºï¼ˆIP ä¸º 192.168.0.107ï¼‰æ‰€åœ¨ç½‘ç»œï¼ˆ192.168.0.0/24ï¼‰çš„å…¶ä»–è®¾å¤‡èƒ½å¤Ÿè®¿é—® VoIP æœåŠ¡ï¼ˆIP ä¸º 10.72.18.48ï¼‰ï¼Œéœ€è¦åœ¨å®¿ä¸»æœºä¸Šé…ç½®ç½‘ç»œåœ°å€è½¬æ¢ï¼ˆNATï¼‰ï¼š å‘é€åˆ°å®¿ä¸»æœº 5060 ç«¯å£çš„ UDP åŒ…ï¼ˆPJSIPï¼‰è½¬å‘åˆ°å®¹å™¨å®ä¾‹ å‘é€åˆ°å®¿ä¸»æœº 5160 ç«¯å£çš„ UDP åŒ…ï¼ˆSIPï¼‰è½¬å‘åˆ°å®¹å™¨å®ä¾‹ å‘é€åˆ°å®¿ä¸»æœº 10000 - 20000 ç«¯å£çš„ UDP åŒ…ï¼ˆè¯­éŸ³ï¼‰è½¬å‘åˆ°å®¹å™¨å®ä¾‹ å‘é€åˆ°å®¿ä¸»æœº 80 ç«¯å£çš„ TCP åŒ…ï¼ˆWeb ç®¡ç†æœåŠ¡ï¼‰è½¬å‘åˆ°å®¹å™¨å®ä¾‹ ä»¥ä¸Šé…ç½®å¯æ ¹æ®å®é™…éœ€æ±‚æ›´æ”¹ã€‚ è¿™é‡Œä½¿ç”¨ iptables æ¥å®Œæˆï¼Œä½¿ç”¨ exit ä»å®ä¾‹é€€å‡ºè¿”å›å®¿ä¸»æœºï¼Œæ‰§è¡Œï¼š 1234sudo iptables -t nat -A PREROUTING --dst 192.168.0.107 -p udp --dport 5060 -j DNAT --to 10.72.18.48sudo iptables -t nat -A PREROUTING --dst 192.168.0.107 -p udp --dport 5160 -j DNAT --to 10.72.18.48sudo iptables -t nat -A PREROUTING --dst 192.168.0.107 -p udp --dport 10000:20000 -j DNAT --to 10.72.18.48sudo iptables -t nat -A PREROUTING --dst 192.168.0.107 -p tcp --dport 80 -j DNAT --to 10.72.18.48 æŸ¥çœ‹ NAT é…ç½®çŠ¶æ€ï¼š 1sudo iptables -t nat -v -L PREROUTING -n ç°åœ¨å³å¯é€šè¿‡å®¿ä¸»æœºçš„ IP è®¿é—®å®¿ä¸»æœºä¸Šå®¹å™¨åŒ–çš„ VoIP æœåŠ¡äº†ã€‚ Asterisk ç½‘ç»œé…ç½®é…ç½® Asterisk çš„ SIP å‚æ•°ï¼š externip ä¸º 192.168.0.107 localnet ä¸º 10.72.18.0/24 è¿™æ · VoIP æœåŠ¡æ‰èƒ½å‘ SIP ç»ˆç«¯æ­£ç¡®åœ°å‘é€ contact å‚æ•°ï¼Œå¦åˆ™ç»ˆç«¯ä¸æœåŠ¡å™¨çš„ SIP åè®®äº¤äº’ä¼šå‡ºé”™ã€‚ ç›´æ¥ä½¿ç”¨ FreePBX å®Œæˆé…ç½®ï¼ˆSettings -&gt; Asterisk SIP Settingsï¼‰ï¼š æ€»ç»“æœ¬æ–‡è¯¦ç»†ä»‹ç»äº†å¦‚ä½•å°† VoIP æœåŠ¡å®¹å™¨åŒ–ï¼Œæ¶‰åŠçš„å†…å®¹åŒ…æ‹¬ LXD çš„ä½¿ç”¨ã€systemd-nspawn çš„ä½¿ç”¨ã€æ ¹æ–‡ä»¶ç³»ç»Ÿåˆ¶ä½œã€å®¹å™¨é•œåƒåˆ¶ä½œä»¥åŠå’Œ VoIP æœåŠ¡ç›¸å…³çš„ç½‘ç»œé…ç½®ã€‚é€šè¿‡å®¹å™¨åŒ–çš„æ“ä½œèƒ½è®©å„å¹³å°çš„è¿è¡Œç¯å¢ƒä¿æŒä¸€è‡´ï¼Œå‡å°‘å¼€å‘äººå‘˜ä¸å¿…è¦çš„æ—¶é—´æŸè€—ã€‚è‡³äºé€‰æ‹© LXD ä½œä¸ºå®ç°å®¹å™¨åŒ–çš„å¹³å°åŸå› æœ‰2ï¼š VoIP æœåŠ¡è½¯ä»¶ç»„æˆå¤æ‚ï¼Œéƒ¨ç½²åœ¨ä¸€ä¸ªå¸¦æ ¹æ–‡ä»¶ç³»ç»Ÿçš„å®¹å™¨ä¸­æ›´ä¸ºæ–¹ä¾¿ï¼› LXD çš„å®ç°æ€§èƒ½è¾ƒå¥½ï¼Œå…³äºä¸šç•Œå‡ ç§å®¹å™¨åŒ–å·¥å…·çš„æ€§èƒ½å¯¹æ¯”åˆ†æè¯·å‚è€ƒè®ºæ–‡ Performance analysis of multi services on container Docker, LXC, and LXD","categories":[],"tags":[{"name":"Asterisk","slug":"Asterisk","permalink":"https://blog.mahyang.uk/tags/Asterisk/"},{"name":"LXD","slug":"LXD","permalink":"https://blog.mahyang.uk/tags/LXD/"},{"name":"VoIP","slug":"VoIP","permalink":"https://blog.mahyang.uk/tags/VoIP/"},{"name":"FreePBX","slug":"FreePBX","permalink":"https://blog.mahyang.uk/tags/FreePBX/"},{"name":"systemd-nspawn","slug":"systemd-nspawn","permalink":"https://blog.mahyang.uk/tags/systemd-nspawn/"}]},{"title":"ã€OSTEP ç»ƒä¹ é¢˜ã€‘æµ‹é‡æ“ä½œç³»ç»Ÿåˆ‡æ¢ä¸Šä¸‹æ–‡çš„è€—æ—¶","slug":"ostep-measure-cost-of-context-switch","date":"2020-07-11T08:49:16.000Z","updated":"2021-03-02T02:47:19.000Z","comments":true,"path":"2020/07/11/ostep-measure-cost-of-context-switch/","link":"","permalink":"https://blog.mahyang.uk/2020/07/11/ostep-measure-cost-of-context-switch/","excerpt":"å°è¯•è§£ç­” OSTEP 1 ç¬¬6ç«  â€œLimited Direct Executionâ€ çš„ç»ƒä¹ é¢˜ â€”â€” æµ‹é‡æ“ä½œç³»ç»Ÿåˆ‡æ¢ä¸Šä¸‹æ–‡çš„è€—æ—¶ã€‚","text":"å°è¯•è§£ç­” OSTEP 1 ç¬¬6ç«  â€œLimited Direct Executionâ€ çš„ç»ƒä¹ é¢˜ â€”â€” æµ‹é‡æ“ä½œç³»ç»Ÿåˆ‡æ¢ä¸Šä¸‹æ–‡çš„è€—æ—¶ã€‚ ç¯å¢ƒä½¿ç”¨çš„æµ‹è¯•å¹³å° CPU æ˜¯ Intel i5-6200Uï¼Œä¸»é¢‘ 2.3GHzï¼Œæ“ä½œç³»ç»Ÿæ˜¯ Arch Linuxï¼Œå†…æ ¸ç‰ˆæœ¬ 5.7.7ã€‚ æ–¹æ³•ä¸ºäº†å°½é‡å‡†ç¡®åœ°æµ‹é‡è¿›ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢è€—æ—¶ï¼Œéœ€è¦æœ‰å¦‚ä¸‹å‡ ä¸ªå‰æï¼š åˆ›å»º 2 ä¸ªæµ‹è¯•è¿›ç¨‹ï¼› ä¿è¯è¿™ 2 ä¸ªè¿›ç¨‹è¿è¡Œåœ¨åŒä¸€ä¸ª CPU æ ¸ä¸Šï¼ˆé‰´äºç›®å‰çš„è®¡ç®—å¹³å°ä¸€èˆ¬ä¸ºå¤šæ ¸ CPUï¼‰ï¼› ä¿è¯æ­£åœ¨è¿è¡Œè¿™ 2 ä¸ªæµ‹è¯•è¿›ç¨‹çš„ CPU æ ¸ä¸Šæ²¡æœ‰è¿è¡Œå…¶ä»–ç”¨æˆ·è¿›ç¨‹ï¼› å°½é‡ä½¿æ“ä½œç³»ç»Ÿåœ¨æŒ‡å®šæ—¶åˆ»æ‰§è¡Œè¿›ç¨‹è°ƒåº¦ï¼ˆä¸æ­¤åŒæ—¶æ‰§è¡Œä¸Šä¸‹æ–‡åˆ‡æ¢ï¼‰ã€‚ è¿›ç¨‹åˆ›å»ºä½¿ç”¨ fork ç³»ç»Ÿè°ƒç”¨åˆ›å»ºå­è¿›ç¨‹ï¼š 12345678910switch (fork()) &#123;case -1: // error handling exit(EXIT_FAILURE);case 0: // child process // do something in child process exit(EXIT_SUCESS);default: // parent process // do something in parent process exit(EXIT_SUCESS);&#125; sched_setaffinityä½¿ç”¨ sched_setaffinity æŒ‡å®šè¿›ç¨‹è¿è¡Œåœ¨ CPU3 è¿™ä¸ªæ ¸å¿ƒä¸Šï¼š 1234567891011#define CPU_NUM 3cpu_set_t set;CPU_ZERO(&amp;set);CPU_SET(CPU_NUM, &amp;set);if (sched_setaffinity(getpid(), sizeof(set), &amp;set) &lt; 0) &#123; // error handling&#125;// set successfully// do other things æ­¤æ“ä½œåªéœ€åœ¨çˆ¶è¿›ç¨‹ fork å­è¿›ç¨‹ä¹‹å‰æ‰§è¡Œå³å¯ï¼Œå­è¿›ç¨‹é»˜è®¤æƒ…å†µä¸‹ä¼šå’Œçˆ¶è¿›ç¨‹è¿è¡Œåœ¨åŒä¸€ä¸ª CPU æ ¸ä¸Šã€‚ å†…æ ¸å¯åŠ¨å‚æ•°ä¸ºäº†ä¿è¯æŒ‡å®šçš„ CPU æ ¸ä¸Šåªæœ‰ç”¨äºæµ‹è¯•çš„ 2 ä¸ªç”¨æˆ·è¿›ç¨‹ï¼Œéœ€è¦è®¾ç½® isolcpus è¿™ä¸ªå¯åŠ¨å‚æ•°ç»™å†…æ ¸ã€‚æ­¤å‚æ•°å‘Šè¯‰å†…æ ¸åœ¨è°ƒåº¦å…¶ä½™ç”¨æˆ·è¿›ç¨‹æ—¶æ’é™¤æŒ‡å®šçš„ CPU æ ¸å¿ƒã€‚ 12cat /proc/cmdline# BOOT_IMAGE=... isolcpus=3 ... é‡æ–°å¯åŠ¨è®¡ç®—æœºï¼Œåœ¨è¿›å…¥ GRUB å¯åŠ¨ç•Œé¢æ—¶é€‰æ‹©å¯åŠ¨é¡¹å¹¶æŒ‰ä¸‹ eï¼Œè¿›å…¥å¯åŠ¨é¡¹ç¼–è¾‘ç•Œé¢ï¼Œæ‰¾åˆ° linux ä¸ºå¼€å¤´çš„ä¸€è¡Œåœ¨è¡Œå°¾æ·»åŠ å¦‚ä¸‹å¯åŠ¨å‚æ•°ï¼š 1isolcpus=3 # 3 ä»£è¡¨æµ‹è¯•å¹³å°ä¸­ CPU çš„ä¸€ä¸ªæ ¸çš„ç¼–å· æŸ¥çœ‹è®¾å¤‡ CPU æ ¸å¿ƒæ•°å¯åœ¨è¿›å…¥ç³»ç»Ÿåå‘½ä»¤è¡Œæ‰§è¡Œï¼š 1lscpu æˆ–è€…ï¼š 1cat /proc/cpuinfo è®¾ç½®å®Œåå¯ä»¥ç”¨ stress å‘½ä»¤æµ‹è¯•ä¸€ä¸‹ï¼š 12sudo pacman -S stressstress --cpu 8 ä»ä¸‹å›¾å¯ä»¥çœ‹å‡ºå†…æ ¸åœ¨è°ƒåº¦ç”¨æˆ·è¿›ç¨‹æ—¶ç»•å¼€äº† CPU3ï¼ˆä» 0 å¼€å§‹è®¡æ•°ï¼‰ã€‚ Pipeä»¥ä¸Šå‡ ä¸ªæ­¥éª¤ä¿è¯äº†åœ¨ CPU3 æ ¸å¿ƒä¸Šåªæœ‰ç”¨äºæµ‹è¯•çš„ 2 ä¸ªç”¨æˆ·è¿›ç¨‹ï¼Œæ¥ä¸‹æ¥åªéœ€è¦è®©å†…æ ¸æ¥å›åˆ‡æ¢ï¼ˆè°ƒåº¦ï¼‰è¿™ 2 ä¸ªæµ‹è¯•è¿›ç¨‹å³å¯ã€‚ ä½¿ç”¨çš„æ–¹æ³•æ˜¯ï¼šåˆ›å»º 2 ä¸ª pipeï¼Œå­è¿›ç¨‹å‘ pipe0 å†™å…¥ä¸€ä¸ªå­—ç¬¦ç„¶åä» pipe1 è¯»å–ä¸€ä¸ªå­—ç¬¦ï¼Œçˆ¶è¿›ç¨‹ä» pipe0 è¯»å–ä¸€ä¸ªå­—ç¬¦ç„¶åå°†è¯»å–åˆ°çš„å­—ç¬¦å†™å…¥ pipe1ï¼Œè¿™æ ·é‡å¤ N&#x2F;2 æ¬¡ã€‚å½“å­è¿›ç¨‹åœ¨â€œç­‰å¾…â€è¯»å–æ—¶å†…æ ¸å°±æ‰§è¡Œè°ƒåº¦åˆ‡æ¢åˆ°çˆ¶è¿›ç¨‹ï¼Œå½“çˆ¶è¿›ç¨‹åœ¨â€œç­‰å¾…â€è¯»å–æ—¶å†…æ ¸æ‰§è¡Œè°ƒåº¦åˆ‡æ¢åˆ°å­è¿›ç¨‹ï¼Œæ‰€ä»¥æµ‹è¯•è¿›ç¨‹ä¸€æ¬¡â€œè¯»å†™â€å®Œæˆåå†…æ ¸æ‰§è¡Œäº† 2 æ¬¡ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œæ—¢æ€»å…±å®Œæˆäº† N æ¬¡åˆ‡æ¢ã€‚æ›´åŠ ç›´è§‚çš„è¿‡ç¨‹å¦‚é¢˜å›¾æ‰€ç¤ºã€‚ ç»“æœåœ¨æˆ‘çš„å¹³å°2 ä¸Šçš„æµ‹è¯•ç»“æœä¸ºï¼šæ“ä½œç³»ç»Ÿä¸Šä¸‹æ–‡åˆ‡æ¢å¹³å‡è€—æ—¶ 3.42 å¾®ç§’ã€‚ æºç  æ³¨é‡Š[1] Operating System: Three Easy Pieces - ARPACI-DUSSEAU[2] Intel i5-6200U @ 2.3GHz, Arch Linux, Kernel 5.7.7","categories":[],"tags":[{"name":"Linux","slug":"Linux","permalink":"https://blog.mahyang.uk/tags/Linux/"},{"name":"Operating System","slug":"Operating-System","permalink":"https://blog.mahyang.uk/tags/Operating-System/"},{"name":"Context Switch","slug":"Context-Switch","permalink":"https://blog.mahyang.uk/tags/Context-Switch/"}]},{"title":"å¤åˆ» Linux æ“ä½œç³»ç»Ÿåˆ°å¦ä¸€å°è®¾å¤‡","slug":"å¤åˆ»-Linux-æ“ä½œç³»ç»Ÿåˆ°å¦ä¸€å°è®¾å¤‡","date":"2020-05-08T06:32:27.000Z","updated":"2020-05-08T09:42:17.000Z","comments":true,"path":"2020/05/08/å¤åˆ»-Linux-æ“ä½œç³»ç»Ÿåˆ°å¦ä¸€å°è®¾å¤‡/","link":"","permalink":"https://blog.mahyang.uk/2020/05/08/%E5%A4%8D%E5%88%BB-Linux-%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%88%B0%E5%8F%A6%E4%B8%80%E5%8F%B0%E8%AE%BE%E5%A4%87/","excerpt":"rsync æ˜¯ä¸€æ¬¾å¿«é€Ÿä¸”çµæ´»çš„æ–‡ä»¶æ‹·è´å·¥å…·ï¼Œæ—¢èƒ½å®ç°æœ¬åœ°æ‹·è´ä¹Ÿèƒ½å®Œæˆè¿œç¨‹åŒæ­¥ã€‚æœ¬æ–‡å°†ä½¿ç”¨ rsync ä½œä¸ºæ ¸å¿ƒå·¥å…·æ¥ä»‹ç»å¦‚ä½•å¤åˆ» Linux æ“ä½œç³»ç»Ÿã€‚","text":"rsync æ˜¯ä¸€æ¬¾å¿«é€Ÿä¸”çµæ´»çš„æ–‡ä»¶æ‹·è´å·¥å…·ï¼Œæ—¢èƒ½å®ç°æœ¬åœ°æ‹·è´ä¹Ÿèƒ½å®Œæˆè¿œç¨‹åŒæ­¥ã€‚æœ¬æ–‡å°†ä½¿ç”¨ rsync ä½œä¸ºæ ¸å¿ƒå·¥å…·æ¥ä»‹ç»å¦‚ä½•å¤åˆ» Linux æ“ä½œç³»ç»Ÿã€‚ å‡†å¤‡å·¥ä½œéœ€è¦æ³¨æ„çš„æ˜¯æºè®¾å¤‡å’Œç›®æ ‡è®¾å¤‡ä¹‹é—´çš„ CPU æ¶æ„éœ€ä¿æŒä¸€è‡´ã€‚ ç¡¬ä»¶ ä¸€å°è¢«å¤åˆ»çš„è®¾å¤‡ä½œä¸ºæºè®¾å¤‡ï¼ˆå‚è€ƒæ­å»º IPPBX åŸºç¡€å¼€å‘ç¯å¢ƒï¼‰ ä¸€å°æ–°è®¾å¤‡ä½œä¸ºç›®æ ‡è®¾å¤‡ ä¸€ä¸ª Linux USB å¯åŠ¨ç›˜ï¼ˆåˆ¶ä½œæ–¹æ³•ç½‘ç»œä¸Šå¾ˆå¤šè¿™é‡Œä¸å¤šä½œä»‹ç»ï¼Œæˆ‘åˆ¶ä½œçš„æ˜¯ Debian10 USB å¯åŠ¨ç›˜ï¼‰ è½¯ä»¶ rsync openssh-serverï¼ˆå¯é€‰ï¼‰ é…ç½®æºè®¾å¤‡åœ¨æ­å»º IPPBX åŸºç¡€å¼€å‘ç¯å¢ƒä¸€æ–‡ä¸­æˆ‘ä»¬å·²ç»æ­å»ºå¥½äº†ä¸€ä¸ªå¼€å‘ç¯å¢ƒï¼Œå…¶ä¸­çš„ /dev/sdb2 è®¾å¤‡é‡ŒåŒ…å«äº†ä¸€ä¸ªå®Œæ•´çš„ç”¨äºç”Ÿäº§ç¯å¢ƒçš„æ“ä½œç³»ç»Ÿã€‚ç°åœ¨æˆ‘ä»¬å°† /dev/sdb2 ç”¨ä½œæ‹·è´æºã€‚ æºè®¾å¤‡ç½‘ç»œç®€å•çš„æ–¹æ³•æ˜¯å°†æºè®¾å¤‡æ¥åˆ°è·¯ç”±å™¨ä¸Šï¼Œç”±è·¯ç”±å™¨è‡ªåŠ¨åˆ†é… IP åœ°å€ã€‚ä¹Ÿå¯ä»¥é‡‡ç”¨å’Œç›®æ ‡è®¾å¤‡ç›´æ¥è¿æ¥çš„æ–¹å¼ï¼Œåˆ™éœ€è¦è‡ªå·±é…ç½®é™æ€ IP åœ°å€ã€‚ æŒ‚è½½ /dev/sdb212sudo mkdir -p /mnt/debian_10sudo mount /dev/sdb2 /mnt/debian_10 å®‰è£…&amp;é…ç½® rsync1234567891011121314$ sudo -ienter your passwd:apt install rsynccat &lt;&lt; EOF &gt; /etc/rsyncd.confuid = rootgid = rootuse chroot = no[all] path = /EOFrsync --daemonexit é…ç½®ç›®æ ‡è®¾å¤‡å°†ç›®æ ‡è®¾å¤‡ä» USB å¯åŠ¨ç›˜å¯åŠ¨ï¼Œç„¶åå°†å¿…å¤‡çš„è½¯ä»¶å®‰è£…å¥½ã€‚ ç›®æ ‡è®¾å¤‡ç½‘ç»œç®€å•çš„æ–¹æ³•æ˜¯å°†ç›®æ ‡è®¾å¤‡æ¥åˆ°è·¯ç”±å™¨ä¸Šï¼Œç”±è·¯ç”±å™¨è‡ªåŠ¨åˆ†é… IP åœ°å€ã€‚ä¹Ÿå¯ä»¥é‡‡ç”¨å’Œæºè®¾å¤‡ç›´æ¥è¿æ¥çš„æ–¹å¼ï¼Œåˆ™éœ€è¦è‡ªå·±é…ç½®é™æ€ IP åœ°å€ã€‚ ä½¿ç”¨ rsync å¤åˆ»ç³»ç»Ÿä½¿ç”¨ rsync å°†æºè®¾å¤‡ä¸Š Linux ç³»ç»Ÿå¤åˆ»åˆ°ç›®æ ‡è®¾å¤‡ä¸Šçš„æ–¹æ³•æœ‰ä¸¤ç§ï¼š ä½¿ç”¨è„šæœ¬æ“ä½œ æ‰‹åŠ¨æ“ä½œ æ¨èä½¿ç”¨è„šæœ¬ï¼Œç”¨ root ç”¨æˆ·æ‰§è¡Œè„šæœ¬ä¹‹åæ ¹æ®æç¤ºä¿¡æ¯æ“ä½œå³å¯ã€‚å¦‚æœéœ€è¦æ‰‹åŠ¨æ“ä½œï¼Œåˆ™æ¥ç€å¾€ä¸‹çœ‹ï¼ˆåé¢çš„æ“ä½œå‡ä½¿ç”¨ root ç”¨æˆ·æ‰§è¡Œï¼‰ã€‚ å¯¹ç›®æ ‡ç¡¬ç›˜åˆ†åŒºé¦–å…ˆæŸ¥çœ‹ä¸€ä¸‹åˆ†åŒºä¿¡æ¯ï¼š 1234567$ lsblkNAME MAJ:MIN RM SIZE RO TYPE MOUNTPOINTsda 8:0 0 119.2G 0 diskâ”œâ”€sda1 8:1 0 4G 0 partâ””â”€sda2 8:2 0 115.2G 0 partsdb 8:16 1 14.3G 0 diskâ””â”€sdb1 8:17 1 14.3G 0 part / å…¶ä¸­ sdb æ˜¯ USB å¯åŠ¨ç›˜ sda æ˜¯ç›®æ ‡è®¾å¤‡ä¸Šçš„ç¡¬ç›˜ã€‚å¯¹ sda åˆ†åŒºï¼š 1234567dd if=/dev/zero of=/dev/sda bs=1024 count=1sfdisk --force /dev/sda &lt;&lt; EOF1M,4G,S,,,L,*EOFmkswap /dev/sda1mkfs.ext4 /dev/sda2 è¿™é‡Œæˆ‘ä»¬å°† sda åˆ’äº†2ä¸ªåˆ†åŒºï¼Œç¬¬ä¸€ä¸ªæ˜¯4Gçš„äº¤æ¢åˆ†åŒºï¼Œå‰©ä½™çš„ç©ºé—´åˆ’åˆ†ä¸ºç³»ç»Ÿåˆ†åŒºå¹¶æ ¼å¼åŒ–ä¸º ext4 æ–‡ä»¶ç³»ç»Ÿï¼ˆåˆ†åŒºæ–¹å¼éœ€å’Œæºè®¾å¤‡ä¿æŒä¸€è‡´ï¼‰ã€‚ ä»æºè®¾å¤‡åŒæ­¥æ–‡ä»¶é¦–å…ˆå°†åˆšåˆšåˆ›å»ºå¥½çš„ç³»ç»Ÿåˆ†åŒºæŒ‚è½½åˆ°æœ¬åœ°ç›®å½•ï¼š 12mkdir -p /mnt/rsync_tmpmount /dev/sda2 /mnt/rsync_tmp æ£€æŸ¥ä¸€ä¸‹ä¸æºè®¾å¤‡çš„è¿é€šæ€§ï¼ˆå‡å®šæºè®¾å¤‡çš„ IP åœ°å€æ˜¯ 192.168.198.140ï¼‰ï¼š 1ping -c 1 192.168.198.140 å¼€å§‹åŒæ­¥ï¼š 1rsync -avHX 192.168.198.140::all/mnt/debian_10/ /mnt/rsync_tmp/ æ³¨æ„ï¼šè·¯å¾„ç»“å°¾å¤„çš„ / å¿…é¡»æœ‰ã€‚ é‡æ–°å®‰è£… GRUB å¯åŠ¨å™¨ä»æºè®¾å¤‡åŒæ­¥å®Œæˆä¹‹åï¼Œç›®æ ‡è®¾å¤‡ä¸Šçš„ GRUB å¯åŠ¨å™¨ä»¥åŠå…¶é…ç½®éƒ½æœªæ›´æ–°ï¼Œæ‰€ä»¥éœ€è¦æ›´æ–°ã€‚ é¦–å…ˆè·å–2ä¸ªåˆ†åŒºçš„ UUIDï¼š 1234$ blkid /dev/sda1/dev/sda1: UUID=&quot;XXXX&quot; TYPE=&quot;swap&quot; PARTUUID=&quot;XXX&quot;$ blkid /dev/sda2/dev/sda2: UUID=&quot;XXXX&quot; TYPE=&quot;ext4&quot; PARTUUID=&quot;XXX&quot; å°†å¯¹åº”åˆ†åŒºçš„ UUID æ›´æ–°åˆ° /mnt/rsync_tmp/etc/fstab æ–‡ä»¶ä¸­åæ‰§è¡Œï¼š 12345mount --bind /proc /mnt/rsync_tmp/procmount --bind /sys /mnt/rsync_tmp/sysmount --bind /dev /mnt/rsync_tmp/devmount --bind /run /mnt/rsync_tmp/runchroot /mnt/rsync_tmp è¿›å…¥åˆ° chroot ç¯å¢ƒåï¼Œæ›´æ–° GRUBï¼š 12grub-install /dev/sdaupdate-grub é‡å¯è®¾å¤‡1reboot è¿›å…¥ BIOS ä¸­å°†å¯åŠ¨è®¾å¤‡è®¾ç½®ä¸ºç¡¬ç›˜åå¯åŠ¨ï¼Œå³å¯è¿›å…¥å®Œæˆå¤åˆ»çš„ Linux ç³»ç»Ÿã€‚","categories":[],"tags":[{"name":"Linux","slug":"Linux","permalink":"https://blog.mahyang.uk/tags/Linux/"},{"name":"rsync","slug":"rsync","permalink":"https://blog.mahyang.uk/tags/rsync/"},{"name":"clone file system","slug":"clone-file-system","permalink":"https://blog.mahyang.uk/tags/clone-file-system/"}]},{"title":"æ­å»º IPPBX åŸºç¡€å¼€å‘ç¯å¢ƒ","slug":"æ­å»º-IPPBX-åŸºç¡€å¼€å‘ç¯å¢ƒ","date":"2020-05-06T05:58:46.000Z","updated":"2020-05-08T09:42:23.000Z","comments":true,"path":"2020/05/06/æ­å»º-IPPBX-åŸºç¡€å¼€å‘ç¯å¢ƒ/","link":"","permalink":"https://blog.mahyang.uk/2020/05/06/%E6%90%AD%E5%BB%BA-IPPBX-%E5%9F%BA%E7%A1%80%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83/","excerpt":"è½¯ä»¶å¼€å‘ä¸­åº”å¯¹ä¸åŒçš„éœ€æ±‚æœ‰ä¸åŒçš„è§£å†³æ–¹æ¡ˆï¼Œè¿›è€Œäº§ç”Ÿä¸åŒçš„è½¯ä»¶é¡¹ç›®ã€‚é’ˆå¯¹ä¸åŒçš„è½¯ä»¶é¡¹ç›®éœ€æ­å»ºç‰¹å®šçš„å¼€å‘ç¯å¢ƒä»¥é€‚åº”å„ä¸ªé¡¹ç›®çš„å¼€å‘éœ€è¦ã€‚æœ¬æ–‡ä»¥åœ¨ Linux ç¯å¢ƒä¸­æ­å»º IPPBX å¼€å‘ç¯å¢ƒä¸ºä¾‹æ¥ä»‹ç»å¦‚ä½•æ­å»ºä¸€ä¸ªç¬¦åˆéœ€æ±‚çš„å¼€å‘ç¯å¢ƒã€‚","text":"è½¯ä»¶å¼€å‘ä¸­åº”å¯¹ä¸åŒçš„éœ€æ±‚æœ‰ä¸åŒçš„è§£å†³æ–¹æ¡ˆï¼Œè¿›è€Œäº§ç”Ÿä¸åŒçš„è½¯ä»¶é¡¹ç›®ã€‚é’ˆå¯¹ä¸åŒçš„è½¯ä»¶é¡¹ç›®éœ€æ­å»ºç‰¹å®šçš„å¼€å‘ç¯å¢ƒä»¥é€‚åº”å„ä¸ªé¡¹ç›®çš„å¼€å‘éœ€è¦ã€‚æœ¬æ–‡ä»¥åœ¨ Linux ç¯å¢ƒä¸­æ­å»º IPPBX å¼€å‘ç¯å¢ƒä¸ºä¾‹æ¥ä»‹ç»å¦‚ä½•æ­å»ºä¸€ä¸ªç¬¦åˆéœ€æ±‚çš„å¼€å‘ç¯å¢ƒã€‚ éœ€æ±‚æ•´ä¸ªå¼€å‘ç¯å¢ƒé‡Œæœ‰å¦‚ä¸‹è®¾å¤‡ï¼š ä¸€å°å¼€å‘æœºï¼ŒåŒ…å«2å—ç¡¬ç›˜ N å°ç›®æ ‡è®¾å¤‡ï¼ˆæœ€ç»ˆä¸šåŠ¡è¿è¡Œåœ¨è¿™äº›è®¾å¤‡ä¸Šï¼‰ å®é™…çš„å¼€å‘åœºæ™¯åº”è¯¥æ˜¯ï¼šå¼€å‘æœºéšæ—¶è¿è¡Œç€ï¼Œå…¶è¿è¡ŒçŠ¶æ€ä¸ºï¼š2å—ç¡¬ç›˜å„æœ‰ä¸€ä¸ª Linux æ“ä½œç³»ç»Ÿï¼Œå…¶ä¸­ä¸€ä¸ªä¸ºä¸»ç³»ç»Ÿå¦ä¸€ä¸ªä»¥ç±»ä¼¼å®¹å™¨çš„å½¢å¼è¿è¡Œåœ¨ä¸»ç³»ç»Ÿä¸­ã€‚ä¸»ç³»ç»Ÿä¸­åªå®‰è£…å„ç±»å¼€å‘å·¥å…·ï¼Œä¸è¿è¡Œä»»ä½•ä¸é¡¹ç›®ä¸šåŠ¡ç›¸å…³çš„æœåŠ¡ï¼Œæ‰€æœ‰å’Œé¡¹ç›®ä¸šåŠ¡ç›¸å…³çš„æœåŠ¡éƒ½è¿è¡Œåœ¨â€œå®¹å™¨1â€ä¸­ã€‚å¼€å‘äººå‘˜é€šè¿‡ SSH è¿œç¨‹ç™»é™†åˆ°ä¸»ç³»ç»Ÿä¸­å®Œæˆå¼€å‘ï¼Œæˆ–è€…æœ¬åœ°å¼€å‘å®Œæˆåå°†è½¯ä»¶æœåŠ¡åŒæ­¥åˆ°ä¸»ç³»ç»Ÿï¼Œç»´æŠ¤äººå‘˜å†å°†æ–°çš„å†…å®¹åŒæ­¥åˆ°â€œå®¹å™¨â€ä¸­ã€‚ å®é™…çš„ç³»ç»Ÿéƒ¨ç½²åœºæ™¯åº”è¯¥æ˜¯ï¼šå½“éœ€è¦å°†ç³»ç»Ÿéƒ¨ç½²åˆ°æ–°è®¾å¤‡ä¸Šæ—¶ï¼Œç»´æŠ¤äººå‘˜åªéœ€å°†å¼€å‘æœºä¸Š2å—ç¡¬ç›˜ä¸­å­˜æ”¾â€œå®¹å™¨â€çš„é‚£å—ç¡¬ç›˜ä¸­çš„æ•°æ®â€œæ‹·è´2â€åˆ°æ–°è®¾å¤‡çš„ç¡¬ç›˜ä¸­å³å¯ã€‚ ç›®æ ‡åœ¨ç€æ‰‹æ­å»ºç¯å¢ƒä¹‹å‰éœ€è¦äº†è§£æ¸…æ¥šå¼€å‘ç¯å¢ƒæ­å»ºé’ˆå¯¹çš„ç›®æ ‡ï¼Œæœ¬ä¾‹ä¸­çš„ç›®æ ‡å¾ˆç®€å•åªæœ‰å¦‚ä¸‹2ä¸ªï¼š ä¾¿äºå¼€å‘å·¥ä½œçš„è¿›è¡Œã€‚ èƒ½æ–¹ä¾¿åœ°å°†å®Œæˆäº†å¼€å‘å·¥ä½œçš„ç³»ç»Ÿéƒ¨ç½²åˆ°æ–°è®¾å¤‡ä¸Šã€‚ æ‹†åˆ†éœ€æ±‚ç»“åˆå‰é¢éœ€æ±‚å’Œç›®æ ‡å¯å¾—åˆ°å¦‚ä¸‹ç»†åˆ†çš„åŠŸèƒ½ï¼š å¼€å‘æœºä¸Šéœ€è¦åœ¨å…¶ä¸­ä¸€å—ç¡¬ç›˜ä¸­å®‰è£…å¹¶è¿è¡Œä¸€ä¸ª Linux æ“ä½œç³»ç»Ÿã€‚ å¼€å‘æœºä¸Šçš„å¦ä¸€å—ç¡¬ç›˜å®‰è£…ä¸€ä¸ª Linux æ“ä½œç³»ç»Ÿï¼Œæ­¤ç³»ç»Ÿèƒ½è„±ç¦»ä¸»ç³»ç»Ÿç‹¬ç«‹è¿è¡Œï¼ŒåŒæ—¶åˆèƒ½ä½œä¸ºâ€œå®¹å™¨â€è¿è¡Œåœ¨ä¸»ç³»ç»Ÿä¹‹ä¸­ã€‚ éœ€è¦ä¸€ä¸ªåŒæ­¥æ–¹æ³•ï¼Œèƒ½å°†â€œå®¹å™¨â€åŒæ­¥åˆ°æ–°è®¾å¤‡çš„ç¡¬ç›˜ä¸­ã€‚ é€‰æ‹©æ“ä½œç³»ç»ŸåŠè½¯ä»¶å·¥å…·å¯¹äºå¼€å‘æœºçš„ä¸»æ“ä½œç³»ç»Ÿè¿™éƒ¨åˆ†æ²¡æœ‰ä¸¥æ ¼çš„è¦æ±‚ï¼Œé€‰æ‹©ä¸€ä¸ªé€‚åˆè‡ªå·±ä½¿ç”¨ä¹ æƒ¯çš„è¾ƒæ–°çš„ Linux å‘è¡Œç‰ˆå³å¯ï¼Œè¿™é‡Œä½œä¸ºæ¼”ç¤ºæˆ‘é€‰æ‹©çš„æ˜¯ Ubuntu20.04ã€‚ å®¹å™¨ä¸­è¿è¡Œçš„æ“ä½œç³»ç»Ÿï¼ŒåŒæ—¶ä¹Ÿæ˜¯æœ€ç»ˆè®¾å¤‡ä¸­è¿è¡Œçš„æ“ä½œç³»ç»Ÿï¼Œè¿™éƒ¨åˆ†å¯¹ç³»ç»Ÿçš„ç¨³å®šæ€§ä»¥åŠå¾ˆå¤šè½¯ä»¶çš„å…¼å®¹æ€§è¦æ±‚æ›´é«˜ä¸€äº›ï¼Œæ‰€ä»¥æˆ‘ä»¬é€‰æ‹© Debian10ã€‚ å¯¹äºâ€œå®¹å™¨åŒ–â€çš„éƒ¨åˆ†ï¼Œç›®å‰æœ‰å¾ˆå¤šå®¹å™¨åŒ–æŠ€æœ¯ï¼Œå¦‚åŠŸèƒ½éå¸¸å°‘ä½†ä½¿ç”¨éå¸¸ç®€å•çš„ chrootï¼ˆç”šè‡³ä¸èƒ½ä½œä¸ºå®¹å™¨æŠ€æœ¯ğŸ™ˆï¼‰ï¼›åˆå¦‚åŠŸèƒ½éå¸¸å¼ºå¤§ä½†ä½¿ç”¨èµ·æ¥æœ‰ä¸€å®šé—¨æ§›çš„ dockerã€podman æˆ–è€… Ubuntu æ¨å‡ºçš„ LXC ç­‰ï¼›è¿˜æœ‰ä»‹äºå‰é¢ä¸¤ç§ä¹‹é—´çš„ systemd-nspawnã€‚é‰´äºæœ¬ä¾‹ä¸­çš„ä½¿ç”¨åœºæ™¯ï¼Œæˆ‘ä»¬é€‰æ‹© systemd-nspawnï¼Œå› ä¸ºå…¶ä¸ä»…èƒ½åœ¨æˆ‘ä»¬çš„éœ€æ±‚èŒƒå›´å†…å¾ˆå¥½åœ°éš”ç¦»ä¸»ç³»ç»Ÿä¸â€œå®¹å™¨â€è€Œä¸”ä½¿ç”¨æ–¹æ³•ç›¸å¯¹ç®€å•ã€‚ å¯¹äºâ€œåŒæ­¥â€è¿™éƒ¨åˆ†ï¼Œæˆ‘ä»¬é€‰æ‹© rsyncï¼Œè¿™æ˜¯ä¸€ä¸ªåŸºäºå¢é‡ä¼ è¾“çš„æ–‡ä»¶åŒæ­¥è½¯ä»¶ï¼Œæ—¢å¯ç”¨é€šè¿‡å•æœºæœ¬åœ°åŒæ­¥ä¹Ÿå¯é€šè¿‡ç½‘ç»œåŒæ­¥ï¼Œèƒ½æ»¡è¶³æˆ‘ä»¬å¼€å‘ç¯å¢ƒä¸­çš„åŒæ­¥éœ€æ±‚ã€‚ å®‰è£…ä¸»ç³»ç»Ÿä¸»æ“ä½œç³»ç»Ÿæˆ‘ä»¬é€‰ç”¨çš„æ˜¯ Ubuntu20.04 å®‰è£…æ–¹æ³•ç½‘ç»œä¸Šå¾ˆå¤šï¼Œæœç´¢ä¸€ä¸‹å³å¯ï¼Œè¿™é‡Œä¸å†ä»‹ç»ã€‚ å®¹å™¨ä¸­çš„ç³»ç»Ÿæœ¬ä¾‹ä¸­æˆ‘ä»¬é‡‡ç”¨çš„æ˜¯ Debian10ï¼Œå®‰è£…æ–¹æ³•åŒä¸Šã€‚å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œæ­¤ç³»ç»Ÿéœ€å®‰è£…åˆ°å¼€å‘æœºçš„å¦ä¸€å—ç¡¬ç›˜ä¸Šï¼ŒåŒæ—¶åœ¨å®‰è£…å‰å¯å…ˆå–ä¸‹å®‰è£…äº†ä¸»ç³»ç»Ÿçš„ç¡¬ç›˜ï¼Œè¿™æ ·ä¸»ç³»ç»Ÿçš„å¯åŠ¨æ¡ç›®å°±ä¸ä¼šå‡ºç°åœ¨â€œå®¹å™¨â€çš„ grub å¯åŠ¨é€‰é¡¹ä¸­ã€‚æ­¤å¤–ï¼Œåˆ†åŒºæ–¹å¼æ¨èå¦‚ä¸‹ï¼š 123sdb 8:16 0 232.9G 0 diskâ”œâ”€sdb1 8:17 0 16G 0 part [SWAP]â””â”€sdb2 8:18 0 216.8G 0 part å…¶ä¸­äº¤æ¢åˆ†åŒºæ ¹æ®è‡ªå·±çš„å®é™…éœ€æ±‚åˆ’åˆ†ï¼Œå‰©ä¸‹çš„ç©ºé—´å…¨éƒ¨ä½œä¸º / åˆ†åŒºã€‚ å·¥å…·è½¯ä»¶åœ¨ä¸»ç³»ç»Ÿä¸­å®‰è£…è½¯ä»¶åŒ… systemd-contianerï¼ˆæ­¤ä¸­è½¯ä»¶åŒ…ä¸­åŒ…å« systemd-nspawn å·¥å…·ï¼‰ä»¥åŠå®‰è£…åŒæ­¥å·¥å…· rsyncã€‚ 123sudo apt updatesudo apt install systemd-contianersudo apt install rsync æ³¨ï¼šå…³äºä½¿ç”¨ rsync æ¥åŒæ­¥å®¹å™¨åˆ°æ–°è®¾å¤‡çš„æ–¹æ³•æ”¾åœ¨å¦ä¸€ç¯‡æ–‡ç« ä¸­é˜è¿°ã€‚ è¿è¡Œâ€œå®¹å™¨â€å°†2å—è£…å¥½äº†æ“ä½œç³»ç»Ÿçš„ç¡¬ç›˜éƒ½æ¥åˆ°ä¸»æ¿ä¸Šï¼Œç„¶åå¯åŠ¨å¼€å‘æœºè¿›å…¥ BIOS å°†è£…æœ‰ Ubuntu20.04 æ“ä½œç³»ç»Ÿçš„ç¡¬ç›˜è®¾ç½®åˆ°å¯åŠ¨åºåˆ—çš„ç¬¬ä¸€ä½ã€‚è¿›å…¥ä¸»ç³»ç»Ÿåï¼ŒæŸ¥çœ‹ç¡¬ç›˜åˆ†åŒºï¼Œå¤§è‡´å¦‚ä¸‹ï¼š 12345678$ lsblksda 8:0 0 931.5G 0 diskâ”œâ”€sda1 8:1 0 15.3G 0 part [SWAP]â”œâ”€sda2 8:2 0 122.1G 0 part /â””â”€sda3 8:3 0 794.2G 0 part /homesdb 8:16 0 232.9G 0 diskâ”œâ”€sdb1 8:17 0 16G 0 partâ””â”€sdb2 8:18 0 216.8G 0 part å…¶ä¸­ sda ä¸­å®‰è£…äº†æˆ‘ä»¬çš„ä¸»ç³»ç»Ÿï¼ˆUbuntuï¼‰ä¹Ÿå°±æ˜¯å½“å‰è¿è¡Œçš„ç³»ç»Ÿï¼Œsdb ä¸­å®‰è£…äº†â€œå®¹å™¨â€çš„ç³»ç»Ÿï¼ˆDebianï¼‰ã€‚ åˆ›å»ºæŒ‚è½½ç‚¹ 1sudo mkdir /mnt/debian_10 æŒ‚è½½ sdb ä¸­çš„æ–‡ä»¶ç³»ç»Ÿ 1sudo mount /dev/sdb2 /mnt/debian_10 ä½¿ç”¨ systemd-nspawn è¿›å…¥â€œå®¹å™¨â€ç¯å¢ƒ 12345678910111213$ sudo systemd-nspawn -D /mnt/debian_10 -bpawning container debian10 on /mntdebian_10.Press ^] three times within 1s to kill container....Welcome to Debian GNU/Linux 10 (buster)!...Debian GNU/Linux 10 debian consoledebian login: åˆ°æ­¤æˆ‘ä»¬å°±è¿›å…¥äº†â€œå®¹å™¨â€ç¯å¢ƒã€‚åœ¨å®¹å™¨å†…éƒ¨æˆ‘ä»¬å¯ä»¥è®¤ä¸ºåœ¨å¦ä¸€ä¸ªæ“ä½œç³»ç»Ÿé‡Œï¼Œäºæ˜¯å¯ä»¥æ‰§è¡Œä»»ä½•å‘½ä»¤ä»¥åŠå®‰è£…å„ç§è½¯ä»¶ä½†æ˜¯å¹¶ä¸å½±å“ä¸»ç³»ç»Ÿã€‚ä¾‹å¦‚æˆ‘ä»¬å¯ä»¥å®‰è£… Asterisk ä¸ FreePBX é€€å‡ºå®¹å™¨ 1sudo shutdown now æˆ–è€…åœ¨ 1s å†…æŒ‰ä¸‹ ^] 3æ¬¡ã€‚ï¼ˆcontrol é”® + ] é”®ï¼‰ å®¹å™¨ä¸­å®‰è£…å¹³å°ç¯å¢ƒSSH1234sudo apt updatesudo apt install openssh-serversudo systemctl start sshsudo systemctl enable ssh Asteriskå‚è€ƒ Asterisk è‡ªåŠ¨å®‰è£…è„šæœ¬ã€‚ æ³¨æ„ï¼šæ­¤è„šæœ¬ä»…åœ¨ Ubuntu18.04 ä»¥åŠ Debian10 ä¸­æµ‹è¯•é€šè¿‡ã€‚ FreePBXå‚è€ƒ FreePBX è‡ªåŠ¨å®‰è£…è„šæœ¬ã€‚ æ³¨æ„ï¼šæ­¤è„šæœ¬ä»…åœ¨ Ubuntu18.04 ä»¥åŠ Debian10 ä¸­æµ‹è¯•é€šè¿‡ã€‚ æ€»ç»“æœ¬æ–‡ä»‹ç»äº† æ­å»º IPPBX åŸºç¡€å¼€å‘ç¯å¢ƒ ä¸­çš„æ“ä½œç³»ç»Ÿã€å·¥å…·è½¯ä»¶é€‰æ‹©ä»¥åŠå®¹å™¨çš„åˆ¶ä½œä¸è¿è¡Œã€‚ä¸‹ä¸€ç¯‡å°†æ¥ç€ä»‹ç»å¦‚ä½•å°†å®¹å™¨åŒæ­¥åˆ°æ–°è®¾å¤‡ä¸Šã€‚ æ³¨é‡Š[1] è¿™é‡Œçš„å®¹å™¨ä¸æ˜¯æŒ‡å®Œæ•´çš„å®¹å™¨æŠ€æœ¯ï¼Œä»…ä»…é‡‡ç”¨äº† Linux å®¹å™¨çš„æ¦‚å¿µã€‚ [2] åªå€Ÿç”¨â€œæ‹·è´â€çš„æ¦‚å¿µï¼Œå®é™…æ“ä½œè¦æ›´å¤æ‚ä¸€äº›ã€‚","categories":[],"tags":[{"name":"Linux","slug":"Linux","permalink":"https://blog.mahyang.uk/tags/Linux/"},{"name":"systemd-nspawn","slug":"systemd-nspawn","permalink":"https://blog.mahyang.uk/tags/systemd-nspawn/"},{"name":"rsync","slug":"rsync","permalink":"https://blog.mahyang.uk/tags/rsync/"}]},{"title":"ç®€æ˜æ¶æ„","slug":"ç®€æ˜æ¶æ„","date":"2020-03-28T14:30:44.000Z","updated":"2020-03-30T16:34:12.000Z","comments":true,"path":"2020/03/28/ç®€æ˜æ¶æ„/","link":"","permalink":"https://blog.mahyang.uk/2020/03/28/%E7%AE%80%E6%98%8E%E6%9E%B6%E6%9E%84/","excerpt":"æœ€è¿‘ä¸ºä¸€ä¸ªé¡¹ç›®å¼€å‘è½¯ä»¶ï¼Œåœ¨å®åšè¿‡ç¨‹ä¸­å‘ç°è½¯ä»¶éœ€æ±‚æ¯”è¾ƒå¤æ‚ï¼šæ¶‰åŠå¤šç§å¯¹å†…å¯¹å¤–åº”ç”¨æ¥å£ï¼Œéœ€è¦æ“ä½œçš„æ•°æ®å’Œéœ€è¦ç»´æŠ¤çš„çŠ¶æ€ç§ç±»å¤šï¼Œå„ç§æ“ä½œè¾ƒç¹æ‚è¿˜ç‰µæ‰¯åˆ°åŒæ­¥é—®é¢˜ã€‚åœ¨ä¸€è¾¹å¼€å‘åŠŸèƒ½ä¸€è¾¹é‡æ„çš„è¿‡ç¨‹ä¸­å‘ç°ä¸€å¥—èƒ½å¾ˆå¥½é€‚åº”å½“å‰å¼€å‘éœ€æ±‚çš„è½¯ä»¶ç»„ç»‡æ–¹å¼ï¼Œæœ¬æƒ³å†™ä¸€ç¯‡æ€»ç»“æ–‡ç« ï¼Œä½†åœ¨æœç´¢æ•´ç†èµ„æ–™çš„æ—¶å€™å‘ç°æœ‰å‰è¾ˆåœ¨ 2012 å¹´çš„ä¸€ç¯‡åšå®¢ä¸­å·²ç»æå‡ºäº†è¿™æ ·çš„è½¯ä»¶è®¾è®¡æ¨¡å¼ï¼ˆæˆ–ç§°æ¶æ„ï¼‰ï¼Œäºæ˜¯åœ¨è¿™é‡Œç¿»è¯‘è¿™ç¯‡æ–‡ç« ä¾›å‚è€ƒã€‚ åŸæ–‡åœ°å€ï¼š The Clean Architecture","text":"æœ€è¿‘ä¸ºä¸€ä¸ªé¡¹ç›®å¼€å‘è½¯ä»¶ï¼Œåœ¨å®åšè¿‡ç¨‹ä¸­å‘ç°è½¯ä»¶éœ€æ±‚æ¯”è¾ƒå¤æ‚ï¼šæ¶‰åŠå¤šç§å¯¹å†…å¯¹å¤–åº”ç”¨æ¥å£ï¼Œéœ€è¦æ“ä½œçš„æ•°æ®å’Œéœ€è¦ç»´æŠ¤çš„çŠ¶æ€ç§ç±»å¤šï¼Œå„ç§æ“ä½œè¾ƒç¹æ‚è¿˜ç‰µæ‰¯åˆ°åŒæ­¥é—®é¢˜ã€‚åœ¨ä¸€è¾¹å¼€å‘åŠŸèƒ½ä¸€è¾¹é‡æ„çš„è¿‡ç¨‹ä¸­å‘ç°ä¸€å¥—èƒ½å¾ˆå¥½é€‚åº”å½“å‰å¼€å‘éœ€æ±‚çš„è½¯ä»¶ç»„ç»‡æ–¹å¼ï¼Œæœ¬æƒ³å†™ä¸€ç¯‡æ€»ç»“æ–‡ç« ï¼Œä½†åœ¨æœç´¢æ•´ç†èµ„æ–™çš„æ—¶å€™å‘ç°æœ‰å‰è¾ˆåœ¨ 2012 å¹´çš„ä¸€ç¯‡åšå®¢ä¸­å·²ç»æå‡ºäº†è¿™æ ·çš„è½¯ä»¶è®¾è®¡æ¨¡å¼ï¼ˆæˆ–ç§°æ¶æ„ï¼‰ï¼Œäºæ˜¯åœ¨è¿™é‡Œç¿»è¯‘è¿™ç¯‡æ–‡ç« ä¾›å‚è€ƒã€‚ åŸæ–‡åœ°å€ï¼š The Clean Architecture ä»¥ä¸‹ä¸ºè¯‘æ–‡ã€‚ åœ¨è¿‡å»çš„å‡ å¹´é—´æˆ‘ä»¬å·²ç»çœ‹åˆ°è¿‡å„ç§å„æ ·å…³äºç³»ç»Ÿæ¶æ„çš„è®¾æƒ³ï¼Œå¦‚ä¸‹ï¼š æ¥è‡ª Alistair Cockburn çš„å…­è¾¹å½¢æ¶æ„ï¼ˆä¹Ÿç§°æ¥å£ä¸é€‚é…ï¼‰ï¼Œæ­¤æ¶æ„è¢« Steve Freeman ä¸ Nat Pryce åœ¨å…¶åˆè‘—çš„ã€Šæµ‹è¯•é©±åŠ¨çš„é¢å‘å¯¹è±¡è½¯ä»¶å¼€å‘ã€‹ä¸€ä¹¦ä¸­é‡‡çº³ æ¥è‡ª Jeffrey Palermo çš„æ´‹è‘±æ¶æ„ æˆ‘å»å¹´åœ¨åšå®¢ä¸­æå‡ºçš„ä»¤äººæƒŠå¹çš„æ¶æ„ ç”± James Coplien å’Œ Trygve Reenskaug æå‡ºçš„ DCI Ivar Jacobson åœ¨å…¶æ‰€è‘—çš„ã€Šå®ä¾‹é©±åŠ¨çš„é¢å‘å¯¹è±¡è½¯ä»¶å·¥ç¨‹ã€‹ä¸€ä¹¦ä¸­æå‡ºçš„ BCE è™½ç„¶ä»¥ä¸Šè¿™äº›æ¶æ„éƒ½åœ¨ç»†èŠ‚ä¸Šæœ‰æ‰€ä¸åŒï¼Œä½†åœ¨å®è§‚ä¸Šéå¸¸ç›¸ä¼¼ã€‚å®ƒä»¬æœ‰åŒä¸€ä¸ªçš„ç›®æ ‡ï¼Œå…³æ³¨å¯¹è½¯ä»¶çš„æ‹†åˆ†ï¼Œé€šè¿‡å°†è½¯ä»¶åˆ†è§£ä¸ºä¸åŒçš„å±‚æ¬¡ï¼Œä»¥è¾¾åˆ°æ‹†åˆ†çš„ç›®çš„ã€‚æ¯ç§æ¶æ„éƒ½è‡³å°‘æœ‰ä¸€å±‚ç”¨äºæè¿°ä¸šåŠ¡è§„åˆ™ï¼Œå…¶ä»–å±‚æ¬¡ç”¨äºåˆ›å»ºæ¥å£ã€‚ ä½¿ç”¨è¿™äº›æ¶æ„æ‰€äº§ç”Ÿçš„ç³»ç»Ÿéƒ½æœ‰ä»¥ä¸‹ç‰¹ç‚¹ï¼š ç‹¬ç«‹äºæ¡†æ¶ã€‚æ¶æ„ä¸ä¾èµ–äºåŠŸèƒ½ä¸°å¯Œçš„è½¯ä»¶åº“ã€‚è¿™è®©ä½ èƒ½å¤Ÿå°†è½¯ä»¶æ¡†æ¶ä½œä¸ºå·¥å…·ä½¿ç”¨ï¼Œè€Œä¸ç”¨ä¸ºäº†ä½¿ç”¨æ¡†æ¶å°†å…¶å¡å…¥ç³»ç»Ÿä»¥æ»¡è¶³æ¡†æ¶çš„é™åˆ¶ã€‚ å¯æµ‹è¯•ã€‚ä¸šåŠ¡è§„åˆ™èƒ½å¤Ÿåœ¨æ²¡æœ‰ç•Œé¢ã€æ•°æ®åº“ã€Web æœåŠ¡å™¨æˆ–å…¶ä»–å…ƒç´ çš„æƒ…å†µä¸‹è¢«æµ‹è¯•ã€‚ ç‹¬ç«‹äºç•Œé¢ã€‚å¯ä»¥åœ¨ä¸æ”¹å˜ç³»ç»Ÿå…¶ä½™éƒ¨åˆ†çš„æƒ…å†µä¸‹å¾ˆå®¹æ˜“åœ°ä¿®æ”¹ç•Œé¢ã€‚ä¾‹å¦‚ï¼Œå¯ä»¥å°† Web ç•Œé¢æ”¹ä¸ºå‘½ä»¤è¡Œç•Œé¢å´ä¸æ”¹å˜ä¸šåŠ¡è§„åˆ™ã€‚ ç‹¬ç«‹äºæ•°æ®åº“ã€‚ä½ å¯ä»¥éšæ—¶å¼ƒç”¨ Oracle æˆ– SQL Server çš„æ•°æ®åº“æ”¹ä¸ºä½¿ç”¨ Mongoã€BigTableã€CouchDB æˆ–è€…å…¶ä»–æ•°æ®åº“ã€‚å› ä¸ºä½ çš„ä¸šåŠ¡è§„åˆ™ä¸ä¸æ•°æ®åº“ç»‘å®šã€‚ ç‹¬ç«‹äºä»»æ„å¤–éƒ¨æœºæ„ã€‚äº‹å®ä¸Šä½ çš„ä¸šåŠ¡è§„åˆ™æ ¹æœ¬å¯¹å¤–éƒ¨ä¸–ç•Œä¸€æ— æ‰€çŸ¥ã€‚ ä¾èµ–è§„åˆ™å›¾ä¸­æ¯ä¸€ä¸ªåŒå¿ƒåœ†è¡¨ç¤ºä¸åŒé¢†åŸŸçš„è½¯ä»¶ã€‚é€šå¸¸ï¼Œé¡¹ç›®å¼€å‘å¾—è¶Šä¹…è½¯ä»¶æ‰€å¤„çš„å±‚çº§è¶Šé«˜ã€‚å¤–å±‚åœ†æ˜¯æœºåˆ¶ï¼Œå†…å±‚æ˜¯ç­–ç•¥ã€‚ ä½¿è¿™ä¸ªæ¶æ„èƒ½å¤Ÿæ­£å¸¸è¿è½¬è€Œèµ·åˆ°å†³å®šæ€§ä½œç”¨çš„è§„åˆ™æ˜¯ä¾èµ–è§„åˆ™ã€‚è¿™ä¸ªè§„åˆ™æè¿°äº†æºä»£ç çš„ä¾èµ–å…³ç³»åªèƒ½ç”±å¤–éƒ¨æŒ‡å‘å†…éƒ¨ï¼Œå¤„äºå†…åœˆçš„ä»£ç å¯¹å¤„äºå¤–åœˆçš„ä»£ç ä¸€æ— æ‰€çŸ¥ã€‚ç‰¹åˆ«çš„ï¼Œåœ¨å¤–åœˆå®šä¹‰çš„å¯¹è±¡çš„åç§°å¿…ä¸èƒ½è¢«å¤„äºå†…åœˆçš„ä»£ç æåŠã€‚è¿™äº›å¯¹è±¡åŒ…æ‹¬ï¼šå‡½æ•°ã€ç±»ã€å˜é‡æˆ–è€…å…¶ä»–æœ‰åç§°çš„è½¯ä»¶å®ä½“ã€‚ å‡ºäºåŒæ ·çš„åŸå› ï¼Œåœ¨å¤–åœˆä½¿ç”¨çš„æ ¼å¼åŒ–æ•°æ®ä¸åº”è¯¥åœ¨å†…åœˆè¢«ä½¿ç”¨ï¼Œç‰¹åˆ«æ˜¯ç”±æŸç§è½¯ä»¶æ¡†æ¶äº§ç”Ÿçš„æ ¼å¼åŒ–æ•°æ®ã€‚æˆ‘ä»¬ä¸å¸Œæœ›å¤–åœˆçš„ä»»ä½•äº‹ç‰©å½±å“åˆ°å†…åœˆã€‚ å®ä½“å®ä½“å°è£…äº†ä¼ä¸šèŒƒå›´å†…çš„ä¸šåŠ¡è§„åˆ™ã€‚å®ä½“å¯ä»¥æ˜¯æºå¸¦æ–¹æ³•çš„å¯¹è±¡ä¹Ÿå¯ä»¥æ˜¯ç”±æ•°æ®ç»“æ„å’Œå‡½æ•°ç»„æˆçš„é›†åˆã€‚å®ä½“åªè¦èƒ½è¢«ä¼ä¸šä¸­ä¸åŒçš„åº”ç”¨ç¨‹åºä½¿ç”¨å³å¯ï¼Œå…·ä½“æ˜¯ä»€ä¹ˆåˆ™æ— å…³ç´§è¦ã€‚ å¦‚æœä½ æ²¡æœ‰å¼€å‘ä¼ä¸šçº§è½¯ä»¶è€Œæ˜¯åœ¨å†™å•ä¸ªåº”ç”¨ç¨‹åºï¼Œé‚£ä¹ˆè¿™äº›å®ä½“å¯ä»¥æ˜¯åº”ç”¨ç¨‹åºçš„ä¸šåŠ¡å¯¹è±¡ï¼Œå…¶ä¸­å°è£…äº†æœ€æ™®éæœ€é«˜å±‚æ¬¡çš„è§„åˆ™ã€‚å¦‚æœæ¶æ„çš„å¤–å›´å‘ç”Ÿäº†æ”¹å˜é‚£ä¹ˆå®ä½“å°†ä¼šæ˜¯æœ€åä¸€ä¸ªéœ€è¦ä¿®æ”¹çš„ã€‚ä¾‹å¦‚ï¼Œä½ ä¸å¸Œæœ›å½“é¡µé¢å¯¼èˆªæˆ–è€…å®‰å…¨ä¿æŠ¤æ–¹é¢äº§ç”Ÿäº†å˜æ›´è€Œå½±å“åˆ°å®ä½“ã€‚æ€»çš„æ¥è¯´ï¼Œä»»æ„æŒ‡å®šç¨‹åºçš„æ“ä½œå˜æ›´éƒ½ä¸åº”å½±å“å®ä½“å±‚ã€‚ ç”¨ä¾‹å¤„äºè¿™ä¸€å±‚çš„è½¯ä»¶åŒ…å«é¢å‘åº”ç”¨ç¨‹åºçš„ä¸šåŠ¡è§„åˆ™ï¼Œå°è£…å’Œå®ç°æ‰€æœ‰ç³»ç»Ÿç”¨ä¾‹ã€‚è¿™äº›ç”¨ä¾‹ç¼–æ’æ•°æ®æµåŠ¨åŒ…æ‹¬æµå‘å®ä½“å’Œä»å®ä½“æµå…¥ï¼Œä»¥åŠå¼•å¯¼å®ä½“ä½¿ç”¨ä¼ä¸šä¸šåŠ¡è§„åˆ™æ¥å®ç°ç”¨ä¾‹çš„ç›®çš„ã€‚ åŒæ ·ï¼Œæˆ‘ä»¬ä¸å¸Œæœ›è¿™ä¸€å±‚çš„å˜æ›´å½±å“å®ä½“ã€‚ä¹Ÿä¸å¸Œæœ›è¿™ä¸€å±‚å—åˆ°å¤–éƒ¨å˜æ›´çš„å½±å“ï¼Œæ¯”å¦‚æ•°æ®åº“ã€UI æˆ–è€…ä»»æ„è½¯ä»¶æ¡†æ¶ï¼Œæ­¤å±‚ä¸è¿™äº›æƒ…å†µæ— å…³ã€‚ å¯ä»¥é¢„æœŸï¼Œåº”ç”¨ç¨‹åºæ“ä½œçš„å˜æ›´ä¼šå½±å“ç”¨ä¾‹è¿›è€Œå½±å“å¤„äºæ­¤å±‚çš„è½¯ä»¶ã€‚å¦‚æœç”¨ä¾‹æœ¬èº«å‘ç”Ÿäº†å˜åŒ–ï¼Œé‚£ä¹ˆå¤„äºæ­¤å±‚çš„ä»£ç ä¸€å®šä¼šå—åˆ°å½±å“ã€‚ æ¥å£é€‚é…å™¨å¤„äºæ­¤å±‚çš„è½¯ä»¶é€šå¸¸æ˜¯ä¸€ç»„é€‚é…å™¨ã€‚é€‚é…å™¨çš„ä½œç”¨æ˜¯å°†æ–¹ä¾¿äºç”¨ä¾‹å’Œå®ä½“ä½¿ç”¨çš„æ•°æ®æ ¼å¼è½¬æ¢ä¸ºæ–¹ä¾¿å¤–éƒ¨æœºæ„ä½¿ç”¨çš„æ•°æ®æ ¼å¼ã€‚å¤–éƒ¨æœºæ„åŒ…æ‹¬æ•°æ®åº“ã€Web ç­‰ã€‚æ¯”å¦‚åœ¨æ­¤å±‚ä¸­ä¼šå®Œå…¨åŒ…å«å›¾å½¢ç”¨æˆ·ç•Œé¢çš„ MVC æ¶æ„ï¼Œè¡¨ç¤ºå™¨ã€è§†å›¾ä»¥åŠæ§åˆ¶å™¨éƒ½å±äºæ­¤å±‚ã€‚æ¨¡å‹ä¸€èˆ¬è¡¨ç¤ºä¸ºæ•°æ®ç»“æ„ï¼Œä»æ§åˆ¶å™¨ä¼ ç»™ç”¨ä¾‹ï¼Œå†ä»ç”¨ä¾‹è¿”å›åˆ°è¡¨ç¤ºå™¨å’Œè§†å›¾ã€‚ ç±»ä¼¼çš„ï¼Œæ•°æ®ä»æ–¹ä¾¿ç”¨ä¾‹å’Œå®ä½“ä½¿ç”¨çš„å½¢å¼è½¬æ¢åˆ°æ–¹ä¾¿æŒä¹…åŒ–æ¡†æ¶ï¼ˆå¦‚æ•°æ®åº“ï¼‰ä½¿ç”¨çš„å½¢å¼ä¹Ÿå‘ç”Ÿåœ¨æ­¤å±‚ã€‚ä»è¿™ä¸€å±‚å‘å†…çš„æ‰€æœ‰ä»£ç éƒ½å¯¹æ•°æ®åº“ä¸äº†è§£ã€‚å¦‚æœæ•°æ®æ˜¯ SQL æ•°æ®åº“é‚£ä¹ˆæ‰€æœ‰çš„ SQL è¯­å¥éƒ½åº”è¯¥è¢«é™åˆ¶åœ¨æ­¤å±‚ç”¨äºä¸æ•°æ®åº“äº¤äº’çš„éƒ¨åˆ†ã€‚ å½“ç„¶æ­¤å±‚è¿˜æœ‰å¦ä¸€ç§å¿…å¤‡çš„é€‚é…å™¨ï¼Œç”¨äºå°†æ¥è‡ªå¤–éƒ¨æœåŠ¡çš„æ•°æ®æ ¼å¼è½¬æ¢ä¸ºç”¨ä¾‹å’Œå®ä½“ä½¿ç”¨çš„å†…éƒ¨æ•°æ®æ ¼å¼ã€‚ æ¡†æ¶å’Œé©±åŠ¨æœ€å¤–ä¸€å±‚é€šå¸¸æ˜¯ç”±è½¯ä»¶æ¡†æ¶ä¸å·¥å…·ç»„æˆï¼Œä¾‹å¦‚æ•°æ®åº“ã€Web å¼€å‘æ¡†æ¶ç­‰ã€‚ä¸€èˆ¬ä½ ä¸éœ€è¦åœ¨æ­¤å±‚å†™å¤§é‡ä»£ç è€Œæ˜¯å†™ä¸€äº›â€œèƒ¶æ°´â€ä»£ç ç”¨äºä¸ç´§é‚»çš„å†…å±‚é€šä¿¡ã€‚ è¿™ä¸€å±‚æ˜¯æ‰€æœ‰å…·ä½“ç»†èŠ‚å‡ºç°çš„åœ°æ–¹ï¼Œä¾‹å¦‚ Webã€æ•°æ®åº“éƒ½å……æ»¡å„ç§ç»†èŠ‚éœ€è¦å…³æ³¨ï¼Œå°†è¿™ç±»äº‹ç‰©æ”¾åˆ°æœ€å¤–å±‚å¯ä»¥æœ€å¤§å¯èƒ½åœ°å‡å°‘å¯¹æ•´ä½“ç³»ç»Ÿçš„å½±å“ã€‚ ä»…æœ‰å››å±‚ï¼Ÿä¸æ˜¯ï¼Œæ­¤å›¾åªæ˜¯æ¦‚å¿µå±•ç¤ºã€‚åœ¨å®é™…æ“ä½œä¸­ä½ ä¼šå‘ç°æ‰€éœ€çš„ä¸æ­¢å››å±‚ï¼Œä¹Ÿæ²¡æœ‰è§„å®šä¸€å®šåªèƒ½æœ‰å››å±‚ã€‚æ— è®ºæ€æ ·ä¾èµ–åŸåˆ™å§‹ç»ˆæœ‰æ•ˆï¼Œå³æºä»£ç æ€»æ˜¯å‘å†…ä¾èµ–ã€‚è¶Šå¾€å†…è¶ŠæŠ½è±¡ã€‚æœ€å¤–åœˆæ˜¯æœ€ä½å±‚æ¬¡åŒ…å«æœ€å…·ä½“çš„ç»†èŠ‚ï¼Œè¶Šå¾€å†…è½¯ä»¶è¶Šä¸ºæŠ½è±¡å°è£…æ›´é«˜å±‚æ¬¡çš„ç­–ç•¥ï¼Œæœ€ä¸­å¿ƒçš„åœˆä¹Ÿå°±æœ€ä¸€èˆ¬åŒ–ã€‚ è·¨è¶Šè¾¹ç•Œåœ¨å›¾ç¤ºä¸­çš„å³ä¸‹è§’å¯ä»¥çœ‹åˆ°ä¸€ä¸ªç¤ºä¾‹å±•ç¤ºäº†æˆ‘ä»¬å¦‚ä½•è·¨è¶Šä¸åŒå±‚æ¬¡çš„è¾¹ç•Œã€‚å¯ä»¥çœ‹åˆ°æ§åˆ¶å™¨å’Œè¡¨ç¤ºå™¨é€šè¿‡å®ƒä»¬éš”å£å±‚çš„ç”¨ä¾‹æ¥äº’ç›¸é€šä¿¡ã€‚æ³¨æ„æ§åˆ¶çš„æµå‘ï¼Œå®ƒä»æ§åˆ¶å™¨å¼€å§‹ï¼Œé€šè¿‡ç”¨ä¾‹æœ€ååœ¨è¡¨ç¤ºå™¨ä¸­æ‰§è¡Œä»¥ç»“æŸã€‚åœ¨çœ‹æºä»£ç çš„ä¾èµ–æ–¹å‘ï¼Œå®ƒä»¬éƒ½å‘å†…æŒ‡å‘ç”¨ä¾‹ï¼Œè¿™å°±äº§ç”Ÿäº†çŸ›ç›¾ã€‚ é€šå¸¸æˆ‘ä»¬ä½¿ç”¨ä¾èµ–å€’ç½®åŸåˆ™è§£å†³è¿™ä¸ªæ˜¾è€Œæ˜“è§çš„å†²çªã€‚è¯¸å¦‚ Java ä¸€ç±»çš„ç¼–ç¨‹è¯­è¨€æˆ‘ä»¬å¯ä»¥é€šè¿‡ç»„ç»‡ä¸€ç»„æ¥å£å’Œç±»ç»§æ‰¿å…³ç³»ä½¿å¾—åœ¨é€‚å½“çš„æ—¶å€™è®©æºä»£ç çš„ä¾èµ–æ–¹å‘å’Œæ§åˆ¶æ–¹å‘ç›¸åä»¥å®ç°è·¨è¶Šè¾¹ç•Œã€‚ ä¾‹å¦‚ï¼Œè€ƒè™‘å½“ç”¨ä¾‹éœ€è¦è°ƒç”¨è¡¨ç¤ºå™¨çš„æƒ…å†µã€‚è¿™ç§è°ƒç”¨æ–¹å¼å¿…ä¸èƒ½ç›´æ¥å®ç°ï¼Œå› ä¸ºè¿™æ ·è¿åäº†ä¾èµ–åŸåˆ™ï¼šå†…éƒ¨äº‹ç‰©å¯¹å¤–éƒ¨ä¸€æ— æ‰€çŸ¥ã€‚å› æ­¤æˆ‘ä»¬è®©ç”¨ä¾‹å®šä¹‰ä»¥åŠè°ƒç”¨æ¥å£ï¼ˆinterfaceï¼‰ä¹Ÿå°±æ˜¯å›¾ä¸­å†…åœˆçš„ Use Case Output Portï¼Œè€Œè®©å¤–åœˆçš„è¡¨ç¤ºå™¨å®ç°è¿™ä¸ªæ¥å£ï¼ˆinterfaceï¼‰ã€‚ è¿™ä¸ªæŠ€å·§å¯ä»¥ç”¨åœ¨æ•´ä¸ªæ¶æ„ä¸­æ‰€æœ‰éœ€è¦è·¨è¶Šè¾¹ç•Œçš„åœ°æ–¹ã€‚æˆ‘ä»¬åˆ©ç”¨é¢å‘å¯¹è±¡ç¼–ç¨‹è¯­è¨€çš„åŠ¨æ€å¤šæ€æ€§è¿™ä¸ªç‰¹ç‚¹åˆ›å»ºä¸æ§åˆ¶æµå‘ç›¸åçš„æºä»£ç ä¾èµ–ã€‚è¿™æ ·ä¸è®ºæ§åˆ¶æµåŠ¨çš„æ–¹å‘æ˜¯ä»€ä¹ˆæˆ‘ä»¬éƒ½èƒ½è®©è®¾è®¡ç¬¦åˆä¾èµ–åŸåˆ™ã€‚ å“ªäº›æ•°æ®ä¼šè·¨è¶Šè¾¹ç•Œä¸€èˆ¬è·¨è¶Šè¾¹ç•Œçš„æ˜¯ç®€å•çš„æ•°æ®ç»“æ„ã€‚å¯ä»¥æ ¹æ®è‡ªå·±çš„éœ€è¦é€‰æ‹©åŸºæœ¬æ•°æ®ç»“æ„æˆ–è€…ç®€å•çš„æ•°æ®ä¼ è¾“å¯¹è±¡æˆ–è€…å‡½æ•°è°ƒç”¨æ—¶ä¼ å…¥çš„å‚æ•°ï¼Œä¹Ÿå¯ä»¥å°†æ•°æ®æ‰“åŒ…è¿›å“ˆç¨€è¡¨æˆ–è€…æ„å»ºåˆ°å¯¹è±¡é‡Œï¼Œå…³é”®åœ¨äºç”¨äºè·¨è¶Šè¾¹ç•Œçš„æ•°æ®è¦è¶³å¤Ÿç®€å•å’Œå…·å¤‡ç‹¬ç«‹æ€§ã€‚æˆ‘ä»¬å¹¶ä¸å¸Œæœ›è®©å®ä½“æˆ–æ•°æ®åº“çš„åŸå§‹æ•°æ®è¡Œè·¨è¶Šè¾¹ç•Œï¼ŒåŒæ ·ä¸å¸Œæœ›è·¨è¶Šè¾¹ç•Œçš„ç»“æ„é‡ŒåŒ…å«ä»»æ„ä¼šè¿èƒŒä¾èµ–åŸåˆ™çš„æ•°æ®ã€‚ æ¯”å¦‚ï¼Œè®¸å¤šæ•°æ®åº“æ¡†æ¶ä¼šç”¨ä¾¿äºä½¿ç”¨çš„æ•°æ®æ ¼å¼ä½œä¸ºæŸ¥è¯¢çš„å“åº”ï¼Œæˆ‘ä»¬æŠŠè¿™æ ·çš„æ•°æ®ç§°ä¸º RowStructureã€‚æˆ‘ä»¬ä¸å¸Œæœ›è·¨è¶Šè¾¹ç•Œæ—¶ä¼ é€’è¿™æ ·çš„ç»“æ„ï¼Œè¿™æ ·å¯èƒ½ä¼šè¿èƒŒä¾èµ–åŸåˆ™å› ä¸ºè¿™æœ‰å‡ ç‡è¿«ä½¿å†…éƒ¨çš„ä»£ç å¿…é¡»äº†è§£å¤–éƒ¨çš„æ•°æ®å®šä¹‰ã€‚ å› æ­¤ï¼Œæˆ‘ä»¬ä¼ é€’çš„æ•°æ®è·¨è¶Šè¾¹ç•Œæ—¶ï¼Œæœ€å¸¸ç”¨æ˜¯ä¾¿äºå†…å±‚ä½¿ç”¨çš„æ ¼å¼ã€‚ æ€»ç»“éµå¾ªè¿™äº›ç®€å•çš„è§„åˆ™å¹¶ä¸è´¹åŠ²ï¼Œå¹¶ä¸”å¯ä»¥çœå»å¼€å‘è¿‡ç¨‹ä¸­å¾ˆå¤šéº»çƒ¦ã€‚å°†æ•´ä½“è½¯ä»¶åˆ†å±‚å¹¶é…åˆä¾èµ–åŸåˆ™ï¼Œä½ å¯ä»¥åˆ›å»ºä¸€ä¸ªå…·å¤‡æå¥½æµ‹è¯•æ€§çš„ç³»ç»Ÿï¼Œè¿™ä¼šå¸¦æ¥éå¸¸å¤šçš„å¥½å¤„ã€‚å½“ç³»ç»Ÿå¤–éƒ¨ä»»æ„éƒ¨åˆ†æˆä¸ºäº†æ•´ä½“ç³»ç»Ÿçš„ç“¶é¢ˆï¼Œå¦‚æ•°æ®åº“æˆ–è€… Web å¼€å‘æ¡†æ¶ï¼Œä½ èƒ½åªèŠ±å¾ˆå°çš„ä»£ä»·å°±å°†å…¶æ’¤æ¢ã€‚","categories":[],"tags":[{"name":"Architecture","slug":"Architecture","permalink":"https://blog.mahyang.uk/tags/Architecture/"},{"name":"Software Design","slug":"Software-Design","permalink":"https://blog.mahyang.uk/tags/Software-Design/"}]},{"title":"ç”¨ Go è¯­è¨€æ§åˆ¶ GPIO","slug":"ç”¨-Go-è¯­è¨€æ§åˆ¶-GPIO","date":"2020-03-18T10:28:40.000Z","updated":"2020-03-18T13:25:30.000Z","comments":true,"path":"2020/03/18/ç”¨-Go-è¯­è¨€æ§åˆ¶-GPIO/","link":"","permalink":"https://blog.mahyang.uk/2020/03/18/%E7%94%A8-Go-%E8%AF%AD%E8%A8%80%E6%8E%A7%E5%88%B6-GPIO/","excerpt":"GPIO ä¹Ÿå°±æ˜¯é€šç”¨è¾“å…¥&#x2F;è¾“å‡ºå¤–è®¾ï¼Œåœ¨åµŒå…¥å¼å¼€å‘ä¸­ä¼šç»å¸¸é‡åˆ°çš„ä¸€ç§å¤–éƒ¨è®¾å¤‡ã€‚é€šè¿‡ä½¿ç”¨è½¯ä»¶æ§åˆ¶ GPIO å¯å®ç°å¯¹å¤–è¾“å‡ºç”µå¹³ä¿¡å·ï¼›é€šè¿‡è¯»å– GPIO ç®¡è„šä¸Šçš„ä¿¡å·å¯åœ¨è½¯ä»¶ä¸­è·å–å¤–éƒ¨ä¿¡æ¯ã€‚æ“ä½œ GPIO å¤–è®¾çš„æ–¹æ³•å¾ˆå¤šï¼Œè¿™é‡Œå°†ä»‹ç»ä¸€ç§åœ¨ Linux ç¯å¢ƒä¸­é€šè¿‡ mmap ç³»ç»Ÿè°ƒç”¨æ¥å®Œæˆæ§åˆ¶çš„æ–¹æ³•ã€‚","text":"GPIO ä¹Ÿå°±æ˜¯é€šç”¨è¾“å…¥&#x2F;è¾“å‡ºå¤–è®¾ï¼Œåœ¨åµŒå…¥å¼å¼€å‘ä¸­ä¼šç»å¸¸é‡åˆ°çš„ä¸€ç§å¤–éƒ¨è®¾å¤‡ã€‚é€šè¿‡ä½¿ç”¨è½¯ä»¶æ§åˆ¶ GPIO å¯å®ç°å¯¹å¤–è¾“å‡ºç”µå¹³ä¿¡å·ï¼›é€šè¿‡è¯»å– GPIO ç®¡è„šä¸Šçš„ä¿¡å·å¯åœ¨è½¯ä»¶ä¸­è·å–å¤–éƒ¨ä¿¡æ¯ã€‚æ“ä½œ GPIO å¤–è®¾çš„æ–¹æ³•å¾ˆå¤šï¼Œè¿™é‡Œå°†ä»‹ç»ä¸€ç§åœ¨ Linux ç¯å¢ƒä¸­é€šè¿‡ mmap ç³»ç»Ÿè°ƒç”¨æ¥å®Œæˆæ§åˆ¶çš„æ–¹æ³•ã€‚ è½¯ç¡¬ä»¶ç¯å¢ƒ CPU: iMX6Q(ARM) Kernel: Linux 4.19.72 OS: Ubuntu18.04 GPIO æ§åˆ¶æµç¨‹ç®€ä»‹iMX6Q èŠ¯ç‰‡æ‰‹å†Œä¸Šæœ‰å¦‚ä¸‹æè¿°: ç”±æ­¤å¯çŸ¥è¯»å– GPIO æŸä¸€ä¸ªç®¡è„šä¸Šçš„ä¿¡å·åˆ†ä¸º3ä¸ªæ­¥éª¤: é…ç½®ç®¡è„šå¤ç”¨å¯„å­˜å™¨ï¼Œä»¥å°†æ­¤ç®¡è„šè®¾ç½®ä¸º GPIO æ¨¡å¼ã€‚ é…ç½®ç®¡è„šæ–¹å‘å¯„å­˜å™¨ï¼Œè®¾ç½®æ­¤ç®¡è„šä¸ºè¾“å…¥ã€‚ ä»ç®¡è„šæ•°æ®å¯„å­˜å™¨ä¸­è¯»å–å€¼ã€‚ åä¹‹ï¼Œå¦‚æœè¦å‘å¤–è¾“å‡ºä¿¡å·åˆ™ä¸ºä»¥ä¸‹3æ­¥éª¤: é…ç½®ç®¡è„šå¤ç”¨å¯„å­˜å™¨ï¼Œä»¥å°†æ­¤ç®¡è„šè®¾ç½®ä¸º GPIO æ¨¡å¼ã€‚ é…ç½®ç®¡è„šæ–¹å‘å¯„å­˜å™¨ï¼Œè®¾ç½®æ­¤ç®¡è„šä¸ºè¾“å‡ºã€‚ å‘ç®¡è„šæ•°æ®å¯„å­˜å™¨å†™å…¥å€¼ã€‚ å¯„å­˜å™¨åœ°å€iMX6Q æœ‰7ç»„ GPIO æ¯ç»„æœ‰8ä¸ª 32-bit çš„å¯„å­˜å™¨ï¼Œæ¯ä¸ªå¯„å­˜å™¨ä¸Š 1-bit æ§åˆ¶ç€å…¶å¯¹åº”çš„1ä¸ªç®¡è„šçš„é…ç½®ï¼Œä¹Ÿå°±æ˜¯æ¯ç»„ GPIO æœ‰32ä¸ªç®¡è„šï¼Œæ¯ä¸ªç®¡è„šæœ‰8ä¸ªé…ç½®é¡¹ã€‚å…³äº iMX6Q GPIO æ›´ä¸ºè¯¦ç»†çš„ä»‹ç»å¯å‚é˜… Definitive GPIO guideã€‚ å¯¹äºåªä½¿ç”¨è¾“å…¥&#x2F;è¾“å‡ºåŠŸèƒ½çš„æƒ…å†µï¼Œ8ä¸ªå¯„å­˜å™¨ä¸­æˆ‘ä»¬åªéœ€å…³å¿ƒæ•°æ®å¯„å­˜å™¨å’Œæ–¹å‘å¯„å­˜å™¨è¿™2ä¸ªï¼ˆå¯¹äºç®¡è„šå¤ç”¨å¯„å­˜å™¨ï¼Œå› ä¸ºé»˜è®¤çŠ¶æ€ä¸‹å‡ ä¹æ‰€æœ‰ç®¡è„šéƒ½æ˜¯ GPIO æ¨¡å¼æ‰€ä»¥åŸºæœ¬ä¸ç”¨å…³å¿ƒï¼Œå…·ä½“æƒ…å†µè¯·å‚è€ƒèŠ¯ç‰‡æ‰‹å†Œï¼‰ã€‚ GPIO æ§åˆ¶å¯„å­˜å™¨çš„åŸºåœ°å€ä¸º 0x0209C000ï¼Œåœ°å€å®½åº¦ä¸º 0x4000 ä¹Ÿå°±æ˜¯ç¬¬ä¸€ç»„ GPIO çš„æ§åˆ¶å¯„å­˜å™¨åœ¨åœ°å€ 0x0209C000 ä¸Šï¼Œç¬¬äºŒç»„åœ¨ 0x020A0000ï¼Œä»¥æ­¤ç±»æ¨ã€‚æ¯ä¸€ä¸ªå¯„å­˜å™¨æ˜¯ 32-bit å¤§å°æ‰€ä»¥ï¼Œç¬¬ä¸€ç»„ GPIO çš„æ•°æ®å¯„å­˜å™¨åœ¨ 0x0209C000 æ–¹å‘å¯„å­˜å™¨åœ¨ 0x0209C004ï¼Œå¦‚ä¸‹å›¾: ç”±æ­¤å¯ä»¥åœ¨ä»£ç ä¸­åšå¦‚ä¸‹å®šä¹‰: gpio_imx6q.go1234const ( gpioBaseAddr uint32 = 0x0209C000 gpioAddrWidth uint32 = 0x4000) å¯¹äºæŒ‡å®šçš„æŸä¸€ç»„ GPIO çš„å¯„å­˜å™¨åœ°å€å¯è¿™æ ·è·å¾—: gpio_imx6q.go1234func getGPIOMMapper(group int) ([]uint32, error) &#123; gaddr := gpioBaseAddr + (uint32(group)-1)*gpioAddrWidth // ...&#125; å†…å­˜åœ°å€è½¬æ¢å½“ç¨‹åºè¿è¡Œèµ·æ¥åæ“ä½œç³»ç»Ÿä¸ºæ¯ä¸€ä¸ªè¿›ç¨‹åˆ†é…äº†ä¸€ä¸ªè™šæ‹Ÿåœ°å€ç©ºé—´ï¼Œè€Œå¯„å­˜å™¨çš„åœ°å€åœ¨å®åœ°å€ç©ºé—´ä¸­ï¼Œæ‰€ä»¥éœ€è¦ä½¿ç”¨å†…å­˜åœ°å€è½¬æ¢å°†å®åœ°å€æ˜ å°„åˆ°è™šæ‹Ÿåœ°å€ç©ºé—´ï¼Œè¿™æ ·æˆ‘ä»¬æ‰èƒ½é€šè¿‡å†…å­˜åœ°å€è®¿é—® GPIO å¯„å­˜å™¨ã€‚ æ‰§è¡Œç»ˆç«¯å‘½ä»¤ man mmap å¯æŸ¥é˜…å…³äº mmap è¯¦ç»†çš„èµ„æ–™ï¼Œè¿™é‡Œæˆ‘ä»¬é€šè¿‡ Go è¯­è¨€ unix åŒ…ä¸­å°è£…çš„ Mmap å‡½æ•°æ¥ä½¿ç”¨ mmap ç³»ç»Ÿè°ƒç”¨ï¼Œå¦‚ä¸‹: gpio_imx6q.go12345678func getGPIOMMapper(group int) ([]uint32, error) &#123; // ... b, err := unix.Mmap(int(memMapFile.Fd()), int64(gaddr), 8, unix.PROT_READ|unix.PROT_WRITE, unix.MAP_SHARED) if err != nil &#123; return nil, err &#125; // ...&#125; å…¶ä¸­æŒ‡å®šæ˜ å°„çš„åœ°å€é•¿åº¦ä¸º8å­—èŠ‚ï¼ŒåŸå› æ˜¯è¿™é‡Œæˆ‘ä»¬åªä½¿ç”¨å‰2ä¸ªå¯„å­˜å™¨ã€‚memMapFile å¯ç”±å¦‚ä¸‹å‡½æ•°è·å¾—: gpio_imx6q.go12345func initGPIOMemMap() *os.File &#123; file, err := os.OpenFile(&quot;/dev/mem&quot;, os.O_RDWR, 0600) check(err) return file&#125; å®Œæˆåœ°å€è½¬æ¢ä¹‹å unix.Mmap å‡½æ•°è¿”å›ä¸€ä¸ª byte ç±»å‹çš„åˆ‡ç‰‡ï¼Œè€Œæ¯ä¸ªå¯„å­˜å™¨æ˜¯ 32-bit å®½åº¦ï¼Œä¹Ÿå°±æ˜¯ä¸€ä¸ªå¯„å­˜å™¨å¯¹åº” 4 ä¸ª byteï¼Œè¿™æ ·æ“ä½œèµ·æ¥æ¯”è¾ƒéº»çƒ¦ã€‚ä¸ºäº†ç®€åŒ–æ“ä½œå¯ä»¥å°† []byte è½¬æ¢ä¸º []uint32 ç±»å‹: gpio_imx6q.go1234567func byte2uint32(b []byte) []uint32 &#123; sl := reflect.SliceHeader&#123;&#125; sl.Cap = len(b) / 4 sl.Len = len(b) / 4 sl.Data = uintptr(unsafe.Pointer(&amp;b[0])) return *(*[]uint32)(unsafe.Pointer(&amp;sl))&#125; é€šè¿‡ GPIO å¤–è®¾è¾“å‡ºæˆ–è¯»å–å€¼å®Œæˆä»¥ä¸Šæ“ä½œä¹‹åï¼Œå‡å®šå¾—åˆ°çš„å†…å­˜æ˜ å°„ä¿å­˜åœ¨ var mapper []uint32 ä¸­ã€‚å¦‚æœæˆ‘ä»¬è¦è®¾ç½®ç®¡è„š 10 ä¸ºè¾“å‡ºï¼Œå¹¶ä¸”å¯¹å¤–è¾“å‡ºé«˜ç”µå¹³ï¼Œåˆ™å¯é€šè¿‡ä»¥ä¸‹æ“ä½œå®Œæˆ: gpio_imx6q.go1234// è®¾ç½®æ–¹å‘å¯„å­˜å™¨ä¸­ç¬¬ 10 bit ä¸º1è¡¨ç¤ºç®¡è„š10ä¸ºè¾“å‡ºmapper[1] = mapper[1] | uint32(0x00000001&lt;&lt;10)// è®¾ç½®æ•°æ®å¯„å­˜å™¨ä¸­ç¬¬ 10 bit ä¸º1è¡¨ç¤ºç®¡è„š10è¾“å‡ºé«˜ç”µå¹³mapper[0] = mapper[0] | uint32(0x00000001&lt;&lt;10) å¦‚æœæˆ‘ä»¬è¦è®¾ç½®ç®¡è„š 10 ä¸ºè¾“å…¥ï¼Œå¹¶ä¸”è¯»å–ç®¡è„šä¸Šçš„ç”µå¹³ä¿¡æ¯ï¼Œåˆ™å¯é€šè¿‡ä»¥ä¸‹æ“ä½œå®Œæˆ: gpio_imx6q.go1234// è®¾ç½®æ–¹å‘å¯„å­˜å™¨ä¸­ç¬¬ 10 bit ä¸º0è¡¨ç¤ºç®¡è„š10ä¸ºè¾“å…¥mapper[1] = mapper[1] &amp; ^uint32(0x00000001&lt;&lt;10)// è¯»å–æ•°æ®å¯„å­˜å™¨ä¸­ç¬¬ 10 bit çš„å€¼value := mapper[0] &amp; uint32(0x00000001&lt;&lt;10) æ€»ç»“æœ¬æ–‡ä»‹ç»äº† GPIO çš„åŸºæœ¬æ“ä½œã€iMX6Q GPIO å¤–è®¾å¯„å­˜å™¨çš„åˆ†å¸ƒä»¥åŠ Go è¯­è¨€ä¸­ä½¿ç”¨å†…å­˜æ˜ å°„çš„æ–¹æ³•ï¼Œæœ€åå®ç°äº†ä½¿ç”¨ Go è¯­è¨€å¯¹ GPIO è¿›è¡Œæ§åˆ¶ã€‚å¯¹äºä»¥ä¸Šçš„è¿‡ç¨‹æˆ‘ä»¬å¯ä»¥è¿›ä¸€æ­¥å°†å…¶å°è£…æˆ struct æ–¹ä¾¿ä½¿ç”¨ï¼Œç±»ä¼¼å¦‚ä¸‹: gpio_imx6q.go123456789type GPIOPin struct &#123; Group int Pin int mmapper []uint32&#125;func (pin *GPIOPin) SetDir(dir string) &#123;&#125;func (pin *GPIOPin) Direction() string &#123;&#125;func (pin *GPIOPin) Set(v string) &#123;&#125;func (pin *GPIOPin) Read() string &#123;&#125; é™¤äº†å†…å­˜æ˜ å°„ä¹‹å¤–ï¼Œè¿˜å¯ä»¥ä½¿ç”¨å…¶ä»–æ–¹æ³•æ“ä½œ GPIOï¼Œä¾‹å¦‚é€šè¿‡ sysfs æ–‡ä»¶ç³»ç»Ÿæˆ–è€…ä½¿ç”¨ /dev/gpiochip è®¾å¤‡æ–‡ä»¶ç­‰ï¼Œè¿™é‡Œå°±ä¸åšè¿‡å¤šä»‹ç»äº†ã€‚","categories":[],"tags":[{"name":"Linux","slug":"Linux","permalink":"https://blog.mahyang.uk/tags/Linux/"},{"name":"GPIO","slug":"GPIO","permalink":"https://blog.mahyang.uk/tags/GPIO/"},{"name":"memory map","slug":"memory-map","permalink":"https://blog.mahyang.uk/tags/memory-map/"}]},{"title":"iMX6Q 2GB å†…å­˜æ”¯æŒ","slug":"iMX6Q-2GB-å†…å­˜æ”¯æŒ","date":"2020-03-16T08:18:41.000Z","updated":"2020-03-16T13:19:28.000Z","comments":true,"path":"2020/03/16/iMX6Q-2GB-å†…å­˜æ”¯æŒ/","link":"","permalink":"https://blog.mahyang.uk/2020/03/16/iMX6Q-2GB-%E5%86%85%E5%AD%98%E6%94%AF%E6%8C%81/","excerpt":"iMX6Q SABRESD å¼€å‘æ¿çš„æ¿è½½ DDR å†…å­˜å¤§å°ä¸º 1GB å…¶é…å¥—çš„ codebase ä¹Ÿåªé’ˆå¯¹ 1GB å†…å­˜å¤§å°é€‚é…ã€‚æˆ‘ä»¬çš„è¿è¡Œå¹³å°ä¸Šé…å¤‡äº† 2GB å†…å­˜ï¼Œç›´æ¥ä½¿ç”¨åŸæœ‰ codebase å°†åªèƒ½ä½¿ç”¨å…¶ä¸­ä¸€åŠå†…å­˜ç©ºé—´ã€‚ä»¥ä¸‹å°†ä»‹ç»å¦‚ä½•è®©ç³»ç»Ÿè¯†åˆ«å¹¶ä½¿ç”¨ 2GB å†…å­˜ã€‚","text":"iMX6Q SABRESD å¼€å‘æ¿çš„æ¿è½½ DDR å†…å­˜å¤§å°ä¸º 1GB å…¶é…å¥—çš„ codebase ä¹Ÿåªé’ˆå¯¹ 1GB å†…å­˜å¤§å°é€‚é…ã€‚æˆ‘ä»¬çš„è¿è¡Œå¹³å°ä¸Šé…å¤‡äº† 2GB å†…å­˜ï¼Œç›´æ¥ä½¿ç”¨åŸæœ‰ codebase å°†åªèƒ½ä½¿ç”¨å…¶ä¸­ä¸€åŠå†…å­˜ç©ºé—´ã€‚ä»¥ä¸‹å°†ä»‹ç»å¦‚ä½•è®©ç³»ç»Ÿè¯†åˆ«å¹¶ä½¿ç”¨ 2GB å†…å­˜ã€‚ ç³»ç»Ÿå¯åŠ¨è¿‡ç¨‹ç°è±¡ç³»ç»Ÿå¯åŠ¨è¿‡ç¨‹ä¸­å¯çœ‹åˆ° U-Boot è¾“å‡ºå¦‚ä¸‹ä¿¡æ¯: ç»ˆç«¯è¾“å‡º1234567891011U-Boot 2019.10-rc1-00134-gacda5922db-dirty (Mar 16 2020 - 15:27:54 +0800)CPU: Freescale i.MX6Q rev1.6 996 MHz (running at 792 MHz)CPU: Automotive temperature grade (-40C to 125C) at 36CReset cause: PORModel: Freescale i.MX6 Quad SABRE Smart Device BoardBoard: MX6-SabreSDI2C: readyDRAM: 1 GiBPMIC: PFUZE100 ID=0x10MMC: FSL_SDHC: 0, FSL_SDHC: 3 å…¶ä¸­ DRAM: 1 GiB è¿™ä¸€è¡Œè¡¨ç¤º U-Boot è¯†åˆ«åˆ°çš„å†…å­˜ç©ºé—´å¤§å°ä¸º 1GBã€‚ è¿›å…¥æ“ä½œç³»ç»Ÿä¹‹åï¼Œç»ˆç«¯æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤: ç»ˆç«¯è¾“å‡º123ubuntu@arm:~$ cat /proc/meminfoMemTotal: 1031138 kB... å¯çŸ¥æ“ä½œç³»ç»Ÿè¯†åˆ«åˆ°çš„å†…å­˜ç©ºé—´å¤§å°ä¹Ÿæ˜¯ 1GBã€‚ è¯†åˆ«å†…å­˜å¤§å°çš„è¿‡ç¨‹æŸ¥çœ‹ U-Boot æºç ï¼Œåˆå§‹åŒ–å‡½æ•° board_init_f ä¼šæ‰§è¡Œä¸€ç³»åˆ—åˆå§‹åŒ–æ“ä½œ: u-boot/common/board_f.c12if (initcall_run_list(init_sequence_f)) hang(); init_sequence_f æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œæ‰€æœ‰åˆå§‹åŒ–å‡½æ•°éƒ½æ”¾åœ¨è¿™ä¸ªæ•°ç»„ä¸­ï¼Œå…¶ä¸­æœ‰2ä¸ªå‡½æ•°: imx6q/u-boot/common/board_f.c123456static const init_fnc_t init_sequence_f[] = &#123; // ... announce_dram_init, dram_init, /* configure available RAM banks */ // ...&#125; announce_dram_init å‡½æ•°åªæœ‰ä¸€è¡Œä»£ç ä½œç”¨æ˜¯è¾“å‡º DRAM:ã€‚çœŸæ­£éœ€è¦æˆ‘ä»¬å…³å¿ƒçš„æ˜¯ dram_initï¼Œè¿™ä¸ªå‡½æ•°ç»§ç»­è°ƒç”¨äº†å¦ä¸€ä¸ªå‡½æ•° imx_ddr_sizeï¼Œæ¥ç€å¾€ä¸‹è¿½å‘ç°å¦‚ä¸‹æ³¨é‡Šä¿¡æ¯: u-boot/arch/arm/mach-imx/cpu.c1234567891011/* * imx_ddr_size - return size in bytes of DRAM according MMDC config * The MMDC MDCTL register holds the number of bits for row, col, and data * width and the MMDC MDMISC register holds the number of banks. Combine * all these bits to determine the meme size the MMDC has been configured for */unsigned imx_ddr_size(void)&#123; struct esd_mmdc_regs *mem = (struct esd_mmdc_regs *)MEMCTL_BASE; // ...&#125; å¯çœ‹åˆ°å‡½æ•° imx_ddr_size æ ¹æ® MMDC çš„é…ç½®è¿”å›å†…å­˜ç©ºé—´å¤§å°ï¼Œé…ç½®ä¿¡æ¯å­˜å‚¨åœ¨å¯„å­˜å™¨ MMDC_MDCTL ä¸­ã€‚ é€‚é… 2GB å†…å­˜ä»å‰é¢çš„ä»£ç ä¸­å¯çœ‹åˆ°å¯„å­˜å™¨ MMDC_MDCTL çš„åœ°å€åœ¨å®šä¹‰ MEMCTL_BASE ä¸­ï¼Œæ¥ç€æŸ¥çœ‹ MEMCTL_BASE çš„å®šä¹‰ï¼Œå¯å¾—åˆ°å¦‚ä¸‹ä¿¡æ¯: 12345678910111213141516MEMCTL_BASE | vMMDC_P0_BASE_ADDR | vAIPS2_OFF_BASE_ADDR + 0x30000 | vATZ2_BASE_ADDR + 0x80000 + 0x30000 | vAIPS2_ARB_BASE_ADDR + 0x80000 + 0x30000 | v0x02100000 + 0x80000 + 0x30000 = 0x021b0000 æ‰€ä»¥ MMDC_MDCTL å¯„å­˜å™¨åœ°å€ä¸º 0x021b0000ã€‚æ­¤å¤„ä»£ç æ˜¯ä»å¯„å­˜å™¨ä¸­è¯»å–é…ç½®çš„å€¼ï¼Œé‚£ä¹ˆä¸€å®šä¼šæœ‰å…¶ä»–çš„ä»£ç å»é…ç½®è¿™ä¸ªå¯„å­˜å™¨çš„å€¼ï¼Œç»§ç»­æŸ¥æ‰¾å¯å‘ç°: u-boot/board/freescale/mx6sabresd/mx6sabresd.c123456static int mx6q_dcd_table[] = &#123; //... 0x021b0040, 0x00000027, 0x021b0000, 0x831A0000, //...&#125; åŸå§‹ codebase ä¸­å‘å¯„å­˜å™¨ MMDC_MDCTL é…ç½®äº†å€¼ 0x831A0000 ä»¥åŠå‘å¯„å­˜å™¨ MMDC_MDASP é…ç½®äº†å€¼ 0x00000027ã€‚ æ¥ç€ä» iMX6Q èŠ¯ç‰‡å‚è€ƒæ‰‹å†Œä¸­å¯æŸ¥åˆ°å¯„å­˜å™¨ MMDC_MDCTL æ•°æ®ä½çš„åˆ†é…: ä»è€Œå¾—çŸ¥åŸå§‹ä»£ç ä¸­ï¼Œå¯„å­˜å™¨ MMDC_MDCTL é…ç½®çš„å«ä¹‰ä¸ºï¼š ä½¿èƒ½ CS0 å…³é—­ CS1 è¡Œåœ°å€å®½åº¦ 14bit åˆ—åœ°å€å®½åº¦ 10bit burst é•¿åº¦ 8 æ•°æ®æ€»çº¿å¤§å° 64bit æˆ‘ä»¬è¿è¡Œå¹³å°ä¸Šçš„å†…å­˜èŠ¯ç‰‡å’Œ iMX6Q SABRESD å¼€å‘æ¿ä¸Šçš„å†…å­˜èŠ¯ç‰‡æ˜¯ä¸€æ ·çš„å°è£…ï¼Œåªæ˜¯å®¹é‡æ˜¯åè€…çš„2å€ï¼Œä¹Ÿå°±æ˜¯è¡Œåœ°å€å®½åº¦å¤šäº†1bitï¼Œæ‰€ä»¥å°† MMDC_MDCTL å¯„å­˜å™¨çš„å€¼é…ç½®ä¸º 0x841A0000ã€‚ å¯¹äºå¯„å­˜å™¨ MMDC_MDASPï¼ŒèŠ¯ç‰‡æ‰‹å†Œä¸­æè¿°å¦‚ä¸‹: MMDCx_MDASP[CS0_END] should be set to DDR_CS_SIZE&#x2F;32MB + 0x7 (DDR base address begins at 0x10000000) Freescalei.MX 6Dual/6Quad Applications Processor Reference Manual æ‰€ä»¥å¯„å­˜å™¨ MMDC_MDASP çš„å€¼åº”è¯¥é…ç½®ä¸º å†…å­˜å¤§å°/32MB + 0x7 ä¹Ÿå°±æ˜¯ 0x00000047ï¼Œæœ€åé…ç½®å¦‚ä¸‹: u-boot/board/freescale/mx6sabresd/mx6sabresd.c123456static int mx6q_dcd_table[] = &#123; //... 0x021b0040, 0x00000047, 0x021b0000, 0x841A0000, //...&#125; è®¾å¤‡æ ‘ä¿®æ”¹å°† U-Boot ä»¥åŠå†…æ ¸è®¾å¤‡æ ‘ä¸å†…å­˜å¤§å°ç›¸å…³çš„åœ°æ–¹ä¿®æ”¹ä¸º 2GB: u-boot/arch/arm/dts/imx6qdl-sabresd.dtsi123memory@10000000 &#123; reg = &lt;0x10000000 0x80000000&gt;;&#125;; æœ€åï¼Œå°†ä»¥ä¸Šä¿®æ”¹ä¿å­˜åˆ°è®¾å¤‡ä¸­ï¼Œå¯åŠ¨ç³»ç»Ÿä¹‹åå¯ä»¥çœ‹åˆ° U-Boot ä»¥åŠæ“ä½œç³»ç»Ÿå‡è¯†åˆ«åˆ° 2GB å†…å­˜ç©ºé—´ã€‚ æ€»ç»“æœ¬æ–‡ä»‹ç»äº† U-Boot åœ¨å¯åŠ¨æ—¶è¯†åˆ«å†…å­˜å¤§å°çš„è¿‡ç¨‹ï¼Œä»¥åŠ iMX6Q å…³äºå†…å­˜ä¿¡æ¯çš„å‡ ä¸ªå¯„å­˜å™¨çš„é…ç½®ï¼Œæœ€ç»ˆå®ç°è®©ç³»ç»Ÿå¹³å°è¯†åˆ«å¹¶ä¸”ä½¿ç”¨ 2GB å†…å­˜ç©ºé—´ã€‚","categories":[],"tags":[{"name":"iMX6Q","slug":"iMX6Q","permalink":"https://blog.mahyang.uk/tags/iMX6Q/"},{"name":"å†…å­˜æ‹“å±•","slug":"å†…å­˜æ‹“å±•","permalink":"https://blog.mahyang.uk/tags/%E5%86%85%E5%AD%98%E6%8B%93%E5%B1%95/"}]},{"title":"Linux ç³»ç»Ÿä¸­ Watchdog çš„åº”ç”¨","slug":"Linux-ç³»ç»Ÿä¸­-Watchdog-çš„åº”ç”¨","date":"2020-02-22T02:08:56.000Z","updated":"2020-02-23T09:43:09.000Z","comments":true,"path":"2020/02/22/Linux-ç³»ç»Ÿä¸­-Watchdog-çš„åº”ç”¨/","link":"","permalink":"https://blog.mahyang.uk/2020/02/22/Linux-%E7%B3%BB%E7%BB%9F%E4%B8%AD-Watchdog-%E7%9A%84%E5%BA%94%E7%94%A8/","excerpt":"æœ¬æ–‡å°†ä»‹ç»å¦‚ä½•åœ¨ Linux ç³»ç»Ÿçš„ç”¨æˆ·å±‚ä½¿ç”¨ Watchdogã€‚","text":"æœ¬æ–‡å°†ä»‹ç»å¦‚ä½•åœ¨ Linux ç³»ç»Ÿçš„ç”¨æˆ·å±‚ä½¿ç”¨ Watchdogã€‚ æ“ä½œç¯å¢ƒ ç¡¬ä»¶ç¯å¢ƒ: iMX6Q SABRE-SD å¼€å‘æ¿ æ“ä½œç³»ç»Ÿå†…æ ¸: Linux 4.19.72-armv7 æ“ä½œç³»ç»Ÿå‘è¡Œç‰ˆ: Ubuntu18.04 å¼€å¯ Watchdogåœ¨ç¼–è¯‘å†…æ ¸æ—¶å¼€å¯ Watchdog: ./tools/rebuild.sh12# å†…æ ¸é…ç½®é€‰é¡¹ä½ç½®Device Drivers -&gt; Watchdog Timer Support å¼€å¯ Disable watchdog shutdown on close è¿™ä¸€é¡¹ã€‚ å†…æ ¸æ–‡æ¡£ä¸­å…³äºæ­¤é€‰é¡¹çš„è§£é‡Šå¦‚ä¸‹: When the device is closed, the watchdog is disabled, unless the â€œMagicCloseâ€ feature is supported (see below). This is not always such a good idea, since if there is a bug in the watchdog daemon and it crashes the system will not reboot. Because of this, some of the drivers support the configuration option â€œDisable watchdog shutdown on closeâ€, CONFIG_WATCHDOG_NOWAYOUT. If it is set to Y when compiling the kernel, there is no way of disabling the watchdog once it has been started. So, if the watchdog daemon crashes, the system will reboot after the timeout has passed. Watchdog devices also usually support the nowayout module parameter so that this option can be controlled at runtime. Magic Close feature: If a driver supports â€œMagic Closeâ€, the driver will not disable the watchdog unless a specific magic character â€˜Vâ€™ has been sent to &#x2F;dev&#x2F;watchdog just before closing the file. If the userspace daemon closes the file without sending this special character, the driver will assume that the daemon (and userspace in general) died, and will stop pinging the watchdog without disabling it first. This will then cause a reboot if the watchdog is not re-opened in sufficient time. Christer WeingelThe Linux Watchdog driver API. ç®€å•æ¥è¯´ï¼Œå¼€å¯æ­¤é€‰é¡¹ä¹‹åä¸€æ—¦æˆ‘ä»¬æ‰“å¼€äº† Watchdog è®¾å¤‡ï¼Œåªè¦ç¨‹åºæ²¡å¯¹æ­¤ Watchdog åšæ–‡æ¡£ä¸­æŒ‡å®šçš„æ“ä½œï¼Œé‚£ä¹ˆ Watchdog å°±ä¼šé‡å¯ç³»ç»Ÿã€‚ åŸºæœ¬æ“ä½œæ“ä½œç³»ç»Ÿå†…æ ¸ä¼šå°† CPU èŠ¯ç‰‡ä¸Šçš„ Watchdog å¤–è®¾æŠ½è±¡ä¸ºæ–‡ä»¶ç³»ç»Ÿä¸­çš„ä¸€ä¸ªå­—ç¬¦è®¾å¤‡: ubuntu@arm:~$12ls /dev/watchdog*# /dev/watchdog /dev/watchdog0 ä¸Šé¢å‘½ä»¤åˆ—å‡ºæ¥ç³»ç»Ÿä¸­çš„ Watchdog è®¾å¤‡ï¼ˆ/dev/watchdogã€/dev/watchdog0 åœ¨åº•å±‚æŒ‡å‘åŒä¸€ä¸ªç¡¬ä»¶ï¼‰ã€‚ä½¿ç”¨å…¶ä¸­ä»»ä¸€è®¾å¤‡éƒ½å¯ä»¥ã€‚ æ‰“å¼€è®¾å¤‡ api_watchdog_open1watchdog_fd = open(watchdog_dev, O_RDWR); æ ¹æ®å¤´æ–‡ä»¶ linux/watchdog.h ä¸­çš„å®šä¹‰ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡å¾—åˆ°çš„æ–‡ä»¶æè¿°ç¬¦å¯¹ watchdog è®¾å¤‡åšåé¢è¿™äº›æ“ä½œã€‚ è®¾ç½® watchdog è¶…æ—¶æ—¶é—´ api_watchdog_settimeout1ioctl(watchdog_fd, WDIOC_SETTIMEOUT, &amp;seconds); feed watchdog api_watchdog_feed1ioctl(watchdog_fd, WDIOC_KEEPALIVE, NULL); å¯ä»¥å°†ä¸Šé¢çš„è¿™äº›æ“ä½œå°è£…æˆå‡½æ•°æ¥å£ï¼Œåœ¨å‡½æ•°å†…éƒ¨åšä¸€äº›é”™è¯¯å¤„ç†ã€‚ æµ‹è¯•main.c1234567891011121314int main(void)&#123; struct timespec wait_time = &#123; 1, 0 &#125;; if (api_watchdog_init(WATCHDOG_DEV, WATCHDOG_TIMEOUT) &lt; 0) return -1; printf(&quot;Watchdog opened!\\n&quot;); while (1) &#123; api_watchdog_feed(); nanosleep(&amp;wait_time, NULL); &#125;&#125; å¦‚ä¸Šï¼Œå…ˆåˆå§‹åŒ– watchdog ç„¶åæ¯ç§’ feed watchdog ä¸€æ¬¡ï¼Œæ­¤æ—¶ç³»ç»Ÿå¦‚å¸¸è¿è¡Œã€‚å½“ kill æ­¤ç¨‹åºåï¼Œç”±äºå‰é¢åœ¨å†…æ ¸å¼€å¯äº† Disable watchdog shutdown on close é€‰é¡¹ watchdog ä¼šç»§ç»­å·¥ä½œï¼ŒåŒæ—¶æ²¡æœ‰ç»§ç»­ feed çš„æ“ä½œæ‰€ä»¥ç³»ç»Ÿè¿›å…¥é‡å¯æµç¨‹ã€‚ å¼•å…¥å¤–éƒ¨ Kick ä¿¡å·ä»¥ä¸€ä¸ªå…·ä½“çš„åº”ç”¨åœºæ™¯ä¸ºä¾‹ï¼Œå¦‚ä¸‹: ç¡¬ä»¶è¿æ¥123------- GPIO --------| CPU | &lt;------ | FPGA |------- -------- FPGA é€šè¿‡ CPU çš„ GPIO å¤–è®¾å‘å¼€å‘æ¿è¾“å…¥ä¸€ä¸ªå‘¨æœŸæ€§ç¿»è½¬ä¿¡å·ã€‚CPU åœ¨æ¯ä¸€ä¸ªå‘¨æœŸå¼€å§‹æ—¶é‡ç½® watchdogï¼Œæˆ‘ä»¬å¯ä»¥æ£€æµ‹ GPIO çš„ä¸Šå‡æ²¿æˆ–è€…ä¸‹é™æ²¿è·å¾—å‘¨æœŸå¼€å§‹çš„ä¿¡æ¯ã€‚ å¯¹ GPIO çš„æ“ä½œåœ¨ Linux ç¯å¢ƒä¸­æœ‰å¾ˆå¤šæ–¹æ³•å®ç°ï¼Œè¿™é‡Œæˆ‘ä»¬ä½¿ç”¨ libgpiod åº“æ¥å®ç°å¯¹ GPIO ä¸Šå‡æ²¿ä¿¡å·çš„æ£€æµ‹ã€‚ libgpiod ä¸­å°è£…äº†å¾ˆå¤šä¾¿äºä½¿ç”¨çš„ APIã€‚åœ¨å½“å‰ä½¿ç”¨åœºæ™¯ä¸­ï¼Œåªéœ€è°ƒç”¨å‡½æ•° gpiod_ctxless_event_monitor å°±å¯å®ç°æˆ‘ä»¬æƒ³è¦çš„åŠŸèƒ½ï¼Œå…¶å‡½æ•°ç­¾åä»¥åŠç›¸åº”çš„æ–‡æ¡£æ³¨é‡Šå¦‚ä¸‹: 1234567891011121314151617181920212223/** * @brief Wait for events on a single GPIO line. * @param device Name, path, number or label of the gpiochip. * @param event_type Type of events to listen for. * @param offset GPIO line offset to monitor. * @param active_low The active state of this line - true if low. * @param consumer Name of the consumer. * @param timeout Maximum wait time for each iteration. * @param poll_cb Callback function to call when waiting for events. * @param event_cb Callback function to call for each line event. * @param data User data passed to the callback. * @return 0 if no errors were encountered, -1 if an error occurred. * @note The way the ctxless event loop works is described in detail in * ::gpiod_ctxless_event_monitor_multiple - this is just a wrapper aound * this routine which calls it for a single GPIO line. */int gpiod_ctxless_event_monitor(const char *device, int event_type, unsigned int offset, bool active_low, const char *consumer, const struct timespec *timeout, gpiod_ctxless_event_poll_cb poll_cb, gpiod_ctxless_event_handle_cb event_cb, void *data) GPIOD_API; å¦‚ä¸Šå¯ä»¥çœ‹å‡ºå‡ ä¸ªå…³é”®å‚æ•°ï¼Œé€šè¿‡ deviceã€offset å‚æ•°æŒ‡å®šä½¿ç”¨çš„ GPIO ç®¡è„šï¼Œevent_type æŒ‡å®šæ£€æµ‹äº‹ä»¶ï¼ˆå¦‚ï¼Œä¸Šå‡æ²¿äº‹ä»¶ï¼‰ï¼Œevent_cb æ˜¯è§¦å‘æŒ‡å®šäº‹ä»¶åè°ƒç”¨çš„å›è°ƒå‡½æ•°ï¼Œå…¶è°ƒç”¨æ–¹æ³•å¤§è‡´å¦‚ä¸‹: ä¸Šå‡æ²¿æ£€æµ‹12345// WDOG_GPIO_SIG_CHIP &quot;/dev/gpiochip6&quot;// WDOG_GPIO_SIG_PORT 7gpiod_ctxless_event_monitor(WDOG_GPIO_SIG_CHIP, GPIOD_CTXLESS_EVENT_RISING_EDGE, WDOG_GPIO_SIG_PORT, false, &quot;wdog&quot;, &amp;timeout, NULL, gpio6_port7_rising_edge_handle_cb, NULL); æ¥ä¸‹æ¥åªéœ€è¦å†å®šä¹‰å›è°ƒå‡½æ•°å³å¯ï¼Œå›è°ƒå‡½æ•°çš„å‡½æ•°ç­¾åå¦‚ä¸‹: 12345678910111213/** * @brief Simple event callback signature. * * The callback function takes the following arguments: event type (int), * GPIO line offset (unsigned int), event timestamp (const struct timespec *) * and a pointer to user data (void *). * * This callback is called by the ctxless event loop functions for each GPIO * event. If the callback returns ::GPIOD_CTXLESS_EVENT_CB_RET_ERR, it should * also set errno. */typedef int (*gpiod_ctxless_event_handle_cb)(int, unsigned int, const struct timespec *, void *); æ‰€ä»¥æˆ‘ä»¬å®šä¹‰çš„ä¸Šå‡æ²¿äº‹ä»¶å›è°ƒå‡½æ•°å¤§è‡´å¦‚ä¸‹: å®šä¹‰å›è°ƒå‡½æ•°123456789101112int gpio6_port7_rising_edge_handle_cb(int type, unsigned int offset, const struct timespec *timestamp, void *arg)&#123; wdog_count ++; if (wdog_count &gt;= WDOG_FEED_PERIOD / FPGA_WDOG_SIG_PERIOD) &#123; api_watchdog_feed(); wdog_count = 0; &#125; return GPIOD_CTXLESS_EVENT_CB_RET_OK;&#125; å…¶ä¸­å…³é”®åœ¨äº api_watchdog_feed()ã€‚ ä»¥ä¸Šå°±å®ç°äº†å¤–éƒ¨ Kick ä¿¡å·çš„å¼•å…¥ã€‚ é…ç½® systemd æœåŠ¡æˆ‘ä»¬å¸Œæœ› watchdog ç¨‹åºéšç€ç³»ç»Ÿè‡ªåŠ¨å¯åŠ¨ï¼Œæ‰€ä»¥é…ç½®å¦‚ä¸‹çš„ systemd æœåŠ¡: wdog_fpga.service12345678910[Unit]Description=Watchdog systemd service.ConditionKernelCommandLine=!disable_wdog[Service]Type=simpleExecStart=/usr/bin/wdog_fpga[Install]WantedBy=multi-user.target å…¶ä¸­æˆ‘ä»¬å®šä¹‰äº† ConditionKernelCommandLine å‚æ•°ä¸º !disable_wdogã€‚è¿™æ ·å½“ç³»ç»Ÿå¯åŠ¨ä¹‹å systemd ä¼šæ£€æµ‹å†…æ ¸å¯åŠ¨å‘½ä»¤è¡Œå‚æ•°ä¸­æ˜¯å¦å­˜åœ¨disable_wdogï¼Œå¦‚æœä¸å­˜åœ¨åˆ™å¯åŠ¨ watchdogï¼Œåä¹‹ä¾ç„¶ã€‚è¿™æ ·é…ç½®çš„å¥½å¤„æ˜¯ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ç³»ç»Ÿå¯åŠ¨ä¹‹å‰é…ç½®æ˜¯å¦å¼€å¯ watchdogã€‚ U-Boot ç¯å¢ƒè®¾ç½®å†…æ ¸å‘½ä»¤è¡Œå‚æ•°å¦‚æœæˆ‘ä»¬ä¸æƒ³å¼€å¯ watchdogï¼Œåˆ™åœ¨ U-Boot å¯åŠ¨åæš‚åœå¼•å¯¼å†…æ ¸ï¼Œç„¶åå°† disable_wdog å‚æ•°è®¾ç½®åˆ°å†…æ ¸å‘½ä»¤è¡Œå‚æ•°ä¸­ï¼Œå¦‚ä¸‹: 1setenv bootargs ... å…¶ä»–å‚æ•° ... disable_wdog ç„¶åå†å¼•å¯¼å†…æ ¸å¯åŠ¨: 1run bootcmd æ€»ç»“æ–‡æœ¬ä»‹ç»äº†å¦‚ä½•åœ¨ Linux æ“ä½œç³»ç»Ÿä¸­ä½¿ç”¨ watchdogï¼Œåˆ†ä¸ºä»¥ä¸‹æ–¹é¢çš„å·¥ä½œ: å†…æ ¸é€‰é¡¹é…ç½® éƒ¨åˆ† API ä»‹ç» è®¾å¤‡æ“ä½œæ¥å£å°è£… å®é™…åº”ç”¨åœºæ™¯ç¤ºä¾‹","categories":[],"tags":[{"name":"Linux","slug":"Linux","permalink":"https://blog.mahyang.uk/tags/Linux/"},{"name":"Watchdog","slug":"Watchdog","permalink":"https://blog.mahyang.uk/tags/Watchdog/"},{"name":"Embedded System","slug":"Embedded-System","permalink":"https://blog.mahyang.uk/tags/Embedded-System/"}]},{"title":"iMX6Q SABRE-SD å¼€å‘æ¿è½¯ä»¶çƒ§å½•","slug":"iMX6Q-SABRE-SD-å¼€å‘æ¿è½¯ä»¶çƒ§å½•","date":"2020-02-19T09:04:39.000Z","updated":"2020-02-20T14:55:42.000Z","comments":true,"path":"2020/02/19/iMX6Q-SABRE-SD-å¼€å‘æ¿è½¯ä»¶çƒ§å½•/","link":"","permalink":"https://blog.mahyang.uk/2020/02/19/iMX6Q-SABRE-SD-%E5%BC%80%E5%8F%91%E6%9D%BF%E8%BD%AF%E4%BB%B6%E7%83%A7%E5%BD%95/","excerpt":"æœ¬æ–‡å°†ä»‹ç» iMX6Q SABRE-SD å¼€å‘æ¿çš„è½¯ä»¶çƒ§å½•æµç¨‹ã€‚","text":"æœ¬æ–‡å°†ä»‹ç» iMX6Q SABRE-SD å¼€å‘æ¿çš„è½¯ä»¶çƒ§å½•æµç¨‹ã€‚ è½¯ä»¶ç¯å¢ƒ æ“ä½œç³»ç»Ÿ: Ubuntu14.04 å‡†å¤‡å·¥ä½œ ä½¿å¼€å‘æ¿è¿›å…¥å·¥å‚æ¨¡å¼å…·ä½“æ“ä½œè¯·å‚è€ƒæ­¤æ–‡æ¡£ã€‚ å¼€å‘æ¿ç³»ç»Ÿè½¯ä»¶åˆ¶ä½œå¼€å‘æ¿ç³»ç»Ÿè½¯ä»¶è¯·å‚è€ƒæ­¤æ–‡æ¡£ã€‚ çƒ§å½•æµç¨‹çƒ§å½•è¿‡ç¨‹ä¸­ä¼šä½¿ç”¨ utp_com å‘å¼€å‘æ¿å‘é€æŒ‡ä»¤ï¼Œå¼€å‘æ¿æ”¶åˆ°æŒ‡ä»¤åæ‰§è¡Œã€‚ åˆ›å»ºåˆ†åŒºè¡¨ åˆ†åŒºè„šæœ¬ netop@mfgtools:~/utp_com$12345678910111213141516171819cat &lt;&lt;END &gt;/tmp/mkmmc.sh#!/bin/shnode=\\$1# partition size in MBBOOT_ROM_SIZE=10# wait for the SD/MMC device node readywhile [ ! -e \\$&#123;node&#125; ]dosleep 1echo &quot;wait for \\$&#123;node&#125; appear&quot;done# destroy the partition tabledd if=/dev/zero of=\\$&#123;node&#125; bs=1024 count=1# call sfdisk to create partition tablesfdisk --force \\$&#123;node&#125; &lt;&lt;EOF1M,,L,*EOFEND å‘é€å¹¶æ‰§è¡Œåˆ†åŒºè„šæœ¬ netop@mfgtools:~/utp_com$12./utp_com -d /dev/sg1 -c &quot;send&quot; -f /tmp/mkmmc.sh./utp_com -d /dev/sg1 -c &quot;$ sh \\$FILE /dev/mmcblk3&quot; å»ºç«‹ U-Boot åˆ†åŒº boot åˆ†åŒºå†™ä½¿èƒ½ netop@mfgtools:~/utp_com$1./utp_com -d /dev/sg1 -c &quot;$ echo 0 &gt; /sys/block/mmcblk3boot0/force_ro&quot; å‘é€ SPLã€U-Boot å¹¶å†™å…¥ netop@mfgtools:~/utp_com$1234./utp_com -d /dev/sg1 -c &quot;send&quot; -f &lt;SPL æ–‡ä»¶è·¯å¾„&gt;./utp_com -d /dev/sg1 -c &quot;$ dd if=\\$FILE of=/dev/mmcblk3boot0 bs=1024 seek=1&quot;./utp_com -d /dev/sg1 -c &quot;send&quot; -f &lt;U-Boot æ–‡ä»¶è·¯å¾„&gt;./utp_com -d /dev/sg1 -c &quot;$ dd if=\\$FILE of=/dev/mmcblk3boot0 bs=1024 seek=69&quot; boot åˆ†åŒºåªè¯»ä½¿èƒ½ netop@mfgtools:~/utp_com$1./utp_com -d /dev/sg1 -c &quot;$ echo 1 &gt; /sys/block/mmcblk3boot0/force_ro&quot; ä½¿èƒ½ boot åˆ†åŒº netop@mfgtools:~/utp_com$1./utp_com -d /dev/sg1 -c &quot;$ mmc bootpart enable 1 1 /dev/mmcblk3&quot; åˆ›å»ºç³»ç»Ÿåˆ†åŒº å»ºç«‹ EXT4 åˆ†åŒº netop@mfgtools:~/utp_com$12./utp_com -d /dev/sg1 -c &quot;$ while [ ! -e /dev/mmcblk3p1 ]; do sleep 1; echo \\&quot;waiting...\\&quot;; done&quot;./utp_com -d /dev/sg1 -c &quot;$ mkfs.ext4 -L rootfs /dev/mmcblk3p1&quot; æŒ‚è½½ç³»ç»Ÿåˆ†åŒº netop@mfgtools:~/utp_com$12./utp_com -d /dev/sg1 -c &quot;$ mkdir -p /mnt/rootfs&quot;./utp_com -d /dev/sg1 -c &quot;$ mount /dev/mmcblk3p1 /mnt/rootfs&quot; å®‰è£…æ“ä½œç³»ç»Ÿ å†™å…¥æ ¹æ–‡ä»¶ç³»ç»Ÿ netop@mfgtools:~/utp_com$1234./utp_com -d /dev/sg1 -c &quot;pipe tar -x[æ–‡ä»¶å‹ç¼©æ–¹å¼] -C /mnt/rootfs&quot; -f &lt;rootfs æ–‡ä»¶è·¯å¾„&gt;./utp_com -d /dev/sg1 -c &quot;frf&quot;./utp_com -d /dev/sg1 -c &quot;$ chown root:root /mnt/rootfs&quot;./utp_com -d /dev/sg1 -c &quot;$ chmod 755 /mnt/rootfs&quot; è®¾ç½® uname_r netop@mfgtools:~/utp_com$1./utp_com -d /dev/sg1 -c &quot;$ echo &#x27;uname_r=&lt;å†…æ ¸ç‰ˆæœ¬ä¿¡æ¯&gt;&#x27; &gt;&gt; /mnt/rootfs/boot/uEnv.txt&quot; å†™å…¥å†…æ ¸ã€è®¾å¤‡æ ‘ã€å†…æ ¸æ¨¡å— netop@mfgtools:~/utp_com$1234567./utp_com -d /dev/sg1 -c &quot;send&quot; -f &lt;kernel æ–‡ä»¶è·¯å¾„&gt;./utp_com -d /dev/sg1 -c &quot;$ cp \\$FILE /mnt/rootfs/boot/vmlinuz-&lt;å†…æ ¸ç‰ˆæœ¬ä¿¡æ¯&gt;&quot;./utp_com -d /dev/sg1 -c &quot;send&quot; -f &lt;dtb æ–‡ä»¶è·¯å¾„&gt;./utp_com -d /dev/sg1 -c &quot;$ mkdir -p /mnt/rootfs/boot/dtbs/&lt;å†…æ ¸ç‰ˆæœ¬ä¿¡æ¯&gt;/&quot;./utp_com -d /dev/sg1 -c &quot;$ tar xf \\$FILE -C /mnt/rootfs/boot/dtbs/&lt;å†…æ ¸ç‰ˆæœ¬ä¿¡æ¯&gt;/&quot;./utp_com -d /dev/sg1 -c &quot;send&quot; -f &lt;modules æ–‡ä»¶è·¯å¾„&gt;./utp_com -d /dev/sg1 -c &quot;$ tar xf \\$FILE -C /mnt/rootfs/&quot; æ›´æ–° fstab netop@mfgtools:~/utp_com$1./utp_com -d /dev/sg1 -c &quot;$ echo &#x27;/dev/mmcblk2p1 / auto errors=remount-ro 0 1&#x27; &gt;&gt; /mnt/rootfs/etc/fstab&quot; åŒæ­¥ï¼Œå–æ¶ˆæŒ‚è½½ netop@mfgtools:~/utp_com$12./utp_com -d /dev/sg1 -c &quot;$ sync&quot;./utp_com -d /dev/sg1 -c &quot;$ umount /mnt/rootfs&quot; å¯åŠ¨å¼€å‘æ¿å°†å¼€å‘æ¿çš„å¯åŠ¨æ‹¨ç å¼€å…³æ‹¨è‡³ 11100110ï¼Œç„¶åä¸Šç”µå¯åŠ¨å¯çœ‹åˆ°ä¸²å£è¾“å‡º: ä¸²å£è¾“å‡º12345Ubuntu 18.04.3 LTS arm ttymxc0default username:password is [ubuntu:temppwd]arm login: æ€»ç»“æœ¬æ–‡ä»‹ç»äº† iMX6Q SABRE-SD å¼€å‘æ¿çš„è½¯ä»¶çƒ§å½•æµç¨‹ï¼Œæ€»ç»“ä¸ºä»¥ä¸‹4ä¸ªæ­¥éª¤: åˆ›å»ºåˆ†åŒºè¡¨ å»ºç«‹ U-Boot åˆ†åŒº åˆ›å»ºç³»ç»Ÿåˆ†åŒº å®‰è£…æ“ä½œç³»ç»Ÿ","categories":[],"tags":[{"name":"iMX6Q","slug":"iMX6Q","permalink":"https://blog.mahyang.uk/tags/iMX6Q/"}]},{"title":"iMX6Q SABRE-SD å¼€å‘æ¿ç³»ç»Ÿè½¯ä»¶","slug":"iMX6Q-SABRE-SD-å¼€å‘æ¿ç³»ç»Ÿè½¯ä»¶","date":"2020-02-19T06:34:46.000Z","updated":"2020-02-19T12:38:55.000Z","comments":true,"path":"2020/02/19/iMX6Q-SABRE-SD-å¼€å‘æ¿ç³»ç»Ÿè½¯ä»¶/","link":"","permalink":"https://blog.mahyang.uk/2020/02/19/iMX6Q-SABRE-SD-%E5%BC%80%E5%8F%91%E6%9D%BF%E7%B3%BB%E7%BB%9F%E8%BD%AF%E4%BB%B6/","excerpt":"æœ¬æ–‡å°†ä»‹ç»é€‚ç”¨äº iMX6Q SABRE-SD å¼€å‘æ¿çš„å¯åŠ¨åŠ è½½å™¨ï¼ˆU-Bootï¼‰ã€Linux å†…æ ¸ä»¥åŠæ ¹æ–‡ä»¶ç³»ç»Ÿçš„åˆ¶ä½œã€‚","text":"æœ¬æ–‡å°†ä»‹ç»é€‚ç”¨äº iMX6Q SABRE-SD å¼€å‘æ¿çš„å¯åŠ¨åŠ è½½å™¨ï¼ˆU-Bootï¼‰ã€Linux å†…æ ¸ä»¥åŠæ ¹æ–‡ä»¶ç³»ç»Ÿçš„åˆ¶ä½œã€‚ è½¯ä»¶ç¯å¢ƒ æ“ä½œç³»ç»Ÿ: Ubuntu14.04 ARM äº¤å‰ç¼–è¯‘å·¥å…·é“¾ ä¸‹è½½ &amp; è§£å‹ netop@mfgtools:~$12wget -c https://releases.linaro.org/components/toolchain/binaries/6.5-2018.12/arm-linux-gnueabihf/gcc-linaro-6.5.0-2018.12-x86_64_arm-linux-gnueabihf.tar.xztar xf gcc-linaro-6.5.0-2018.12-x86_64_arm-linux-gnueabihf.tar.xz æµ‹è¯• netop@mfgtools:~$12export CC=`pwd`/gcc-linaro-6.5.0-2018.12-x86_64_arm-linux-gnueabihf/bin/arm-linux-gnueabihf-$&#123;CC&#125;gcc --version ç»ˆç«¯è¾“å‡º1234arm-linux-gnueabihf-gcc (Linaro GCC 6.5-2018.12) 6.5.0Copyright (C) 2017 Free Software Foundation, Inc.This is free software; see the source for copying conditions. There is NOwarranty; not even for MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. å¯åŠ¨åŠ è½½å™¨: U-Boot ä¸‹è½½æºç  netop@mfgtools:~$123git clone https://github.com/u-boot/u-bootcd u-boot/git checkout v2019.07 -b tmp æ‰“è¡¥ä¸ netop@mfgtools:~/u-boot$12wget -c https://raw.githubusercontent.com/eewiki/u-boot-patches/master/v2019.07-rc4/0001-mx6sabresd-fixes.patchpatch -p1 &lt; 0001-mx6sabresd-fixes.patch ä¿®æ”¹ä»£ç  ç”¨ç¼–è¾‘å™¨æ‰“å¼€æ–‡ä»¶ ~/u-boot/include/configs/mx6sabre_common.hï¼Œæ‰¾åˆ°å¦‚ä¸‹ä»£ç : vi ~/u-boot/include/configs/mx6sabre_common.h123456......#define CONFIG_BOOTCOMMAND \\ &quot;setenv interface mmc;&quot; \\ &quot;setenv mmcdev 0;&quot; \\ &quot;run mmcboot;&quot; \\...... æ·»åŠ 2è¡Œä»£ç ï¼Œç»“æœå¦‚ä¸‹: vi ~/u-boot/include/configs/mx6sabre_common.h12345678......#define CONFIG_BOOTCOMMAND \\ &quot;setenv interface mmc;&quot; \\ &quot;setenv mmcdev 3;&quot; \\ &quot;run mmcboot;&quot; \\ &quot;setenv mmcdev 0;&quot; \\ &quot;run mmcboot;&quot; \\...... é…ç½® &amp; ç¼–è¯‘ netop@mfgtools:~/u-boot$123make ARCH=arm CROSS_COMPILE=$&#123;CC&#125; distcleanmake ARCH=arm CROSS_COMPILE=$&#123;CC&#125; mx6sabresd_defconfigmake ARCH=arm CROSS_COMPILE=$&#123;CC&#125; Linux å†…æ ¸å†…æ ¸æˆ‘ä»¬é‡‡ç”¨ 4.19 é•¿æœŸæ”¯æŒç‰ˆã€‚ ä¸‹è½½æºç  netop@mfgtools:~$123git clone https://github.com/RobertCNelson/armv7-multiplatformcd armv7-multiplatform/git checkout origin/v4.19.x -b tmp ç¼–è¯‘ netop@mfgtools:~/armv7-multiplatform$1./build_kernel.sh æ ¹æ–‡ä»¶ç³»ç»Ÿæ ¹æ–‡ä»¶ç³»ç»Ÿæˆ‘ä»¬é‡‡ç”¨ Ubuntu18.04 LTSã€‚ ä¸‹è½½ netop@mfgtools:~$1wget -c https://rcn-ee.com/rootfs/eewiki/minfs/ubuntu-18.04.3-minimal-armhf-2020-02-10.tar.xz éªŒè¯ netop@mfgtools:~$12sha256sum ubuntu-18.04.3-minimal-armhf-2020-02-10.tar.xz# è¾“å‡ºä¿¡æ¯: b28b356d75153bfb3beb5c96bf8eabe92025cf5e665e1a564b469bc70e5a363b ubuntu-18.04.3-minimal-armhf-2020-02-10.tar.xz è§£å‹ netop@mfgtools:~$1tar xf ubuntu-18.04.3-minimal-armhf-2020-02-10.tar.xz æ€»ç»“æœ¬æ–‡ä»‹ç»äº† iMX6Q SABRE-SD å¼€å‘æ¿ç³»ç»Ÿè½¯ä»¶çš„åˆ¶ä½œã€‚é€šè¿‡è¿™äº›æ“ä½œå¯å¾—åˆ°ä»¥ä¸‹æ–‡ä»¶: å¯åŠ¨åŠ è½½å™¨, ç›®å½•: ~/u-boot/ SPL u-boot.img å†…æ ¸ç›¸å…³ï¼Œç›®å½•: ~/armv7-multiplatform/deploy 4.19.xx-armv7-xxx.zImage 4.19.xx-armv7-xxx-dtbs.tar.gz 4.19.xx-armv7-xxx-modules.tar.gz æ ¹æ–‡ä»¶ç³»ç»Ÿï¼Œç›®å½•: ~/imx6q/ubuntu-18.04.3-minimal-armhf-2020-02-10 armhf-rootfs-ubuntu-bionic.tar","categories":[],"tags":[{"name":"iMX6Q","slug":"iMX6Q","permalink":"https://blog.mahyang.uk/tags/iMX6Q/"},{"name":"U-Boot","slug":"U-Boot","permalink":"https://blog.mahyang.uk/tags/U-Boot/"},{"name":"Linux kernel","slug":"Linux-kernel","permalink":"https://blog.mahyang.uk/tags/Linux-kernel/"}]},{"title":"iMX USB loader & UTP ä½¿ç”¨æ–¹æ³•ä»‹ç»","slug":"iMX-USB-loader-UTP-ä½¿ç”¨æ–¹æ³•ä»‹ç»","date":"2020-02-18T06:04:49.000Z","updated":"2020-02-18T09:59:03.000Z","comments":true,"path":"2020/02/18/iMX-USB-loader-UTP-ä½¿ç”¨æ–¹æ³•ä»‹ç»/","link":"","permalink":"https://blog.mahyang.uk/2020/02/18/iMX-USB-loader-UTP-%E4%BD%BF%E7%94%A8%E6%96%B9%E6%B3%95%E4%BB%8B%E7%BB%8D/","excerpt":"æœ¬æ–‡å°†ä»‹ç» Freescale æä¾›çš„å·¥å…·è½¯ä»¶ iMX USB loader ä»¥åŠ UTP çš„ä½¿ç”¨æ–¹æ³•ã€‚","text":"æœ¬æ–‡å°†ä»‹ç» Freescale æä¾›çš„å·¥å…·è½¯ä»¶ iMX USB loader ä»¥åŠ UTP çš„ä½¿ç”¨æ–¹æ³•ã€‚ åœ¨ä½¿ç”¨ iMX6Q SabreSD å¼€å‘æ¿æ—¶ï¼Œå¦‚æœæˆ‘ä»¬å¯¹ Linux å†…æ ¸æˆ–è€…æ ¹æ–‡ä»¶ç³»ç»Ÿè¿›è¡Œäº†å®šåˆ¶åˆ™éœ€è¦å°†æ–°çš„è½¯ä»¶éƒ¨ç½²åˆ°å¼€å‘æ¿ã€‚å°†è½¯ä»¶éƒ¨ç½²åˆ°å¼€å‘æ¿çš„æ–¹æ³•ä¸å¼€å‘æ¿çš„å¯åŠ¨æ–¹å¼æœ‰å…³ï¼Œå¦‚æœæˆ‘ä»¬éœ€è¦å¼€å‘æ¿ä» eMMC å¯åŠ¨åˆ™éœ€è¦å°†è½¯ä»¶éƒ¨ç½²åˆ° eMMC å­˜å‚¨å™¨ï¼Œä½¿ç”¨ Freescale æä¾›çš„ iMX USB loader å’Œ UTP 2ä¸ªå·¥å…·èƒ½å¸®åŠ©æˆ‘ä»¬å®Œæˆè¿™é¡¹å·¥ä½œã€‚ è½¯ä»¶ç¯å¢ƒ æ“ä½œç³»ç»Ÿ: Ubuntu14.04 å¼€å‘æ¿è®¾ç½®åœ¨æ“ä½œä¹‹å‰éœ€è¦å°†å¼€å‘æ¿è®¾ç½®åˆ°ä¸‹è½½æ¨¡å¼ï¼ŒiMX6Q SabreSD çš„è¯´æ˜æ–‡æ¡£ä¸­æåˆ°: Mode Switch download mode(MFGTool mode) (SW6) 00001100 (from 1-8 bit) eMMC (MMC3) boot (SW6) 11100110 (from 1-8 bit) MMC4 (SD2) boot (SW6) 10000010 (from 1-8 bit) MMC2 (SD3) boot (SW6) 01000010 (from 1-8 bit) Freescale â€“ Android User Guide æ‰€ä»¥æˆ‘ä»¬å°†å¼€å‘æ¿çš„å¯åŠ¨æ‹¨ç å¼€å…³æ‹¨åˆ°å¦‚ä¸‹ä½ç½®: å°†å¼€å‘æ¿çš„ USB æ¥åˆ°ç”µè„‘ç«¯ï¼Œä½¿ç”¨ lsusb å‘½ä»¤å¯çœ‹åˆ°å¦‚ä¸‹ä¿¡æ¯: æŸ¥çœ‹ USB è®¾å¤‡ä¿¡æ¯1234lsusb# ......# Bus 001 Device 003: ID 15a2:0054 Freescale Semiconductor, Inc. i.MX 6Dual/6Quad SystemOnChip in RecoveryMode# ...... å¯çœ‹åˆ°ç”µè„‘ç«¯æˆåŠŸè¯†åˆ«äº†å¼€å‘æ¿ï¼Œè®°å½•ä¸‹ ID ä¿¡æ¯: ID: 15a2:0054 åœ¨å¼€å§‹åé¢æ­¥éª¤ä¹‹å‰è¯·å°†å¼€å‘æ¿ä¸²å£ä¸ç”µè„‘ç«¯è¿æ¥ï¼Œæ–¹ä¾¿é€šè¿‡ä¸²å£æŸ¥çœ‹è°ƒè¯•ä¿¡æ¯ã€‚ iMX USB loader å®‰è£…é…ç½® å®‰è£… libusbã€‚ install libusb1sudo apt-get install libusb-1.0-0-dev è·å– iMX USB loader æºä»£ç ã€‚ git clone1git clone https://github.com/boundarydevices/imx_usb_loader.git ç¼–è¯‘ compile12cd imx_usb_loadermake ä¿®æ”¹é…ç½®æ–‡ä»¶ æŸ¥çœ‹æ–‡ä»¶ imx_usb.conf æ ¹æ®åˆšåˆšè®°å½•ä¸‹æ¥çš„ ID å€¼æ‰¾åˆ°å–å¯¹åº”çš„å¼€å‘æ¿é…ç½®æ–‡ä»¶: imx_usb.conf123......0x15a2:0x0054, mx6_usb_work.conf...... å°†æ–‡ä»¶ mx6_usb_work.conf çš„å†…å®¹ä¿®æ”¹ä¸ºå¦‚ä¸‹: mx6_usb_work.conf12345678mx6_qsbhid,1024,0x910000,0x10000000,1G,0x00900000,0x40000firmware/u-boot.imx: dcdfirmware/zImage: load 0x12000000firmware/fsl-image-mfgtool-initramfs-imx6qsabresd.cpio.gz.u-boot: load 0x12C00000firmware/zImage-imx6q-sabresd.dtb: load 0x18000000firmware/u-boot.imx: clear_dcd,load,plug,jump header ä½¿ç”¨ USB loader åˆ›å»º firmware ç›®å½•: åˆ›å»ºç›®å½•1mkdir firmware å°†ç”Ÿæˆçš„é•œåƒæ–‡ä»¶æ‹·è´åˆ° firmware ç›®å½•ä¸­åæ‰§è¡Œ: è¿è¡Œ imx_usb1./imx_usb ç­‰å¾…åŠåˆ†é’Ÿå·¦å³ï¼Œå¯é€šè¿‡ä¸²å£çœ‹åˆ°è¾“å‡ºçš„å¯åŠ¨ä¿¡æ¯: ä¸²å£è¾“å‡ºä¿¡æ¯123456......Starting UTPuuc 0.5 [built Jan 9 2020 12:41:11]UTP: Waiting for device to appearUTP: file/device node /dev/utp already exists...... æ­¤æ—¶å¼€å‘æ¿é€šè¿‡ USB å°†è‡ªå·±æ¨¡æ‹Ÿæˆä¸€ä¸ª sg è®¾å¤‡ï¼Œåœ¨ç”µè„‘ç«¯å¯ä»¥é€šè¿‡ä»¥ä¸‹å‘½ä»¤æŸ¥çœ‹æ­¤è®¾å¤‡: æŸ¥çœ‹ sg è®¾å¤‡12ls /dev/sg*# /dev/sg0 /dev/sg1 å…¶ä¸­ /dev/sg1 å°±æ˜¯å¼€å‘æ¿ã€‚é€šè¿‡æ­¤è®¾å¤‡æˆ‘ä»¬ä¾¿å¯ç”¨ UTP å·¥å…·ä¸å¼€å‘æ¿é€šä¿¡ã€‚ UTP å®‰è£…é…ç½® å®‰è£… libsgutils2ã€‚ install libsgutils21sudo apt-get install libsgutils2-dev è·å– UTP æºä»£ç ã€‚ git clone1git clone https://github.com/ixonos/utp_com.git ç¼–è¯‘ compile12cd utp_commake ä½¿ç”¨ utp_com ä¸å¼€å‘æ¿é€šä¿¡ ä½¿ç”¨ utp_com1./utp_com -d /dev/sg1 -c &quot;$ echo hello, world!&quot; é€šè¿‡ä¸²å£å¯çœ‹åˆ°å¼€å‘æ¿çš„è¾“å‡ºä¿¡æ¯: ä¸²å£è¾“å‡º12345UTP: received command &#x27;$ echo hello, world!&#x27;UTP: executing &quot;echo hello, world!&quot;hello, world!UTP: sending Success to kernel for command $ echo hello, world!.utp_poll: pass returned. æ€»ç»“è‡³æ­¤æˆ‘ä»¬å®Œæˆäº† imx_usb å’Œ utp_com çš„å®‰è£…é…ç½®ï¼Œä½¿ç”¨ imx_usb å‘å¼€å‘æ¿ä¸‹è½½å›ºä»¶ï¼Œä»¥åŠä½¿ç”¨ utp_com ä¸å¼€å‘æ¿é€šä¿¡å‘å…¶å‘é€å¹¶æ‰§è¡ŒæŒ‡ä»¤ã€‚å…·ä½“å·¥ä½œå¦‚ä¸‹: å¼€å‘æ¿ä¸‹è½½æ¨¡å¼é…ç½® iMX USB loader å®‰è£…é…ç½® UTP com å®‰è£…é…ç½®","categories":[],"tags":[{"name":"iMX6Q","slug":"iMX6Q","permalink":"https://blog.mahyang.uk/tags/iMX6Q/"},{"name":"mfgtool","slug":"mfgtool","permalink":"https://blog.mahyang.uk/tags/mfgtool/"},{"name":"imx_usb","slug":"imx-usb","permalink":"https://blog.mahyang.uk/tags/imx-usb/"},{"name":"utp_com","slug":"utp-com","permalink":"https://blog.mahyang.uk/tags/utp-com/"}]},{"title":"æ­å»º iMX6Q SabreSD Yocto é¡¹ç›®å¼€å‘ç¯å¢ƒ","slug":"æ­å»º-iMX6Q-SabreSD-Yocto-é¡¹ç›®å¼€å‘ç¯å¢ƒ","date":"2020-02-17T03:03:41.000Z","updated":"2020-02-18T05:50:17.000Z","comments":true,"path":"2020/02/17/æ­å»º-iMX6Q-SabreSD-Yocto-é¡¹ç›®å¼€å‘ç¯å¢ƒ/","link":"","permalink":"https://blog.mahyang.uk/2020/02/17/%E6%90%AD%E5%BB%BA-iMX6Q-SabreSD-Yocto-%E9%A1%B9%E7%9B%AE%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83/","excerpt":"æœ¬æ–‡å°†ä»‹ç» iMX6Q SabreSD å¼€å‘æ¿çš„ Yocto Project å¼€å‘ç¯å¢ƒæ­å»ºï¼Œä»¥åŠä½¿ç”¨ Yocto ç¼–è¯‘æ­¤å¼€å‘æ¿çš„çƒ§å½•å·¥å…·ï¼ˆMFGToolï¼‰é•œåƒã€‚","text":"æœ¬æ–‡å°†ä»‹ç» iMX6Q SabreSD å¼€å‘æ¿çš„ Yocto Project å¼€å‘ç¯å¢ƒæ­å»ºï¼Œä»¥åŠä½¿ç”¨ Yocto ç¼–è¯‘æ­¤å¼€å‘æ¿çš„çƒ§å½•å·¥å…·ï¼ˆMFGToolï¼‰é•œåƒã€‚ è½¯ä»¶ç¯å¢ƒ æ“ä½œç³»ç»Ÿ: Ubuntu14.04 å®‰è£…ä¾èµ–åŒ…Yocto Project çš„ä¾èµ–åŒ…12sudo apt-get install gawk wget git-core diffstat unzip texinfo gcc-multilib \\build-essential chrpath socat å…¶ä»–ä¾èµ–åŒ…123sudo apt-get install libsdl1.2-dev xterm sed cvs subversion coreutils texi2html \\docbook-utils python-pysqlite2 help2man make gcc g++ desktop-file-utils \\libgl1-mesa-dev libglu1-mesa-dev mercurial autoconf automake groff curl lzop asciidoc u-boot å·¥å…·1sudo apt-get install u-boot-tools å®‰è£… repo å·¥å…·repo æ˜¯ä¸€ä¸ªåŸºäº git çš„å·¥å…·ã€‚ä½¿ç”¨ repo å¯ä»¥æ–¹ä¾¿åœ°ç®¡ç†å­˜åœ¨å¤šä¸ªè½¯ä»¶æºçš„é¡¹ç›®ã€‚å®‰è£… repo åˆ†ä¸ºä»¥ä¸‹å‡ ä¸ªæ­¥éª¤: åœ¨ home ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ª bin ç›®å½•ã€‚ å®‰è£… repo123mkdir ~/bincurl http://commondatastorage.googleapis.com/git-repo-downloads/repo &gt; ~/bin/repochmod a+x ~/bin/repo å°†ä¸‹é¢2è¡ŒåŠ å…¥ .bashrc æ–‡ä»¶æœ«å°¾ï¼Œç¡®ä¿ ~/bin åœ¨ PATH å˜é‡ä¸­ã€‚ ç¯å¢ƒå˜é‡12export PATH=$&#123;PATH&#125;:~/binexport MACHINE=imx6qsabresd æ„å»º Yocto é¡¹ç›®Freescale Yocto Project BSP Release ç›®å½•åŒ…å«å¦‚ä¸‹å†…å®¹: sources ç›®å½•åŒ…å«ä¸€äº›ç”¨äºæ„å»ºçš„é…æ–¹ ä¸€ä¸ªæˆ–å¤šä¸ª build ç›®å½• ä¸€äº›ç”¨äºé…ç½®å¼€å‘ç¯å¢ƒçš„è„šæœ¬ ä»¥ä¸‹æ­¥éª¤åˆ›å»ºäº†ä¸€ä¸ª fsl-release-bsp ç›®å½•ç”¨äºæ„å»º Yocto é¡¹ç›®: åˆ›å»ºç›®å½•12mkdir fsl-release-bspcd fsl-release-bsp é…ç½® git ä¿¡æ¯12345# git config --global user.name &quot;Your Name&quot;git config --global user.name &quot;ClarenceYk&quot;# git config --global user.email &quot;Your Email&quot;git config --global user.email &quot;xxx@xxx.com&quot;git config --list åŒæ­¥æºä»£ç 12repo init -u git://git.freescale.com/imx/fsl-arm-yocto-bsp.git -b imx-4.1.15-1.0.0_garepo sync ä¸Šé¢é‡‡ç”¨äº† imx-4.1.15-1.0.0_ga åˆ†æ”¯ï¼Œå¯æ ¹æ®å®é™…éœ€æ±‚ä½¿ç”¨å…¶ä»–åˆ†æ”¯ä»£ç ï¼Œå¦‚ä¸‹: ç¼–è¯‘æ„å»º MFGToolå‘å¼€å‘æ¿çƒ§å½•ç³»ç»Ÿé•œåƒå¯ä½¿ç”¨ MFGTool å®Œæˆã€‚ç¼–è¯‘ MFGTool é•œåƒæ–‡ä»¶çš„é…æ–¹åˆ†åˆ«æ˜¯ linux-imx-mfgtool å’Œ u-boot-mfgtoolã€‚ç¼–è¯‘å‘½ä»¤å¦‚ä¸‹: ç¼–è¯‘ MFGTool123cd ~/fsl-release-bspsource fsl-setup-release.sh -b build-mfgtools -e x11bitbake fsl-image-mfgtool-initramfs ç¼–è¯‘è¿‡ç¨‹éœ€ä¸‹è½½å¤§é‡çš„æºä»£ç ï¼Œä¸ºç¡®ä¿è¿‡ç¨‹é¡ºåˆ©å»ºè®®ä½¿ç”¨ VPN æˆ–è€…é‡‡ç”¨å…¶ä»–åŠ é€Ÿç½‘ç»œè®¿é—®çš„æ–¹å¼ã€‚ æˆåŠŸç¼–è¯‘ä¹‹åï¼Œåœ¨ç›®å½• ~/fsl-mfgtools-bsp/build-mfgtools/tmp/deploy/images/imx6qsabresd ä¸‹ä¼šäº§ç”Ÿå¦‚ä¸‹æ–‡ä»¶: u-boot.imxï¼ˆu-bootï¼‰ zImageï¼ˆå†…æ ¸ï¼‰ zImage-imx6q-sabresd.dtbï¼ˆè®¾å¤‡æ ‘ï¼‰ fsl-image-mfgtool-initramfs-imx6qsabresd.cpio.gz.u-bootï¼ˆå†…å­˜æ–‡ä»¶ç³»ç»Ÿï¼‰ æ€»ç»“é€šè¿‡ä»¥ä¸Šæ­¥éª¤ï¼Œæˆ‘ä»¬å®Œæˆäº† Freescale iMX6Q Yocto Project å¼€å‘ç¯å¢ƒæ­å»ºï¼Œå…¶ä¸­åŒ…å«å¦‚ä¸‹æ–¹é¢çš„å·¥ä½œ: å®‰è£…é¡¹ç›®ä¾èµ–è½¯ä»¶ å®‰è£… repo é…ç½® git æ„å»º Yocto é¡¹ç›® ç¼–è¯‘ MFGTool é•œåƒ","categories":[],"tags":[{"name":"iMX6Q","slug":"iMX6Q","permalink":"https://blog.mahyang.uk/tags/iMX6Q/"},{"name":"mfgtool","slug":"mfgtool","permalink":"https://blog.mahyang.uk/tags/mfgtool/"},{"name":"yocto","slug":"yocto","permalink":"https://blog.mahyang.uk/tags/yocto/"}]},{"title":"VirtualBox å®‰è£…åŠé…ç½® Ubuntu14.04 æœåŠ¡å™¨ç‰ˆ","slug":"VirtualBox-å®‰è£…åŠé…ç½®-Ubuntu14-04-æœåŠ¡å™¨ç‰ˆ","date":"2020-02-15T08:02:18.000Z","updated":"2020-02-19T02:19:30.000Z","comments":true,"path":"2020/02/15/VirtualBox-å®‰è£…åŠé…ç½®-Ubuntu14-04-æœåŠ¡å™¨ç‰ˆ/","link":"","permalink":"https://blog.mahyang.uk/2020/02/15/VirtualBox-%E5%AE%89%E8%A3%85%E5%8F%8A%E9%85%8D%E7%BD%AE-Ubuntu14-04-%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%89%88/","excerpt":"æœ¬æ–‡å°†ä»¥å®‰è£… Ubuntu14.04 æ“ä½œç³»ç»Ÿåˆ°è™šæ‹Ÿæœºä¸­ä¸ºä¾‹æ¥ä»‹ç» VirtualBox çš„ä½¿ç”¨ã€‚","text":"æœ¬æ–‡å°†ä»¥å®‰è£… Ubuntu14.04 æ“ä½œç³»ç»Ÿåˆ°è™šæ‹Ÿæœºä¸­ä¸ºä¾‹æ¥ä»‹ç» VirtualBox çš„ä½¿ç”¨ã€‚ è¿è¡Œç¯å¢ƒ æ“ä½œç³»ç»Ÿ: Windows 10 VirtualBox: 6.0 ä¸‹è½½åŠå®‰è£… VirtualBoxæœ¬æ–‡åˆ›å»ºæ—¶ä½¿ç”¨çš„ VirtualBox ç‰ˆæœ¬ä¸º 6.0ï¼Œä½ å¯æ ¹æ®è‡ªå·±çš„éœ€è¦é€‰æ‹©å…¶ä»–æˆ–è€…æœ€æ–°ç‰ˆæœ¬ã€‚ è®¿é—® Oracle VirtualBox ä¸»é¡µã€‚ ç‚¹å‡»ä¸‹è½½æŒ‰é’®ï¼Œä¸‹è½½å®‰è£…ç¨‹åºååŒå‡»æ­¤ç¨‹åºå®‰è£… VirtualBoxã€‚ æ­¤å¤„å¯ä¸€è·¯ç‚¹å‡»ä¸‹ä¸€æ­¥ç›´è‡³å®‰è£…å®Œæˆï¼Œç„¶åé‡å¯è®¡ç®—æœºã€‚ ä¸‹è½½ Ubuntu14.04 æœåŠ¡å™¨ç‰ˆé•œåƒæ–‡ä»¶ è®¿é—® Ubuntu é•œåƒå‘å¸ƒé¡µï¼Œç‚¹å‡»å¦‚ä¸‹å›¾é“¾æ¥ã€‚ åœ¨å¦‚ä¸‹é¡µé¢ä¸­æ‰¾åˆ°å¹¶ä¸‹è½½æœåŠ¡å™¨ç‰ˆæœ¬é•œåƒã€‚ åˆ›å»ºè™šæ‹Ÿæœºæ¥ä¸‹æ¥å¼€å§‹åˆ›å»ºè™šæ‹Ÿæœºã€‚ ç‚¹å‡»æ–°å»ºï¼Œé€‰é¡¹é…ç½®å¦‚ä¸‹ï¼š åç§°: è‡ªå®šä¹‰ï¼Œå¦‚ ubuntu1404-mfgtools è¡¨ç¤ºæ­¤è™šæ‹Ÿæœºæ“ä½œç³»ç»Ÿä¸º ubuntu14.04 ç”¨äºåˆ¶ä½œ mfgtools æ–‡ä»¶å¤¹: è‡ªå®šä¹‰ï¼Œæ­¤è™šæ‹Ÿæœºç›¸å…³æ–‡ä»¶å­˜æ”¾ä½ç½® ç±»å‹: Linux ç‰ˆæœ¬: Ubuntu (64-bit) å†…å­˜å¤§å°: ä¸å½±å“ä¸»æœºæ€§èƒ½çš„æƒ…å†µä¸‹å–æœ€å¤§ å…¶ä»–é€‰é¡¹å¦‚ä¸Šå›¾ï¼Œé…ç½®å®Œæˆåç‚¹å‡»åˆ›å»ºã€‚ åˆ›å»ºè™šæ‹Ÿç£ç›˜: æ–‡ä»¶å¤§å°: æ ¹æ®éœ€æ±‚é…ç½® å›ºå®šæˆ–åŠ¨æ€å¤§å°: åŒä¸Š é…ç½®å®Œæˆç‚¹å‡»åˆ›å»ºã€‚ è®¾ç½®å¯åŠ¨é•œåƒ ç‚¹å‡»è®¾ç½®ï¼Œé€‰æ‹©å­˜å‚¨ï¼š ä¾æ¬¡ç‚¹å‡»å¦‚ä¸‹æ‰€ç¤ºé€‰é¡¹ï¼š ç„¶ååœ¨å¼¹å‡ºçš„é€‰é¡¹ä¸­ç‚¹å‡»é€‰æ‹©ä¸€ä¸ªè™šæ‹Ÿå…‰ç›˜æ–‡ä»¶ï¼Œç„¶ååœ¨å¼¹å‡ºçš„é€‰é¡¹æ¡†ä¸­é€‰æ‹©ä¹‹å‰ä¸‹è½½çš„ç³»ç»Ÿé•œåƒæ–‡ä»¶ã€‚ é€‰æ‹©ç³»ç»Ÿï¼Œå°†å¯åŠ¨é¡ºåºæ”¹ä¸ºå¦‚ä¸‹å›¾èˆ¬: é…ç½®å®Œæˆåç‚¹å‡»ç¡®è®¤ã€‚ å®‰è£…ç³»ç»Ÿ ä¸»ç•Œé¢ç‚¹å‡»å¯åŠ¨ï¼Œè¿›å…¥ç³»ç»Ÿå®‰è£…ç•Œé¢ã€‚ æ ¹æ®æç¤ºæ“ä½œï¼Œå®Œæˆå®‰è£…åå¦‚ä¸‹å›¾ï¼š é€‰æ‹© Continue ç»“æŸå®‰è£…ã€‚å…³é—­çª—å£ã€‚ å›åˆ°ä¸»ç•Œé¢ç‚¹å‡»è®¾ç½®ï¼Œé€‰æ‹©ç³»ç»Ÿå¹¶å°†å¯åŠ¨é¡ºåºæ”¹ä¸ºå¦‚ä¸‹å›¾èˆ¬: ç‚¹å‡» ok ä¿å­˜è®¾ç½®ã€‚ é¢å¤–çš„é…ç½®å®Œæˆå‰é¢çš„æ­¥éª¤åä¸€ä¸ªå¯ç”¨çš„è™šæ‹Ÿæœºå·²ç»åˆ›å»ºå®Œæˆï¼Œåé¢çš„æ­¥éª¤å¯ä»¥è®©è™šæ‹Ÿæœºä½¿ç”¨èµ·æ¥æ›´æ–¹ä¾¿ã€‚ è®¾ç½®ç«¯å£è½¬å‘ å›åˆ°ä¸»ç•Œé¢ç‚¹å‡»è®¾ç½®ï¼Œé€‰æ‹©ç½‘ç»œå¹¶ç‚¹å‡»é«˜çº§é€‰é¡¹å¡: ç‚¹å‡»ç«¯å£è½¬å‘ä¹‹åï¼Œæ·»åŠ å¦‚ä¸‹é…ç½®: å…¶ä¸­å­ç³»ç»ŸIPå¡«ä¸ºè™šæ‹Ÿæœºçš„ IP åœ°å€ã€‚ è¿™ä¸€æ­¥çš„ä½œç”¨æ˜¯å°†è™šæ‹Ÿæœºçš„ 22 ç«¯å£è½¬å‘åˆ°ä¸»æœºçš„ 2200 ç«¯å£ä¸Šï¼Œæ–¹é¢æˆ‘ä»¬ä½¿ç”¨ SSH è¿æ¥è™šæ‹Ÿæœºã€‚ å®‰è£…å¢å¼ºåŠŸèƒ½ ç™»å½•è™šæ‹Ÿæœº12# ssh -p &lt;ç«¯å£&gt; &lt;ç”¨æˆ·&gt;@&lt;ä¸»æœºåœ°å€&gt;ssh -p 2200 test@192.168.1.101 å®‰è£…ä¾èµ–è½¯ä»¶123sudo apt-get updatesudo apt-get upgradesudo apt-get install build-essential ç‚¹å‡»å¦‚ä¸‹å›¾æ‰€ç¤ºçš„å®‰è£…å¢å¼ºåŠŸèƒ½: æŒ‚è½½å…‰ç›˜123sudo mkdir /mnt/cdromsudo mount /dev/cdrom /mnt/cdrom/# mount: block device /dev/sr0 is write-protected, mounting read-only è¿è¡Œå®‰è£…ç¨‹åº123cd /mnt/cdrom/sudo ./VBoxLinuxAdditions.runsudo shutdown -h 0 -r å…±äº«æ–‡ä»¶å¤¹ åŠ å…¥ vboxsf ç»„12# sudo usermod -a -G vboxsf &lt;ç”¨æˆ·&gt;sudo usermod -a -G vboxsf test å›åˆ°è®¾ç½®ï¼Œé€‰æ‹©å…±äº«æ–‡ä»¶å¤¹å¹¶ç‚¹å‡»å¦‚ä¸‹æ‰€ç¤ºæŒ‰é’®: å¦‚ä¸‹èˆ¬è®¾ç½®: æŒ‚è½½ç‚¹ä¸ç”¨å¡«ã€‚ é‡å¯è™šæ‹Ÿæœº1sudo shutdown -h 0 -r USB è®¾å¤‡æ”¯æŒ è®¿é—® VirtualBox å®˜ç½‘ä¸‹è½½æ‹“å±•åŒ…ã€‚æ³¨æ„ï¼Œè¯·æ‰¾åˆ°å¯¹åº”è‡ªå·±ç‰ˆæœ¬çš„æ‹“å±•åŒ…ã€‚ å›åˆ° VirtualBox ä¸»ç•Œé¢ï¼Œé€‰æ‹©ç®¡ç†-&gt;å…¨å±€è®¾å®š-&gt;æ‹“å±•: é€‰æ‹©åˆšåˆšä¸‹è½½çš„æ‹“å±•åŒ…ï¼Œå®‰è£…ã€‚ æ€»ç»“ä»¥ä¸Šæˆ‘ä»¬å°±åœ¨è™šæ‹Ÿæœºä¸­å®‰è£…å¥½äº† Ubuntu æ“ä½œç³»ç»Ÿï¼Œå¹¶åšäº†ä»¥ä¸‹è®¾ç½®: å°†è™šæ‹Ÿæœºçš„22ç«¯å£è½¬å‘åˆ°ä¸»æœº2200ç«¯å£ã€‚ åˆ›å»ºä¸€ä¸ªå…±äº«æ–‡ä»¶å¤¹ç”¨äºè™šæ‹Ÿæœºä¸ä¸»æœºé—´çš„æ–‡ä»¶å…±äº«ã€‚ å®‰è£…äº†æ‹“å±•åŒ…ä½¿è™šæ‹Ÿæœºæ”¯æŒ USB2.0 ä»¥åŠ USB3.0 è®¾å¤‡ã€‚","categories":[],"tags":[{"name":"iMX6Q","slug":"iMX6Q","permalink":"https://blog.mahyang.uk/tags/iMX6Q/"},{"name":"å¼€å‘ç¯å¢ƒ","slug":"å¼€å‘ç¯å¢ƒ","permalink":"https://blog.mahyang.uk/tags/%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83/"}]}],"categories":[],"tags":[{"name":"Rust","slug":"Rust","permalink":"https://blog.mahyang.uk/tags/Rust/"},{"name":"WSL","slug":"WSL","permalink":"https://blog.mahyang.uk/tags/WSL/"},{"name":"Kernel Module","slug":"Kernel-Module","permalink":"https://blog.mahyang.uk/tags/Kernel-Module/"},{"name":"é¢è¯•","slug":"é¢è¯•","permalink":"https://blog.mahyang.uk/tags/%E9%9D%A2%E8%AF%95/"},{"name":"C","slug":"C","permalink":"https://blog.mahyang.uk/tags/C/"},{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"https://blog.mahyang.uk/tags/%E7%AE%97%E6%B3%95/"},{"name":"RISC-V","slug":"RISC-V","permalink":"https://blog.mahyang.uk/tags/RISC-V/"},{"name":"OS","slug":"OS","permalink":"https://blog.mahyang.uk/tags/OS/"},{"name":"Asterisk","slug":"Asterisk","permalink":"https://blog.mahyang.uk/tags/Asterisk/"},{"name":"Cross Compilation","slug":"Cross-Compilation","permalink":"https://blog.mahyang.uk/tags/Cross-Compilation/"},{"name":"æ“ä½œæ–¹æ³•","slug":"æ“ä½œæ–¹æ³•","permalink":"https://blog.mahyang.uk/tags/%E6%93%8D%E4%BD%9C%E6%96%B9%E6%B3%95/"},{"name":"QEMU","slug":"QEMU","permalink":"https://blog.mahyang.uk/tags/QEMU/"},{"name":"ARM64","slug":"ARM64","permalink":"https://blog.mahyang.uk/tags/ARM64/"},{"name":"Ubuntu","slug":"Ubuntu","permalink":"https://blog.mahyang.uk/tags/Ubuntu/"},{"name":"LXD","slug":"LXD","permalink":"https://blog.mahyang.uk/tags/LXD/"},{"name":"VoIP","slug":"VoIP","permalink":"https://blog.mahyang.uk/tags/VoIP/"},{"name":"FreePBX","slug":"FreePBX","permalink":"https://blog.mahyang.uk/tags/FreePBX/"},{"name":"systemd-nspawn","slug":"systemd-nspawn","permalink":"https://blog.mahyang.uk/tags/systemd-nspawn/"},{"name":"Linux","slug":"Linux","permalink":"https://blog.mahyang.uk/tags/Linux/"},{"name":"Operating System","slug":"Operating-System","permalink":"https://blog.mahyang.uk/tags/Operating-System/"},{"name":"Context Switch","slug":"Context-Switch","permalink":"https://blog.mahyang.uk/tags/Context-Switch/"},{"name":"rsync","slug":"rsync","permalink":"https://blog.mahyang.uk/tags/rsync/"},{"name":"clone file system","slug":"clone-file-system","permalink":"https://blog.mahyang.uk/tags/clone-file-system/"},{"name":"Architecture","slug":"Architecture","permalink":"https://blog.mahyang.uk/tags/Architecture/"},{"name":"Software Design","slug":"Software-Design","permalink":"https://blog.mahyang.uk/tags/Software-Design/"},{"name":"GPIO","slug":"GPIO","permalink":"https://blog.mahyang.uk/tags/GPIO/"},{"name":"memory map","slug":"memory-map","permalink":"https://blog.mahyang.uk/tags/memory-map/"},{"name":"iMX6Q","slug":"iMX6Q","permalink":"https://blog.mahyang.uk/tags/iMX6Q/"},{"name":"å†…å­˜æ‹“å±•","slug":"å†…å­˜æ‹“å±•","permalink":"https://blog.mahyang.uk/tags/%E5%86%85%E5%AD%98%E6%8B%93%E5%B1%95/"},{"name":"Watchdog","slug":"Watchdog","permalink":"https://blog.mahyang.uk/tags/Watchdog/"},{"name":"Embedded System","slug":"Embedded-System","permalink":"https://blog.mahyang.uk/tags/Embedded-System/"},{"name":"U-Boot","slug":"U-Boot","permalink":"https://blog.mahyang.uk/tags/U-Boot/"},{"name":"Linux kernel","slug":"Linux-kernel","permalink":"https://blog.mahyang.uk/tags/Linux-kernel/"},{"name":"mfgtool","slug":"mfgtool","permalink":"https://blog.mahyang.uk/tags/mfgtool/"},{"name":"imx_usb","slug":"imx-usb","permalink":"https://blog.mahyang.uk/tags/imx-usb/"},{"name":"utp_com","slug":"utp-com","permalink":"https://blog.mahyang.uk/tags/utp-com/"},{"name":"yocto","slug":"yocto","permalink":"https://blog.mahyang.uk/tags/yocto/"},{"name":"å¼€å‘ç¯å¢ƒ","slug":"å¼€å‘ç¯å¢ƒ","permalink":"https://blog.mahyang.uk/tags/%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83/"}]}